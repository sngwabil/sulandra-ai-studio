<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sulandra Creative Lab Â· Professional</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* -------------------------------------------------------------------------- */
/* THEME: "VOID & GLASS" (Professional AI Tool Look)                          */
/* -------------------------------------------------------------------------- */
:root {
    --bg-app: #09090b;       /* Deepest Void */
    --bg-panel: #101012;     /* Panel Background */
    --bg-element: #18181b;   /* Input Background */
    --bg-hover: #27272a;     /* Hover State */
    
    --border: rgba(255,255,255,0.08);
    --border-hover: rgba(255,255,255,0.15);
    
    --accent: #6366f1;       /* Primary Brand (Indigo) */
    --accent-glow: rgba(99, 102, 241, 0.4);
    --accent-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
    
    --text-primary: #ffffff;
    --text-secondary: #a1a1aa;
    --text-muted: #52525b;
    
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    
    --header-height: 60px;
    --nav-width: 64px;
    --sidebar-width: 400px;
}

* { box-sizing: border-box; outline: none; -webkit-font-smoothing: antialiased; }

body {
    margin: 0;
    padding: 0;
    background: var(--bg-app);
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    height: 100vh;
    overflow: hidden;
    display: flex;
}

/* Typography Overrides */
h1, h2, h3, .brand-font { font-family: 'Cinzel', serif; }
.mono { font-family: 'JetBrains Mono', monospace; }

/* Scrollbars */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #52525b; }

/* -------------------------------------------------------------------------- */
/* BUTTONS & INPUTS                                                           */
/* -------------------------------------------------------------------------- */
.btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 0 16px; height: 40px;
    border-radius: var(--radius-md); font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.2s; border: 1px solid transparent;
}
.btn-primary {
    background: var(--text-primary); color: var(--bg-app);
}
.btn-primary:hover { background: #e4e4e7; transform: translateY(-1px); }

.btn-accent {
    background: var(--accent-gradient); color: white;
    box-shadow: 0 0 15px var(--accent-glow);
}
.btn-accent:hover { filter: brightness(1.1); }

.btn-ghost {
    background: transparent; color: var(--text-secondary);
}
.btn-ghost:hover { background: var(--bg-hover); color: var(--text-primary); }

.btn-icon {
    width: 36px; height: 36px; padding: 0;
    border-radius: var(--radius-md); background: transparent; color: var(--text-secondary);
}
.btn-icon:hover { background: var(--bg-hover); color: white; }
.btn-icon.active { background: var(--bg-hover); color: var(--accent); }

/* Inputs */
.input-group { margin-bottom: 20px; }
.label-row { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
.label { font-size: 11px; font-weight: 600; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 0.05em; }

input[type="text"], textarea, select {
    width: 100%; background: var(--bg-element);
    border: 1px solid var(--border); border-radius: var(--radius-md);
    padding: 10px 12px; color: white; font-family: 'Inter', sans-serif; font-size: 13px;
    transition: 0.2s; resize: none;
}
input[type="text"]:focus, textarea:focus, select:focus {
    border-color: var(--accent); background: var(--bg-app);
}

/* Custom Range Slider */
input[type=range] {
    -webkit-appearance: none; width: 100%; background: transparent; margin: 10px 0;
}
input[type=range]::-webkit-slider-runnable-track {
    width: 100%; height: 4px; background: var(--bg-hover); border-radius: 2px;
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
    background: var(--text-primary); margin-top: -6px; cursor: pointer;
    box-shadow: 0 0 0 2px var(--bg-app);
}

/* -------------------------------------------------------------------------- */
/* LAYOUT: NAV RAIL                                                           */
/* -------------------------------------------------------------------------- */
.nav-rail {
    width: var(--nav-width); background: var(--bg-app);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column; align-items: center; padding: 20px 0; z-index: 50;
}
.brand-logo {
    width: 40px; height: 40px; border-radius: 10px;
    background: var(--accent-gradient); color: white;
    font-family: 'Cinzel', serif; font-weight: 700; font-size: 20px;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 30px; box-shadow: 0 0 20px var(--accent-glow);
}
.nav-item {
    width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
    border-radius: 12px; color: var(--text-secondary); margin-bottom: 12px; cursor: pointer;
    transition: 0.2s; position: relative;
}
.nav-item:hover { background: var(--bg-hover); color: white; }
.nav-item.active { background: var(--bg-hover); color: var(--accent); }
.nav-item.active::before {
    content: ''; position: absolute; left: -10px; width: 3px; height: 20px;
    background: var(--accent); border-radius: 0 4px 4px 0;
}

/* -------------------------------------------------------------------------- */
/* LAYOUT: SIDEBAR (CONTROLS)                                                 */
/* -------------------------------------------------------------------------- */
.sidebar {
    width: var(--sidebar-width); background: var(--bg-panel);
    border-right: 1px solid var(--border);
    display: flex; flex-direction: column; z-index: 40;
}
.sidebar-header {
    height: var(--header-height); padding: 0 20px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
}
.sidebar-content {
    flex: 1; overflow-y: auto; padding: 20px;
}

/* Mode Switcher Tabs */
.tabs {
    display: flex; background: var(--bg-element); padding: 4px;
    border-radius: var(--radius-md); margin-bottom: 24px;
}
.tab {
    flex: 1; text-align: center; padding: 8px; font-size: 12px; font-weight: 600;
    color: var(--text-secondary); border-radius: 6px; cursor: pointer;
}
.tab:hover { color: white; }
.tab.active { background: var(--bg-hover); color: white; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }

/* Aspect Ratio Grid */
.ratio-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
}
.ratio-item {
    background: var(--bg-element); border: 1px solid var(--border);
    border-radius: var(--radius-md); padding: 10px; text-align: center;
    cursor: pointer; transition: 0.2s;
}
.ratio-item:hover { border-color: var(--text-secondary); }
.ratio-item.active { background: var(--bg-hover); border-color: var(--accent); color: white; }
.ratio-val { font-size: 11px; font-weight: 700; display: block; margin-bottom: 4px; }
.ratio-lbl { font-size: 10px; color: var(--text-secondary); opacity: 0.8; }

/* -------------------------------------------------------------------------- */
/* LAYOUT: MAIN STAGE (GALLERY)                                               */
/* -------------------------------------------------------------------------- */
.stage {
    flex: 1; background: #000; position: relative;
    display: flex; flex-direction: column;
}
.stage-header {
    height: var(--header-height); padding: 0 24px;
    display: flex; align-items: center; justify-content: space-between;
    background: rgba(9,9,11,0.8); backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border); z-index: 10;
}
.stage-content {
    flex: 1; overflow-y: auto; padding: 24px;
    background: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #000000 60%);
}

/* Gallery Grid */
.gallery-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}
.card {
    background: var(--bg-panel); border: 1px solid var(--border);
    border-radius: var(--radius-lg); overflow: hidden;
    position: relative; transition: transform 0.2s; aspect-ratio: 1/1;
}
.card.video { aspect-ratio: 16/9; }
.card:hover { transform: translateY(-4px); border-color: var(--text-secondary); }
.card img, .card video { width: 100%; height: 100%; object-fit: cover; }

.card-overlay {
    position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    opacity: 0; transition: opacity 0.2s; padding: 16px;
    display: flex; flex-direction: column; justify-content: flex-end;
}
.card:hover .card-overlay { opacity: 1; }
.card-prompt { font-size: 12px; line-height: 1.4; color: #e4e4e7; margin-bottom: 12px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.card-actions { display: flex; gap: 8px; }

/* -------------------------------------------------------------------------- */
/* ASSETS SIDEBAR (The Missing Piece from your old code)                      */
/* -------------------------------------------------------------------------- */
.assets-list {
    display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px;
}
.assets-list.is-list { grid-template-columns: 1fr; }
.asset-item {
    background: var(--bg-element); border-radius: var(--radius-md);
    padding: 6px; display: flex; gap: 10px; align-items: center; cursor: pointer;
    border: 1px solid transparent; transition: 0.15s;
}
.asset-item:hover { background: var(--bg-hover); border-color: var(--border-hover); }
.asset-thumb {
    width: 48px; height: 48px; border-radius: 4px; object-fit: cover; background: #000; flex-shrink: 0;
}
.asset-meta {
    font-size: 11px; color: var(--text-secondary); overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
}
.is-grid .asset-meta { display: none; } /* Hide text in grid mode */
.is-grid .asset-thumb { width: 100%; height: 80px; }
.is-grid .asset-item { display: block; padding: 0; overflow: hidden; border: 1px solid var(--border); }

/* -------------------------------------------------------------------------- */
/* UTILS & EXTRAS                                                             */
/* -------------------------------------------------------------------------- */
.badge-pro {
    background: linear-gradient(90deg, #fbbf24, #d97706);
    color: black; font-weight: 700; font-size: 10px; padding: 2px 6px; border-radius: 4px;
}
.ask-sia-btn {
    position: absolute; right: 8px; top: 8px;
    background: rgba(99, 102, 241, 0.15); border: 1px solid rgba(99, 102, 241, 0.3);
    color: var(--accent); font-size: 11px; font-weight: 600;
    padding: 4px 10px; border-radius: 100px; cursor: pointer; display: flex; align-items: center; gap: 4px;
}
.ask-sia-btn:hover { background: rgba(99, 102, 241, 0.25); }

/* Loading Animation */
.loading-card {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    border: 1px dashed var(--border); background: rgba(255,255,255,0.02);
}
.spinner {
    width: 24px; height: 24px; border: 3px solid var(--border); border-top-color: var(--accent);
    border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 12px;
}
@keyframes spin { to { transform: rotate(360deg); } }

</style>
</head>
<body>

<div class="nav-rail">
    <div class="brand-logo">S</div>
    
    <div class="nav-item active" id="nav-image" onclick="switchLab('image')" title="Image Lab">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
    </div>
    
    <div class="nav-item" id="nav-video" onclick="switchLab('video')" title="Video Lab">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
    </div>
    
    <div class="nav-item" id="nav-shortfilm" onclick="switchLab('shortfilm')" title="Short Film / Storyboard">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="14" rx="2"/><path d="M2 10h20M6 2l2 4M10 2l2 4M14 2l2 4M18 2l2 4"/></svg>
    </div>
    
    <div class="nav-item" id="nav-assets" onclick="switchLab('assets')" title="My Files">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
    </div>

    <div style="margin-top: auto;"></div>
    <div class="nav-item" title="Settings"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82A1.65 1.65 0 0 0 3 13H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9A1.65 1.65 0 0 0 10 3.09V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82A1.65 1.65 0 0 0 21 11h.09A2 2 0 0 1 21 15z"/></svg></div>
</div>

<div class="sidebar">
    <div class="sidebar-header">
        <span class="brand-font" style="font-weight: 700; letter-spacing: 1px;">CREATIVE LAB</span>
        <div class="badge-pro">PRO</div>
    </div>

    <div class="sidebar-content">
        
        <div id="image-controls">
            <div class="tabs">
                <div class="tab active" onclick="setImageMode('txt2img', this)">Text to Image</div>
                <div class="tab" onclick="setImageMode('img2img', this)">Image to Image</div>
            </div>

            <div class="input-group">
                <div class="label-row">
                    <span class="label">Prompt</span>
                    <button class="ask-sia-btn" onclick="openSiaForField('prompt-input')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>
                        Ask SIA
                    </button>
                </div>
                <textarea id="prompt-input" rows="5" placeholder="Describe your imagination... e.g. An astronaut riding a horse in a photorealistic style, 8k resolution"></textarea>
            </div>

            <div class="input-group">
                <div class="label-row"><span class="label">Aspect Ratio</span></div>
                <div class="ratio-grid">
                    <div class="ratio-item active" onclick="setRatio('1:1', this)"><span class="ratio-val">1:1</span><span class="ratio-lbl">Square</span></div>
                    <div class="ratio-item" onclick="setRatio('16:9', this)"><span class="ratio-val">16:9</span><span class="ratio-lbl">Landscape</span></div>
                    <div class="ratio-item" onclick="setRatio('9:16', this)"><span class="ratio-val">9:16</span><span class="ratio-lbl">Portrait</span></div>
                </div>
            </div>

            <div class="input-group">
                <div class="label-row"><span class="label">Settings</span></div>
                <select style="margin-bottom: 8px;">
                    <option>Flux Pro (Best Quality)</option>
                    <option>Flux Schnell (Fast)</option>
                    <option>Midjourney V6 (Simulated)</option>
                </select>
                
                <div style="display:flex; justify-content:space-between; font-size: 11px; margin-top:8px;">
                    <span>Guidance Scale</span><span id="guidance-val">3.5</span>
                </div>
                <input type="range" min="1" max="20" value="3.5" step="0.5" oninput="document.getElementById('guidance-val').innerText=this.value">
            </div>

            <button class="btn btn-accent" style="width: 100%; height: 48px; font-weight: 600; font-size: 14px;" onclick="generateImage(this)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>
                GENERATE
            </button>
        </div>

        <div id="video-controls" style="display:none;">
            <div class="tabs">
                <div class="tab active" onclick="setVideoMode('text', this)">Text to Video</div>
                <div class="tab" onclick="setVideoMode('image', this)">Image to Video</div>
            </div>

            <div class="input-group" id="video-upload-group" style="display:none;">
                <div class="label-row"><span class="label">Source Image</span></div>
                <div style="border: 2px dashed var(--border); border-radius: 8px; height: 120px; display:flex; align-items:center; justify-content:center; color: var(--text-secondary); font-size: 12px; cursor: pointer;">
                    Click to Upload Image
                </div>
            </div>

            <div class="input-group">
                <div class="label-row"><span class="label">Video Prompt</span></div>
                <textarea id="video-prompt" rows="4" placeholder="Describe the motion... e.g. Camera pans right, character smiles..."></textarea>
            </div>

            <div class="input-group">
                <div class="label-row"><span class="label">Duration</span></div>
                <select>
                    <option>5 Seconds</option>
                    <option>10 Seconds</option>
                </select>
            </div>

            <button class="btn btn-accent" style="width: 100%; height: 48px;" onclick="generateVideo()">GENERATE VIDEO</button>
        </div>

        <div id="shortfilm-controls" style="display:none;">
            <div class="label-row" style="margin-bottom:12px;">
                <span class="label">Storyboard</span>
                <span style="font-size:10px; color:var(--text-secondary);">0/20 Shots</span>
            </div>
            
            <div style="height: 200px; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--bg-element); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); font-size: 12px;">
                Storyboard Timeline Empty
            </div>

            <div class="input-group">
                <span class="label">Shot Description</span>
                <textarea style="margin-top:8px;" rows="3" placeholder="Describe this specific shot..."></textarea>
            </div>

            <button class="btn btn-accent" style="width: 100%;">RENDER FILM</button>
        </div>

        <div id="assets-controls" style="display:none;">
            <div class="label-row" style="margin-bottom: 16px;">
                <span class="label" style="font-size: 13px; color: white;">My Files</span>
                <div style="display:flex; gap: 4px;">
                    <button class="btn-icon active" onclick="setAssetsView('grid', this)" title="Grid View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                    </button>
                    <button class="btn-icon" onclick="setAssetsView('list', this)" title="List View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                    </button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="filterAssets('image')">Images</div>
                <div class="tab" onclick="filterAssets('video')">Videos</div>
                <div class="tab" onclick="filterAssets('favorites')">Starred</div>
            </div>

            <div id="assets-sidebar-list" class="assets-list is-grid">
                </div>
        </div>

    </div>
</div>

<div class="stage">
    <div class="stage-header">
        <div style="display: flex; gap: 20px;">
            <span class="label" style="cursor: pointer; color: white;" onclick="setGalleryTab('history')">History</span>
            <span class="label" style="cursor: pointer;" onclick="setGalleryTab('community')">Community</span>
            <span class="label" style="cursor: pointer;" onclick="setGalleryTab('favorites')">Favorites</span>
        </div>
        <div class="badge-pro" style="background: var(--bg-element); border: 1px solid var(--border); color: var(--text-secondary); font-weight: 500;">
            50 Credits Available
        </div>
    </div>

    <div class="stage-content" id="gallery-container">
        <div class="gallery-grid" id="gallery-grid">
            </div>

        <div id="empty-state" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height: 100%; opacity: 0.5;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="color: var(--text-secondary); margin-bottom: 16px;"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
            <div style="font-size: 16px; font-weight: 600;">Start Creating</div>
            <div style="font-size: 13px; margin-top: 4px; color: var(--text-secondary);">Your generated creations will appear here.</div>
        </div>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    const STORAGE_KEY = 'sulandra_history_v2';
    let currentLab = 'image';
    let currentAssetsMode = 'grid';
    let currentAssetFilter = 'image';

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        renderHistory();
        renderAssetsSidebar(); // Populate sidebar initially
    });

    // --- NAVIGATION LOGIC ---
    function switchLab(labName) {
        currentLab = labName;
        
        // Update Nav Rail Icons
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById(`nav-${labName}`).classList.add('active');

        // Toggle Control Panels
        const panels = ['image-controls', 'video-controls', 'shortfilm-controls', 'assets-controls'];
        panels.forEach(id => {
            document.getElementById(id).style.display = (id === `${labName}-controls`) ? 'block' : 'none';
        });

        // If switching to Assets, ensure list is rendered
        if (labName === 'assets') {
            renderAssetsSidebar();
        }
    }

    // --- ASSETS SIDEBAR LOGIC (The Fixed Part) ---
    function setAssetsView(mode, btn) {
        currentAssetsMode = mode;
        const list = document.getElementById('assets-sidebar-list');
        list.className = `assets-list is-${mode}`;
        
        // Update button states
        btn.parentElement.querySelectorAll('.btn-icon').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function filterAssets(type) {
        currentAssetFilter = type;
        // Update tabs styling
        const tabs = document.querySelectorAll('#assets-controls .tab');
        tabs.forEach(t => t.classList.remove('active'));
        event.target.classList.add('active'); // highlight clicked tab
        
        renderAssetsSidebar();
    }

    function renderAssetsSidebar() {
        const list = document.getElementById('assets-sidebar-list');
        const history = getHistory();
        
        // Filter Items
        const items = history.filter(item => {
            if (currentAssetFilter === 'favorites') return item.favorite;
            return item.type === currentAssetFilter;
        });

        list.innerHTML = '';
        
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'asset-item';
            div.innerHTML = `
                <img src="${item.url}" class="asset-thumb">
                <div class="asset-meta">${item.prompt}</div>
            `;
            div.onclick = () => {
                // On click, maybe show in main stage or open preview
                openLightbox(item);
            };
            list.appendChild(div);
        });
    }

    // --- GENERATION LOGIC (Simulation) ---
    function generateImage(btn) {
        const prompt = document.getElementById('prompt-input').value;
        if(!prompt) return alert("Please enter a prompt");

        // UI Loading State
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner" style="width:14px; height:14px; border-width:2px; display:inline-block; margin:0;"></span> Generating...`;

        // Create Pending Card
        const grid = document.getElementById('gallery-grid');
        const pendingCard = document.createElement('div');
        pendingCard.className = 'card loading-card';
        pendingCard.innerHTML = `<div class="spinner"></div><div style="font-size:11px;">Rendering...</div>`;
        grid.prepend(pendingCard);
        document.getElementById('empty-state').style.display = 'none';

        // Simulate API Call (2 seconds)
        setTimeout(() => {
            // Mock Result
            const newItem = {
                id: Date.now(),
                type: 'image',
                url: 'https://picsum.photos/seed/' + Date.now() + '/512/512', // Placeholder
                prompt: prompt,
                favorite: false
            };

            saveToHistory(newItem);
            
            // Remove pending, render all
            btn.disabled = false;
            btn.innerHTML = originalText;
            renderHistory();
            if (currentLab === 'assets') renderAssetsSidebar(); // Sync sidebar if open
        }, 2000);
    }

    // --- GALLERY LOGIC ---
    function getHistory() {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
    }

    function saveToHistory(item) {
        const history = getHistory();
        history.unshift(item);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
    }

    function renderHistory() {
        const grid = document.getElementById('gallery-grid');
        const history = getHistory();
        
        grid.innerHTML = '';
        
        if (history.length === 0) {
            document.getElementById('empty-state').style.display = 'flex';
            return;
        }
        document.getElementById('empty-state').style.display = 'none';

        history.forEach(item => {
            const card = document.createElement('div');
            card.className = `card ${item.type}`;
            card.innerHTML = `
                <img src="${item.url}" loading="lazy">
                <div class="card-overlay">
                    <div class="card-prompt">${item.prompt}</div>
                    <div class="card-actions">
                        <button class="btn btn-primary" style="height:30px; font-size:11px;">Download</button>
                        <button class="btn btn-ghost" style="height:30px; color:white; background:rgba(255,255,255,0.2);">Use</button>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // --- UI HELPERS ---
    function setImageMode(mode, el) {
        document.querySelectorAll('#image-controls .tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        // Logic to toggle Upload input vs Text input would go here
    }

    function setRatio(ratio, el) {
        document.querySelectorAll('.ratio-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
    }

    function openSiaForField(id) {
        alert("SIA AI Assistant would open here to help optimize: " + document.getElementById(id).value);
    }

</script>
</body>
</html>
