<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sulandra Creative Lab · Vision Lab</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet"
    />
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap"
        rel="stylesheet"
    />

    <style>
    /* ====================================================================== */
    /*  SULANDRA VISION LAB – SECTION 1: GLOBAL THEME & BASE LAYOUT          */
    /*  (Chunk 1 / 8 – paste at very top of the file)                        */
    /* ====================================================================== */

    :root {
        /* Core background layers */
        --bg-root: #020617;
        --bg-app: #020617;
        --bg-panel: #020617;
        --bg-card: #020617;
        --bg-card-soft: #020617;
        --bg-elevated: #020617;

        /* Structural borders */
        --border-subtle: #111827;
        --border-strong: #1f2937;
        --border-focus: #4b5563;

        /* Accent + status */
        --accent-primary: #22c55e;
        --accent-primary-soft: rgba(34, 197, 94, 0.12);
        --accent-primary-strong: #4ade80;
        --accent-secondary: #60a5fa;
        --accent-secondary-soft: rgba(96, 165, 250, 0.2);
        --accent-danger: #ef4444;
        --accent-warning: #f97316;

        /* Text */
        --text-primary: #f9fafb;
        --text-secondary: #9ca3af;
        --text-muted: #6b7280;
        --text-soft: #4b5563;
        --text-dark: #020617;

        /* Shadows & radii */
        --radius-xs: 8px;
        --radius-sm: 10px;
        --radius-md: 14px;
        --radius-lg: 20px;
        --radius-xl: 24px;
        --radius-pill: 999px;

        --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.9);
        --shadow-card: 0 24px 60px rgba(0, 0, 0, 0.95);
        --shadow-strong: 0 32px 80px rgba(0, 0, 0, 0.98);
        --shadow-glow-accent: 0 0 0 1px rgba(34, 197, 94, 0.8),
                               0 0 40px rgba(34, 197, 94, 0.9);

        /* Layout metrics */
        --nav-width: 80px;
        --header-height: 70px;
        --footer-height: 0px;
        --history-rail-width: 100px;
        --config-panel-min: 360px;
        --config-panel-max: 460px;

        /* Timing */
        --fast: 120ms;
        --normal: 160ms;
        --slow: 220ms;
    }

    /* ---------------------------------------------------------------------- */
    /*  RESET & BASICS                                                       */
    /* ---------------------------------------------------------------------- */

    *, *::before, *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    html,
    body {
        width: 100%;
        height: 100%;
    }

    body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
            "Segoe UI", sans-serif;
        font-size: 14px;
        line-height: 1.55;
        color: var(--text-primary);
        background:
            radial-gradient(circle at -10% -30%, rgba(59, 130, 246, 0.22), transparent 60%),
            radial-gradient(circle at 120% 0%, rgba(34, 197, 94, 0.24), transparent 58%),
            radial-gradient(circle at 50% 140%, rgba(0, 0, 0, 0.88), #020617 70%);
        display: flex;
        overflow: hidden;
    }

    img,
    video {
        max-width: 100%;
        display: block;
    }

    button {
        font: inherit;
        border: none;
        background: none;
        cursor: pointer;
    }

    input,
    textarea,
    select {
        font: inherit;
        color: inherit;
        background: transparent;
        border-radius: 0;
        border: none;
        outline: none;
    }

    a {
        color: inherit;
        text-decoration: none;
    }

    ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: #111827;
        border-radius: 999px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: #1f2937;
    }

    /* Utility classes ------------------------------------------------------- */

    .hidden {
        display: none !important;
    }

    .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    .text-soft {
        color: var(--text-secondary);
    }

    .text-muted {
        color: var(--text-muted);
    }

    .badge-pill {
        display: inline-flex;
        align-items: center;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(circle at 0 0, #020617, #020617 60%, #000 100%);
        color: var(--text-secondary);
    }

    .badge-pill--accent {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        border-color: transparent;
        color: #022c22;
        box-shadow: 0 16px 40px rgba(34, 197, 94, 0.85);
        font-weight: 700;
    }

    .tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 9px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid rgba(31, 41, 55, 0.9);
        background: radial-gradient(circle at 0 0, #020617, #020617 60%, #000 100%);
        color: var(--text-secondary);
    }

    .tag-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow:
            0 0 0 3px rgba(34, 197, 94, 0.35),
            0 0 22px rgba(34, 197, 94, 0.85);
    }

    .pill-switch {
        display: inline-flex;
        padding: 4px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 0, #020617, #020617 60%, #000 100%);
        border: 1px solid rgba(15, 23, 42, 0.95);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.9),
            0 18px 42px rgba(0, 0, 0, 0.9);
        gap: 2px;
    }

    .pill-switch__btn {
        padding: 7px 16px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            box-shadow var(--fast) ease-out,
            transform var(--fast) ease-out;
        white-space: nowrap;
    }

    .pill-switch__btn--active {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: #020617;
        box-shadow: var(--shadow-glow-accent);
        transform: translateY(-1px);
    }

    .pill-switch__btn:not(.pill-switch__btn--active):hover {
        background: rgba(15, 23, 42, 0.95);
        color: #e5e7eb;
    }

    /* ---------------------------------------------------------------------- */
    /*  ROOT LAYOUT: SIDEBAR + APP SHELL                                     */
    /* ---------------------------------------------------------------------- */

    .vision-root {
        display: flex;
        width: 100%;
        height: 100%;
        min-height: 0;
        min-width: 0;
        color: var(--text-primary);
    }

    /* Left navigation column ------------------------------------------------ */

    .vision-sidebar {
        width: var(--nav-width);
        flex-shrink: 0;
        background:
            radial-gradient(circle at 0 0, #020617, #020617 40%, #000 100%);
        border-right: 1px solid rgba(15, 23, 42, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 18px 0 16px;
        box-shadow: 22px 0 55px rgba(0, 0, 0, 0.96);
        z-index: 20;
    }

    .vision-sidebar__logo {
        width: 52px;
        height: 52px;
        border-radius: 999px;
        background: radial-gradient(circle at 20% 0, #22c55e, #0f172a 60%, #020617);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 24px;
        box-shadow:
            0 0 0 1px rgba(148, 163, 184, 0.4),
            0 24px 58px rgba(34, 197, 94, 0.9);
    }

    .vision-sidebar__logo-inner {
        width: 38px;
        height: 38px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 0, #020617, #000 70%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #bbf7d0;
        font-family: "Cinzel", serif;
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 0.12em;
    }

    .vision-nav {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        align-items: center;
        margin-bottom: 18px;
    }

    .vision-nav__item {
        width: 48px;
        height: 48px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        cursor: pointer;
        border: 1px solid transparent;
        background: radial-gradient(circle at 50% 0, rgba(15, 23, 42, 0.9), #020617 70%);
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            box-shadow var(--fast) ease-out,
            border-color var(--fast) ease-out,
            transform var(--fast) ease-out;
        position: relative;
    }

    .vision-nav__item svg {
        width: 24px;
        height: 24px;
        stroke-width: 1.6;
    }

    .vision-nav__item:hover {
        color: #e5e7eb;
        border-color: rgba(148, 163, 184, 0.75);
        box-shadow: 0 14px 32px rgba(15, 23, 42, 0.9);
        transform: translateY(-1px);
    }

    .vision-nav__item--active {
        color: #ecfeff;
        background: radial-gradient(circle at 20% 0, #22c55e, #0f172a 55%, #020617);
        border-color: rgba(34, 197, 94, 0.9);
        box-shadow:
            0 0 0 1px rgba(34, 197, 94, 0.8),
            0 20px 46px rgba(34, 197, 94, 0.95);
        transform: translateY(-1px);
    }

    .vision-nav__item--active::before {
        content: "";
        position: absolute;
        left: -12px;
        top: 10px;
        bottom: 10px;
        width: 3px;
        border-radius: 0 12px 12px 0;
        background: linear-gradient(180deg, #22c55e, #a7f3d0);
    }

    .vision-sidebar__footer {
        margin-top: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        width: 100%;
    }

    .vision-sidebar__credits {
        display: flex;
        flex-direction: column;
        align-items: center;
        font-size: 11px;
        color: var(--text-secondary);
    }

    .vision-sidebar__credits-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow:
            0 0 0 3px rgba(34, 197, 94, 0.4),
            0 0 24px rgba(34, 197, 94, 0.9);
        margin-bottom: 4px;
    }

    .vision-sidebar__sale {
        padding: 6px 9px;
        border-radius: 12px;
        background: linear-gradient(135deg, #22c55e, #a3e635);
        color: #052e16;
        font-size: 11px;
        font-weight: 800;
        text-align: center;
        line-height: 1.2;
        box-shadow: 0 16px 40px rgba(34, 197, 94, 0.8);
    }

    .vision-sidebar__user {
        width: 40px;
        height: 40px;
        border-radius: 999px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(circle at 20% 0, #020617, #020617 60%, #000 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        margin-top: 6px;
    }

    /* ---------------------------------------------------------------------- */
    /*  APP SHELL: TOP HEADER + MAIN SPLIT                                   */
    /* ---------------------------------------------------------------------- */

    .vision-app {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
        min-height: 0;
    }

    .vision-header {
        height: var(--header-height);
        flex-shrink: 0;
        padding: 0 22px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(15, 23, 42, 0.96);
        background:
            linear-gradient(
                135deg,
                rgba(15, 23, 42, 0.97),
                rgba(15, 23, 42, 0.94),
                rgba(15, 23, 42, 0.99)
            ),
            radial-gradient(circle at 0 0, rgba(59, 130, 246, 0.25), transparent 60%);
        backdrop-filter: blur(20px);
        box-shadow: 0 20px 55px rgba(0, 0, 0, 0.96);
        z-index: 10;
    }

    .vision-header__left {
        display: flex;
        align-items: center;
        gap: 18px;
        min-width: 0;
    }

    .vision-header__title-block {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .vision-header__title {
        font-size: 19px;
        font-weight: 700;
        letter-spacing: 0.06em;
        text-transform: uppercase;
    }

    .vision-header__subtitle {
        font-size: 11px;
        color: var(--text-secondary);
    }

    .vision-header__model-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 7px 16px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(15, 23, 42, 0.95);
        background: radial-gradient(circle at 20% 0, #020617, #020617 60%, #000 100%);
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.92),
            0 18px 42px rgba(0, 0, 0, 0.9);
    }

    .vision-header__model-pill-status {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow:
            0 0 0 3px rgba(34, 197, 94, 0.45),
            0 0 26px rgba(34, 197, 94, 0.95);
    }

    .vision-header__model-pill-chevron {
        width: 10px;
        height: 6px;
        stroke-width: 1.6;
    }

    .vision-header__tabs {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 24px;
        border-radius: var(--radius-pill);
        padding: 4px;
        border: 1px solid rgba(15, 23, 42, 0.96);
        background: radial-gradient(circle at 30% 0, #020617, #020617 60%, #000 100%);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.9),
            0 18px 42px rgba(0, 0, 0, 0.9);
    }

    .vision-header__tab {
        padding: 7px 18px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        color: var(--text-secondary);
        cursor: pointer;
        white-space: nowrap;
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            box-shadow var(--fast) ease-out,
            transform var(--fast) ease-out;
    }

    .vision-header__tab--active {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: #020617;
        box-shadow: var(--shadow-glow-accent);
        transform: translateY(-1px);
    }

    .vision-header__tab:not(.vision-header__tab--active):hover {
        background: rgba(15, 23, 42, 0.96);
        color: #e5e7eb;
    }

    .vision-header__right {
        display: flex;
        align-items: center;
        gap: 14px;
    }

    .vision-header__view-pills {
        display: inline-flex;
        align-items: center;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(15, 23, 42, 0.96);
        background: radial-gradient(circle at 30% 0, #020617, #020617 60%, #000 100%);
        padding: 4px;
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.9),
            0 18px 40px rgba(0, 0, 0, 0.9);
        gap: 2px;
    }

    .vision-header__view-btn {
        padding: 7px 16px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        cursor: pointer;
        white-space: nowrap;
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            box-shadow var(--fast) ease-out,
            transform var(--fast) ease-out;
    }

    .vision-header__view-btn--active {
        background: linear-gradient(135deg, #22c55e, #4ade80);
        color: #020617;
        box-shadow: var(--shadow-glow-accent);
        transform: translateY(-1px);
    }

    .vision-header__view-btn:not(.vision-header__view-btn--active):hover {
        background: rgba(15, 23, 42, 0.96);
        color: #e5e7eb;
    }

    .vision-header__favorites-toggle {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--text-secondary);
        margin-left: 8px;
        white-space: nowrap;
    }

    .vision-header__favorites-toggle input {
        accent-color: #9ca3af;
    }

    .vision-header__assets-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 18px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(148, 163, 184, 0.5);
        background: radial-gradient(circle at 30% 0, #020617, #020617 60%, #000 100%);
        font-size: 13px;
        font-weight: 600;
        color: #e5e7eb;
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.95),
            0 18px 40px rgba(0, 0, 0, 0.9);
        white-space: nowrap;
    }

    .vision-header__assets-btn svg {
        width: 18px;
        height: 18px;
        stroke-width: 1.5;
    }

    .vision-header__assets-btn:hover {
        border-color: rgba(209, 213, 219, 0.95);
    }

    /* ---------------------------------------------------------------------- */
    /*  MAIN AREA: CONFIG PANEL + STAGE                                      */
    /* ---------------------------------------------------------------------- */

    .vision-main {
        flex: 1;
        min-height: 0;
        min-width: 0;
        display: grid;
        grid-template-columns: minmax(var(--config-panel-min), var(--config-panel-max)) minmax(
                0,
                1fr
            );
        border-top: 1px solid rgba(15, 23, 42, 0.95);
    }

    .vision-config-panel {
        background: radial-gradient(circle at 0 0, #020617, #020617 60%, #000 100%);
        border-right: 1px solid rgba(15, 23, 42, 0.95);
        display: flex;
        flex-direction: column;
        min-height: 0;
        min-width: 0;
    }

    .vision-config-panel__body {
        flex: 1;
        min-height: 0;
        padding: 20px 22px 18px;
        overflow-y: auto;
    }

    .vision-config-panel__footer {
        flex-shrink: 0;
        padding: 12px 22px 18px;
        border-top: 1px solid rgba(15, 23, 42, 0.96);
        background: radial-gradient(circle at 0 0, #020617, #020617 60%, #000 100%);
        position: sticky;
        bottom: 0;
        z-index: 5;
    }

    .vision-stage {
        background: radial-gradient(circle at 100% 0, #020617, #020617 60%, #000 100%);
        display: flex;
        flex-direction: column;
        min-width: 0;
        min-height: 0;
    }

    .vision-stage__inner {
        flex: 1;
        min-height: 0;
        padding: 22px 22px 18px 22px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        overflow: hidden;
    }

    .vision-stage__toolbar {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        font-size: 12px;
        color: var(--text-secondary);
    }

    .vision-stage__toolbar-left {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    .vision-stage__toolbar-right {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: auto;
    }

    .vision-stage__toolbar-icon-btn {
        width: 34px;
        height: 34px;
        border-radius: 999px;
        border: 1px solid rgba(15, 23, 42, 0.96);
        background: radial-gradient(circle at 50% 0, #020617, #020617 60%, #000 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            border-color var(--fast) ease-out,
            box-shadow var(--fast) ease-out;
    }

    .vision-stage__toolbar-icon-btn svg {
        width: 16px;
        height: 16px;
        stroke-width: 1.5;
    }

    .vision-stage__toolbar-icon-btn:hover {
        border-color: rgba(148, 163, 184, 0.95);
        color: #e5e7eb;
        box-shadow: 0 16px 36px rgba(0, 0, 0, 0.9);
    }

    .vision-stage__actions {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 14px;
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 4px;
    }

    .vision-stage__action-link {
        display: inline-flex;
        align-items: center;
        gap: 7px;
        cursor: pointer;
    }

    .vision-stage__action-link--primary {
        color: #f9fafb;
        font-weight: 600;
    }

    .vision-stage__action-link:hover {
        color: #e5e7eb;
    }

    .vision-stage__divider-vertical {
        width: 1px;
        height: 16px;
        background: rgba(31, 41, 55, 0.95);
    }

    .vision-stage__feed-header {
        font-size: 15px;
        font-weight: 700;
        margin-top: 2px;
    }

    .vision-stage__feed-wrapper {
        flex: 1;
        min-height: 0;
        display: flex;
        gap: 16px;
        overflow: hidden;
    }

    .vision-stage__feed-scroll {
        flex: 1;
        min-height: 0;
        max-height: 100%;
        overflow-y: auto;
        padding-right: 4px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .vision-stage__history-rail {
        width: var(--history-rail-width);
        flex-shrink: 0;
        border-left: 1px solid rgba(15, 23, 42, 0.95);
        padding-left: 10px;
        margin-left: 8px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 100%;
        overflow-y: auto;
    }

    .vision-stage__history-thumb {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid transparent;
        cursor: pointer;
        opacity: 0.8;
        transition:
            border-color var(--fast) ease-out,
            box-shadow var(--fast) ease-out,
            opacity var(--fast) ease-out,
            transform var(--fast) ease-out;
        background: #020617;
    }

    .vision-stage__history-thumb img,
    .vision-stage__history-thumb video {
        width: 100%;
        aspect-ratio: 9 / 16;
        object-fit: cover;
        display: block;
    }

    .vision-stage__history-thumb-badge {
        position: absolute;
        bottom: 4px;
        right: 4px;
        padding: 2px 5px;
        border-radius: 999px;
        font-size: 9px;
        background: rgba(15, 23, 42, 0.96);
        color: #e5e7eb;
    }

    .vision-stage__history-thumb--active {
        opacity: 1;
        border-color: #22c55e;
        box-shadow:
            0 0 0 1px rgba(34, 197, 94, 0.8),
            0 0 22px rgba(34, 197, 94, 0.9);
        transform: translateY(-1px);
    }

    /* Card (preview item) base --------------------------------------------- */

    .vision-card {
        border-radius: 22px;
        border: 1px solid rgba(15, 23, 42, 0.95);
        background: radial-gradient(circle at 10% 0, #0b1120, #020617 70%);
        box-shadow:
            0 0 0 1px rgba(15, 23, 42, 0.95),
            0 26px 60px rgba(0, 0, 0, 0.96);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .vision-card__media {
        width: 100%;
        aspect-ratio: 16 / 9;
        background: #020617;
        overflow: hidden;
        position: relative;
    }

    .vision-card__media img,
    .vision-card__media video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .vision-card__media-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        padding: 10px 12px;
        background: linear-gradient(
            to top,
            rgba(15, 23, 42, 0.85),
            rgba(15, 23, 42, 0.6),
            transparent
        );
        pointer-events: none;
        color: #e5e7eb;
        font-size: 12px;
    }

    .vision-card__media-overlay-left {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .vision-card__media-overlay-right {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .vision-card__media-chip {
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.92);
        border: 1px solid rgba(31, 41, 55, 0.95);
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .vision-card__bottom {
        padding: 10px 12px 11px;
        border-top: 1px solid rgba(15, 23, 42, 0.95);
        background: radial-gradient(circle at 0 0, #020617, #020617 60%, #000 100%);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        font-size: 12px;
        color: var(--text-secondary);
    }

    .vision-card__title-block {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .vision-card__title {
        font-size: 13px;
        font-weight: 600;
        color: #e5e7eb;
    }

    .vision-card__meta {
        font-size: 11px;
        color: var(--text-muted);
    }

    .vision-card__actions {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }

    .vision-card__icon-btn {
        width: 28px;
        height: 28px;
        border-radius: 999px;
        border: 1px solid rgba(31, 41, 55, 0.95);
        background: radial-gradient(circle at 50% 0, #020617, #020617 60%, #000 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        transition:
            background var(--fast) ease-out,
            color var(--fast) ease-out,
            border-color var(--fast) ease-out,
            box-shadow var(--fast) ease-out;
    }

    .vision-card__icon-btn svg {
        width: 16px;
        height: 16px;
        stroke-width: 1.5;
    }

    .vision-card__icon-btn:hover {
        border-color: rgba(148, 163, 184, 0.95);
        color: #e5e7eb;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.9);
    }

    .vision-card--active {
        border-color: #22c55e;
        box-shadow:
            0 0 0 1px rgba(34, 197, 94, 0.8),
            0 26px 62px rgba(34, 197, 94, 0.9);
    }
    /* ====================================================================== */
/* SURGICAL ADDITIONS - Reference Previews & Ask SIA                     */
/* ====================================================================== */

/* Kling-style prominent reference image preview container */
.reference-preview-large {
    width: 100%;
    /* Default aspect, can be overridden via JS if needed */
    aspect-ratio: 16 / 9;
    background: #020617;
    border-radius: 14px;
    border: 1px solid rgba(31, 41, 55, 0.95);
    overflow: hidden;
    display: none; /* Hidden until image added */
    margin-bottom: 12px;
    position: relative;
}

/* Class added via JS when an image is loaded */
.reference-preview-large.has-image {
    display: block;
}

.reference-preview-large img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Ensure whole image is visible like Kling */
}

/* Small "Ask SIA" magic button next to prompt labels */
.ask-sia-prompt-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    border-radius: 6px;
    border: 1px solid rgba(34, 197, 94, 0.3);
    background: rgba(34, 197, 94, 0.1);
    color: #4ade80;
    cursor: pointer;
    transition: all 0.2s ease;
}

.ask-sia-prompt-btn:hover {
    background: rgba(34, 197, 94, 0.2);
    border-color: rgba(34, 197, 94, 0.6);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
}

.ask-sia-prompt-btn svg {
    width: 14px;
    height: 14px;
}

/* Label container to hold the label text and the new button */
.prompt-label-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
}
/* ====================================================================== */
/* SULANDRA UPLOAD BOX STYLE                                             */
/* ====================================================================== */

.sulandra-upload-box {
    width: 100%;
    aspect-ratio: 16 / 9; /* Cinematic shape */
    background: #0f172a;  /* Darker background */
    border-radius: 16px;
    border: 1px dashed rgba(51, 65, 85, 0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.2s ease;
    margin-bottom: 16px;
    text-align: center;
}

.sulandra-upload-box:hover {
    border-color: #22c55e; /* Green accent on hover */
    background: #1e293b;
}

/* The Placeholder content (Icon + Text) */
.sulandra-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    color: #9ca3af;
    pointer-events: none; /* Clicks pass through to the label */
    padding: 20px;
}

.sulandra-placeholder svg {
    width: 32px;
    height: 32px;
    color: #4ade80; /* Accent color icon */
    opacity: 0.8;
}

.sulandra-placeholder-title {
    font-size: 13px;
    font-weight: 600;
    color: #e5e7eb;
}

.sulandra-placeholder-sub {
    font-size: 11px;
    color: #64748b;
}

/* The Image Preview (Hidden by default) */
.sulandra-preview-img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: contain; /* Show full image */
    background: #000;
    z-index: 10;
    display: none;
}

/* State: When file is selected */
.sulandra-upload-box.has-file .sulandra-preview-img {
    display: block;
}

.sulandra-upload-box.has-file .sulandra-placeholder {
    display: none;
}

/* Remove button (appears on hover when file exists) */
.sulandra-remove-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 20;
    border: 1px solid rgba(255,255,255,0.2);
}

.sulandra-upload-box.has-file:hover .sulandra-remove-btn {
    display: flex;
}
/* Compact version for dual frames and list items */
.sulandra-upload-box.compact {
    aspect-ratio: 16 / 9;
    min-height: 80px;
    margin-bottom: 8px;
}

.sulandra-upload-box.compact .sulandra-placeholder {
    padding: 10px;
    gap: 4px;
}

.sulandra-upload-box.compact .sulandra-placeholder svg {
    width: 20px;
    height: 20px;
}

.sulandra-upload-box.compact .sulandra-placeholder-title {
    font-size: 11px;
}

.sulandra-upload-box.compact .sulandra-placeholder-sub {
    display: none; /* Hide subtitle to save space */
}
/* ====================================================================== */
/* ASK SIA - SIDE PANEL & STYLES                                        */
/* ====================================================================== */

.ask-sia-panel-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none; /* Hidden by default */
    justify-content: flex-end;
    z-index: 99999; /* Above everything */
    backdrop-filter: blur(2px);
}

.ask-sia-panel {
    width: 380px;
    max-width: 90%;
    height: 100%;
    background: radial-gradient(circle at 0% 0%, rgba(69,241,255,0.1), transparent 60%),
                radial-gradient(circle at 100% 100%, rgba(34, 197, 94, 0.1), transparent 60%),
                #020617;
    border-left: 1px solid rgba(255,255,255,0.1);
    box-shadow: -8px 0 40px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    padding: 16px;
    animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideInRight {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

.ask-sia-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.ask-sia-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    font-weight: 700;
    color: #e5e7eb;
}

.ask-sia-icon-large {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: conic-gradient(from 210deg, #ff5af1, #45f1ff, #ffd15a, #ff5af1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 800;
    color: #000;
    box-shadow: 0 0 15px rgba(69,241,255,0.5);
}

.ask-sia-close {
    cursor: pointer;
    color: #9ca3af;
    padding: 4px;
}
.ask-sia-close:hover { color: #fff; }

.ask-sia-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
}

.ask-sia-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #6b7280;
    margin-bottom: 6px;
}

.ask-sia-context-box {
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 10px;
    font-size: 11px;
    color: #9ca3af;
    font-family: 'JetBrains Mono', monospace;
}

.ask-sia-textarea {
    width: 100%;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px;
    padding: 10px;
    color: #fff;
    font-size: 12px;
    resize: vertical;
    min-height: 80px;
}
.ask-sia-textarea:focus { border-color: #4ade80; }

.ask-sia-answer-box {
    flex: 1;
    background: rgba(34, 197, 94, 0.03);
    border: 1px solid rgba(34, 197, 94, 0.15);
    border-radius: 10px;
    padding: 12px;
    font-size: 12px;
    color: #e5e7eb;
    line-height: 1.6;
}

.ask-sia-main-btn {
    width: 100%;
    padding: 10px;
    border-radius: 99px;
    background: linear-gradient(135deg, #22c55e, #4ade80);
    color: #022c22;
    font-weight: 600;
    font-size: 12px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}
.ask-sia-main-btn:hover { opacity: 0.9; transform: translateY(-1px); }
/* ====================================================================== */
/* ASK SIA - SIDE PANEL STYLES                                            */
/* ====================================================================== */

.ask-sia-panel-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none; /* Hidden by default */
    justify-content: flex-end;
    z-index: 99999;
    backdrop-filter: blur(2px);
}

.ask-sia-panel {
    width: 380px;
    max-width: 90%;
    height: 100%;
    background: radial-gradient(circle at 0% 0%, rgba(69,241,255,0.1), transparent 60%),
                radial-gradient(circle at 100% 100%, rgba(34, 197, 94, 0.1), transparent 60%),
                #020617;
    border-left: 1px solid rgba(255,255,255,0.1);
    box-shadow: -8px 0 40px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
    padding: 16px;
    animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideInRight {
    from { transform: translateX(100%); }
    to { transform: translateX(0); }
}

.ask-sia-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.ask-sia-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    font-weight: 700;
    color: #e5e7eb;
}

.ask-sia-icon-large {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: conic-gradient(from 210deg, #ff5af1, #45f1ff, #ffd15a, #ff5af1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 800;
    color: #000;
    box-shadow: 0 0 15px rgba(69,241,255,0.5);
}

.ask-sia-close {
    cursor: pointer;
    color: #9ca3af;
    padding: 4px;
}
.ask-sia-close:hover { color: #fff; }

.ask-sia-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
}

.ask-sia-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #6b7280;
    margin-bottom: 6px;
}

.ask-sia-context-box {
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    padding: 10px;
    font-size: 11px;
    color: #9ca3af;
    font-family: 'JetBrains Mono', monospace;
    max-height: 100px;
    overflow-y: auto;
}

.ask-sia-textarea {
    width: 100%;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px;
    padding: 10px;
    color: #fff;
    font-size: 12px;
    resize: vertical;
    min-height: 80px;
}
.ask-sia-textarea:focus { border-color: #4ade80; }

.ask-sia-answer-box {
    flex: 1;
    background: rgba(34, 197, 94, 0.03);
    border: 1px solid rgba(34, 197, 94, 0.15);
    border-radius: 10px;
    padding: 12px;
    font-size: 12px;
    color: #e5e7eb;
    line-height: 1.6;
    overflow-y: auto;
}

.ask-sia-main-btn {
    width: 100%;
    padding: 10px;
    border-radius: 99px;
    background: linear-gradient(135deg, #22c55e, #4ade80);
    color: #022c22;
    font-weight: 600;
    font-size: 12px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
}
/* ====================================================================== */
/* SULANDRA NEON TRIGGER (Sparkling Text)                                */
/* ====================================================================== */

.sulandra-neon-trigger {
    font-family: 'Cinzel', serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #e2e8f0;
    cursor: pointer;
    text-transform: uppercase;
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    margin-left: auto; /* Push to right */
    
    /* The Neon Glow */
    text-shadow: 
        0 0 2px rgba(255,255,255,0.8),
        0 0 8px rgba(34, 197, 94, 0.8),
        0 0 15px rgba(34, 197, 94, 0.6);
    
    transition: all 0.3s ease;
    animation: sulandra-pulse 3s infinite alternate;
}

/* Sparkle icon pseudo-element */
.sulandra-neon-trigger::before {
    content: "✦";
    font-size: 10px;
    color: #86efac;
    text-shadow: 0 0 5px #fff;
    animation: sulandra-sparkle 1.5s infinite linear;
}

.sulandra-neon-trigger:hover {
    color: #fff;
    text-shadow: 
        0 0 4px #fff,
        0 0 10px #4ade80,
        0 0 20px #4ade80,
        0 0 30px #22c55e;
    transform: scale(1.02);
}

@keyframes sulandra-pulse {
    0% { opacity: 0.9; }
    100% { opacity: 1; text-shadow: 0 0 4px #fff, 0 0 12px #22c55e, 0 0 25px #22c55e; }
}

@keyframes sulandra-sparkle {
    0% { opacity: 0.5; transform: scale(0.8) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
    100% { opacity: 0.5; transform: scale(0.8) rotate(360deg); }
}
/* ====================================================================== */
/* SULANDRA NEON TRIGGER (Sparkling Text)                                */
/* ====================================================================== */

.sulandra-neon-trigger {
    font-family: 'Cinzel', serif; /* Matches your logo font for elegance */
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.08em;
    color: #e2e8f0;
    cursor: pointer;
    text-transform: uppercase;
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    
    /* The Neon Glow */
    text-shadow: 
        0 0 2px rgba(255,255,255,0.8),
        0 0 8px rgba(34, 197, 94, 0.8),
        0 0 15px rgba(34, 197, 94, 0.6);
    
    transition: all 0.3s ease;
    animation: sulandra-pulse 3s infinite alternate;
}

/* Sparkle icon (optional pseudo-element) */
.sulandra-neon-trigger::before {
    content: "✦";
    font-size: 10px;
    color: #86efac; /* Lighter green */
    text-shadow: 0 0 5px #fff;
    animation: sulandra-sparkle 1.5s infinite linear;
}

.sulandra-neon-trigger:hover {
    color: #fff;
    text-shadow: 
        0 0 4px #fff,
        0 0 10px #4ade80,
        0 0 20px #4ade80,
        0 0 30px #22c55e;
    transform: scale(1.02);
}

@keyframes sulandra-pulse {
    0% { opacity: 0.9; }
    100% { opacity: 1; text-shadow: 0 0 4px #fff, 0 0 12px #22c55e, 0 0 25px #22c55e; }
}

@keyframes sulandra-sparkle {
    0% { opacity: 0.5; transform: scale(0.8) rotate(0deg); }
    50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
    100% { opacity: 0.5; transform: scale(0.8) rotate(360deg); }
}
</style>
</head>
<body>
<div class="vision-root">

    <!-- =============================================================== -->
    <!--  LEFT SIDEBAR – Sulandra Nav                                   -->
    <!-- =============================================================== -->
    <aside class="vision-sidebar">
        <div class="vision-sidebar__logo">
            <div class="vision-sidebar__logo-inner">
                S
            </div>
        </div>

        <nav class="vision-nav" aria-label="Main navigation">
            <!-- Home / Feed -->
            <button class="vision-nav__item" data-nav="home" title="Home">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M4 11L12 4L20 11" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6 10.5V19H10.5V14.5H13.5V19H18V10.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>

            <!-- Vision Lab (current) -->
<button class="vision-nav__item vision-nav__item--active" data-lab-nav="image" title="Image Lab">
    <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.5"/><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/><path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
</button>

<button class="vision-nav__item" data-lab-nav="video" title="Video Lab">
    <svg viewBox="0 0 24 24" fill="none"><path d="M15 10L20 7V17L15 14V10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="6" width="11" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/></svg>
</button>

<button class="vision-nav__item" data-lab-nav="shortfilm" title="Short Film Lab">
    <svg viewBox="0 0 24 24" fill="none"><path d="M19.82 2H4.18C2.97602 2 2 2.97602 2 4.18V19.82C2 21.024 2.97602 22 4.18 22H19.82C21.024 22 22 21.024 22 19.82V4.18C22 2.97602 21.024 2 19.82 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 2V22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 2V22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12H22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 17H22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M17 7H22" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
</button>

            <!-- Sound Lab placeholder -->
            <button class="vision-nav__item" data-nav="sound" title="Sound Lab">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M5 9V15" stroke="currentColor" stroke-linecap="round"/>
                    <path d="M9 7V17" stroke="currentColor" stroke-linecap="round"/>
                    <path d="M13 5V19" stroke="currentColor" stroke-linecap="round"/>
                    <path d="M17 8V16" stroke="currentColor" stroke-linecap="round"/>
                </svg>
            </button>

            <!-- Studio placeholder -->
            <button class="vision-nav__item" data-nav="studio" title="Sulandra Studio">
                <svg viewBox="0 0 24 24" fill="none">
                    <rect x="3.5" y="4.5" width="17" height="15" rx="2" stroke="currentColor"/>
                    <path d="M3.5 9.5H20.5" stroke="currentColor"/>
                    <path d="M10 14H14" stroke="currentColor" stroke-linecap="round"/>
                </svg>
            </button>

            <!-- Explore / School placeholder -->
            <button class="vision-nav__item" data-nav="school" title="Sulandra School of Arts">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M4 9L12 4L20 9L12 14L4 9Z" stroke="currentColor" stroke-linejoin="round"/>
                    <path d="M6 10.5V15.5C8 18 10 19 12 19C14 19 16 18 18 15.5V10.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </nav>

        <div class="vision-sidebar__footer">
            <div class="vision-sidebar__credits">
                <div class="vision-sidebar__credits-dot"></div>
                <div>Sulandra Creative Network</div>
                <div class="text-muted" style="font-size:10px;">Vision · RunPod · SIA Brain</div>
            </div>
            <div class="vision-sidebar__sale">
                SAVE<br>50% OFF
            </div>
            <div class="vision-sidebar__user" title="Account">
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="9" r="3" stroke="currentColor"/>
                    <path d="M6 19C7.5 16.5 9.5 15.25 12 15.25C14.5 15.25 16.5 16.5 18 19" stroke="currentColor" stroke-linecap="round"/>
                </svg>
            </div>
        </div>
    </aside>

    <!-- =============================================================== -->
    <!--  APP SHELL – HEADER & MAIN SPLIT                               -->
    <!-- =============================================================== -->
    <div class="vision-app">

        <!-- =========================================================== -->
        <!--  TOP HEADER                                                 -->
        <!-- =========================================================== -->
        <header class="vision-header">
            <div class="vision-header__left">
                <div class="vision-header__title-block">
                    <div class="vision-header__title">Sulandra Vision Lab</div>
                    <div class="vision-header__subtitle">
                        Unified AI Image · Video · Short Film generator – powered by Sulandra on RunPod
                    </div>
                </div>

                <!-- Model pill -->
                <button class="vision-header__model-pill" type="button" id="model-pill">
                    <span class="vision-header__model-pill-status"></span>
                    <span>Sulandra Vision Flux&nbsp;2.0</span>
                    <svg class="vision-header__model-pill-chevron" viewBox="0 0 12 8" fill="none">
                        <path d="M2 2L6 6L10 2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <!-- Main lab tabs -->
               
            </div>

            <div class="vision-header__right">
                <!-- Create / View toggle -->
                <div class="vision-header__view-pills" id="mode-toggle">
                    <button
                        class="vision-header__view-btn vision-header__view-btn--active"
                        data-mode="create"
                        type="button"
                    >
                        Create
                    </button>
                    <button
                        class="vision-header__view-btn"
                        data-mode="view"
                        type="button"
                    >
                        My Files
                    </button>
                </div>

                <!-- Favorites toggle -->
                <label class="vision-header__favorites-toggle">
                    <input type="checkbox" id="favorites-toggle-checkbox" />
                    <span>Show favorites only</span>
                </label>

                <!-- Assets button (opens assets panel / right drawer later) -->
                <button class="vision-header__assets-btn" type="button" id="open-assets-btn">
                    <svg viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="4" width="18" height="16" rx="2" stroke="currentColor"/>
                        <path d="M3 9H21" stroke="currentColor"/>
                        <path d="M9 14H15" stroke="currentColor" stroke-linecap="round"/>
                    </svg>
                    <span>Assets</span>
                </button>
            </div>
        </header>

        <!-- =========================================================== -->
        <!--  MAIN AREA – CONFIG PANEL + STAGE                          -->
        <!-- =========================================================== -->
        <main class="vision-main">

            <!-- ======================================================= -->
            <!--  LEFT: CONFIG PANEL (per-lab controls)                 -->
            <!-- ======================================================= -->
            <section class="vision-config-panel" aria-label="Generation controls">
                <div class="vision-config-panel__body">

                    <!-- =================================================== -->
                    <!--  IMAGE LAB CONFIG                                   -->
                    <!-- =================================================== -->
<div class="lab-config" id="lab-config-image" data-lab="image">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <div>
            <div style="font-size:15px;font-weight:600;">Image Generator</div>
            <div class="text-muted" style="font-size:12px;margin-top:2px;">
                Text-to-Image · Image-to-Image · Styles · Aspect ratios
            </div>
        </div>
        <div class="pill-switch" id="image-mode-switch">
            <button type="button" class="pill-switch__btn pill-switch__btn--active" data-image-mode="text">Text → Image</button>
            <button type="button" class="pill-switch__btn" data-image-mode="image">Image → Image</button>
        </div>
    </div>

    <div id="image-reference-block" style="margin-bottom:16px; display:none;">
        <div class="text-soft" style="font-size:12px;margin-bottom:6px;">Reference image</div>
        <label class="sulandra-upload-box" id="image-upload-box" for="image-reference-input">
            <div class="sulandra-placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 5V19M5 12H19" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <div>
                    <div class="sulandra-placeholder-title">Add a start image</div>
                    <div class="sulandra-placeholder-sub">Click to upload (JPG/PNG)</div>
                </div>
            </div>
            <img id="image-preview-img" class="sulandra-preview-img" alt="Reference Preview" />
            <button type="button" class="sulandra-remove-btn" onclick="clearReference('image'); event.preventDefault();">×</button>
            <input id="image-reference-input" type="file" accept="image/*" class="visually-hidden" />
        </label>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;">
        <div>
            <div class="prompt-label-row">
                <label for="image-main-prompt" class="text-soft" style="font-size:12px;">Prompt</label>
                <span class="sulandra-neon-trigger" data-target-prompt="image-main-prompt">Ask SIA</span>
            </div>
            <div style="margin-top:6px;">
                <textarea id="image-main-prompt" rows="4" placeholder="Describe the image you want Sulandra to create..." style="width:100%;border-radius:16px;border:1px solid rgba(31,41,55,0.95);padding:10px 12px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);resize:vertical;min-height:90px;"></textarea>
            </div>
        </div>

        <div>
            <div class="prompt-label-row">
                <label for="image-negative-prompt" class="text-soft" style="font-size:12px;">Negative prompt</label>
                <span class="sulandra-neon-trigger" data-target-prompt="image-negative-prompt">Ask SIA</span>
            </div>
            <div style="margin-top:6px;">
                <textarea id="image-negative-prompt" rows="2" placeholder="Things to avoid (blur, watermark, distortion, etc.)" style="width:100%;border-radius:14px;border:1px solid rgba(31,41,55,0.95);padding:8px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);resize:vertical;min-height:60px;"></textarea>
            </div>
        </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:14px;">
        <div style="display:flex;gap:10px;">
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Aspect ratio</div>
                <div class="pill-switch" id="image-aspect-switch">
                    <button type="button" class="pill-switch__btn pill-switch__btn--active" data-image-aspect="1:1">1:1</button>
                    <button type="button" class="pill-switch__btn" data-image-aspect="16:9">16:9</button>
                    <button type="button" class="pill-switch__btn" data-image-aspect="9:16">9:16</button>
                </div>
            </div>
        </div>
        <div style="display:flex;gap:10px;">
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Style preset</div>
                <select id="image-style-select" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 12px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;">
                    <option value="natural">Natural photo</option>
                    <option value="cinematic">Cinematic</option>
                    <option value="anime">Anime / Stylized</option>
                    <option value="digital-art">Digital art</option>
                    <option value="3d">3D render</option>
                    <option value="illustration">Illustration</option>
                </select>
            </div>
            <div style="width:120px;">
                <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Guidance</div>
                <input type="range" id="image-guidance-slider" min="1" max="20" value="7" style="width:100%;" />
                <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-muted);margin-top:2px;">
                    <span>Loose</span><span id="image-guidance-value">7</span><span>Strict</span>
                </div>
            </div>
        </div>
    </div>

    <div style="display:flex;gap:10px;margin-bottom:10px;">
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Steps</div>
            <input type="number" id="image-steps-input" value="30" min="10" max="80" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;" />
        </div>
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Seed</div>
            <input type="number" id="image-seed-input" placeholder="Random" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;" />
        </div>
    </div>

    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;font-size:11px;color:var(--text-muted);">
        <div><span id="image-estimate-res">1024 × 1024</span><span>&nbsp;•</span><span id="image-estimate-cost">~1 credit</span></div>
        <button type="button" id="image-toggle-advanced" style="border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:4px 8px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:11px;">Advanced settings</button>
    </div>

    <div id="image-advanced-panel" class="hidden" style="margin-top:8px;font-size:11px;color:var(--text-secondary);border-radius:14px;border:1px solid rgba(31,41,55,0.95);padding:8px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);">
        <div style="display:flex;flex-direction:column;gap:6px;">
            <label><input type="checkbox" id="image-enable-upscale" /><span>&nbsp;Upscale after generation</span></label>
            <label><input type="checkbox" id="image-enable-face-fix" /><span>&nbsp;Face enhancement</span></label>
            <label><input type="checkbox" id="image-enable-tiling" /><span>&nbsp;Seamless tiling</span></label>
        </div>
    </div>
</div>

                    <!-- =================================================== -->
                    <!--  VIDEO LAB CONFIG                                   -->
                    <!-- =================================================== -->
                   <div class="lab-config hidden" id="lab-config-video" data-lab="video">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <div>
            <div style="font-size:15px;font-weight:600;">Video Generator</div>
            <div class="text-muted" style="font-size:12px;margin-top:2px;">
                Text-to-Video · Image-to-Video · Native audio · Durations
            </div>
        </div>
        <div class="pill-switch" id="video-mode-switch">
            <button type="button" class="pill-switch__btn pill-switch__btn--active" data-video-mode="text">Text → Video</button>
            <button type="button" class="pill-switch__btn" data-video-mode="image">Image → Video</button>
        </div>
    </div>

    <div id="video-reference-block" style="margin-bottom:16px; display:none;">
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:6px;">Start Frame</div>
                <label class="sulandra-upload-box compact" id="video-start-box" for="video-start-input">
                    <div class="sulandra-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M5 12h14M5 12l6-6m-6 6l6 6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <div class="sulandra-placeholder-title">Start Image</div>
                    </div>
                    <img id="video-start-img" class="sulandra-preview-img" alt="Start Preview" />
                    <button type="button" class="sulandra-remove-btn" onclick="clearReference('video-start'); event.preventDefault();">×</button>
                    <input id="video-start-input" type="file" accept="image/*" class="visually-hidden" />
                </label>
            </div>
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:6px;">End Frame (Opt)</div>
                <label class="sulandra-upload-box compact" id="video-end-box" for="video-end-input">
                    <div class="sulandra-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 12H5m14 0l-6-6m6 6l-6 6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <div class="sulandra-placeholder-title">End Image</div>
                    </div>
                    <img id="video-end-img" class="sulandra-preview-img" alt="End Preview" />
                    <button type="button" class="sulandra-remove-btn" onclick="clearReference('video-end'); event.preventDefault();">×</button>
                    <input id="video-end-input" type="file" accept="image/*" class="visually-hidden" />
                </label>
            </div>
        </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px;">
        <div>
            <div class="prompt-label-row">
                <label for="video-main-prompt" class="text-soft" style="font-size:12px;">Prompt</label>
                <span class="sulandra-neon-trigger" data-target-prompt="video-main-prompt">Ask SIA</span>
            </div>
            <div style="margin-top:6px;">
                <textarea id="video-main-prompt" rows="4" placeholder="Describe the motion, camera moves, and scene for the video..." style="width:100%;border-radius:16px;border:1px solid rgba(31,41,55,0.95);padding:10px 12px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);resize:vertical;min-height:90px;"></textarea>
            </div>
        </div>
        <div>
            <div class="prompt-label-row">
                <label for="video-negative-prompt" class="text-soft" style="font-size:12px;">Negative prompt</label>
                <span class="sulandra-neon-trigger" data-target-prompt="video-negative-prompt">Ask SIA</span>
            </div>
            <div style="margin-top:6px;">
                <textarea id="video-negative-prompt" rows="2" placeholder="Things to avoid (camera shake, artifacts, jitter, etc.)" style="width:100%;border-radius:14px;border:1px solid rgba(31,41,55,0.95);padding:8px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);resize:vertical;min-height:60px;"></textarea>
            </div>
        </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:14px;">
        <div style="display:flex;gap:10px;">
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Duration</div>
                <select id="video-duration-select" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 12px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;">
                    <option value="5">5 seconds</option>
                    <option value="10" selected>10 seconds</option>
                    <option value="15">15 seconds</option>
                    <option value="20">20 seconds</option>
                </select>
            </div>
            <div style="flex:1;">
                <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Aspect ratio</div>
                <div class="pill-switch" id="video-aspect-switch">
                    <button type="button" class="pill-switch__btn pill-switch__btn--active" data-video-aspect="16:9">16:9</button>
                    <button type="button" class="pill-switch__btn" data-video-aspect="9:16">9:16</button>
                    <button type="button" class="pill-switch__btn" data-video-aspect="1:1">1:1</button>
                </div>
            </div>
        </div>
        <div style="display:flex;gap:10px;align-items:flex-end;">
            <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-secondary);">
                <input type="checkbox" id="video-native-audio-checkbox" />
                <span>Generate native audio</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-secondary);">
                <input type="checkbox" id="video-loop-checkbox" />
                <span>Loop-friendly motion</span>
            </label>
        </div>
    </div>
    <div style="display:flex;gap:10px;margin-bottom:10px;">
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Steps / quality</div>
            <input type="number" id="video-steps-input" value="30" min="12" max="80" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;" />
        </div>
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Seed</div>
            <input type="number" id="video-seed-input" placeholder="Random" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;" />
        </div>
    </div>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;font-size:11px;color:var(--text-muted);">
        <div><span id="video-estimate-res">720p</span><span>&nbsp;•</span><span id="video-estimate-cost">~3 credits</span></div>
        <button type="button" id="video-toggle-advanced" style="border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:4px 8px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:11px;">Advanced motion</button>
    </div>
    <div id="video-advanced-panel" class="hidden" style="margin-top:8px;font-size:11px;color:var(--text-secondary);border-radius:14px;border:1px solid rgba(31,41,55,0.95);padding:8px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);">
        <div style="display:flex;flex-direction:column;gap:6px;">
            <label><input type="checkbox" id="video-cam-move-checkbox" /><span>&nbsp;Enable cinematic camera moves</span></label>
            <label><input type="checkbox" id="video-stabilize-checkbox" /><span>&nbsp;Extra stabilization</span></label>
            <label><input type="checkbox" id="video-high-fps-checkbox" /><span>&nbsp;Higher FPS (slightly slower)</span></label>
        </div>
    </div>
</div>

                    <!-- =================================================== -->
                    <!--  SHORT FILM LAB CONFIG                             -->
                    <!-- =================================================== -->
 <div class="lab-config hidden" id="lab-config-shortfilm" data-lab="shortfilm">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <div>
            <div style="font-size:15px;font-weight:600;">Short Film Builder</div>
            <div class="text-muted" style="font-size:12px;margin-top:2px;">
                Multi-segment storytelling · Scenes · Transitions · Narrative prompts
            </div>
        </div>
        <div class="badge-pill">
            <span class="tag-dot"></span>
            <span>Storyboard mode</span>
        </div>
    </div>

    <div style="margin-bottom:16px;">
        <div class="text-soft" style="font-size:12px;margin-bottom:6px;">Style Reference (Optional)</div>
        <label class="sulandra-upload-box" id="shortfilm-upload-box" for="shortfilm-reference-input">
            <div class="sulandra-placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <div>
                    <div class="sulandra-placeholder-title">Set film style</div>
                    <div class="sulandra-placeholder-sub">Upload an image to guide the look</div>
                </div>
            </div>
            <img id="shortfilm-preview-img" class="sulandra-preview-img" alt="Reference Preview" />
            <button type="button" class="sulandra-remove-btn" onclick="clearReference('shortfilm'); event.preventDefault();">×</button>
            <input id="shortfilm-reference-input" type="file" accept="image/*" class="visually-hidden" />
        </label>
    </div>

    <div class="prompt-label-row">
        <div class="text-soft" style="font-size:12px;">Film title &amp; global prompt</div>
        <span class="sulandra-neon-trigger" data-target-prompt="shortfilm-global-prompt">Ask SIA</span>
    </div>
    <input id="shortfilm-title-input" type="text" placeholder="Title of your short film" style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);font-size:12px;margin-bottom:8px;" />
    <textarea id="shortfilm-global-prompt" rows="3" placeholder="Describe the overall story, tone, characters, and style..." style="width:100%;border-radius:14px;border:1px solid rgba(31,41,55,0.95);padding:8px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);resize:vertical;min-height:70px;margin-bottom:12px;"></textarea>

    <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Segments</div>
    <div id="shortfilm-segments-container" style="display:flex;flex-direction:column;gap:8px;margin-bottom:10px;"></div>

    <button type="button" id="shortfilm-add-segment-btn" style="width:100%;border-radius:12px;border:1px dashed rgba(55,65,81,0.9);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-secondary);font-size:12px;display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:12px;">
        <svg viewBox="0 0 24 24" fill="none" style="width:16px;height:16px;"><path d="M12 5V19" stroke="currentColor" stroke-linecap="round"/><path d="M5 12H19" stroke="currentColor" stroke-linecap="round"/></svg>
        <span>Add segment</span>
    </button>

    <div style="display:flex;gap:10px;margin-bottom:10px;font-size:11px;color:var(--text-secondary);">
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Aspect ratio</div>
            <div class="pill-switch" id="shortfilm-aspect-switch">
                <button type="button" class="pill-switch__btn pill-switch__btn--active" data-shortfilm-aspect="16:9">16:9</button>
                <button type="button" class="pill-switch__btn" data-shortfilm-aspect="9:16">9:16</button>
            </div>
        </div>
        <div style="flex:1;">
            <div class="text-soft" style="font-size:12px;margin-bottom:4px;">Total length</div>
            <div id="shortfilm-total-length">~ 20 sec</div>
            <div class="text-muted" style="font-size:10px;">Based on segment durations</div>
        </div>
    </div>
</div>
                    <!-- =================================================== -->
                    <!--  MY FILES / ASSETS CONFIG                          -->
                    <!-- =================================================== -->
                    <div class="lab-config hidden" id="lab-config-assets" data-lab="assets">
                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
                            <div>
                                <div style="font-size:15px;font-weight:600;">My Files</div>
                                <div class="text-muted" style="font-size:12px;margin-top:2px;">
                                    Browse images, videos, and short films created in Sulandra Vision Lab
                                </div>
                            </div>
                            <div class="pill-switch" id="assets-type-switch">
                                <button
                                    type="button"
                                    class="pill-switch__btn pill-switch__btn--active"
                                    data-assets-type="images"
                                >
                                    Images
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-assets-type="videos"
                                >
                                    Videos
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-assets-type="films"
                                >
                                    Films
                                </button>
                            </div>
                        </div>

                        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;font-size:11px;color:var(--text-secondary);">
                            <div style="display:flex;align-items:center;gap:8px;">
                                <div class="tag">
                                    <span class="tag-dot"></span>
                                    <span id="assets-count-label">0 items</span>
                                </div>
                                <label style="display:flex;align-items:center;gap:4px;">
                                    <input type="checkbox" id="assets-favorites-only" />
                                    <span>Favorites only</span>
                                </label>
                            </div>
                            <div class="pill-switch" id="assets-layout-switch">
                                <button
                                    type="button"
                                    class="pill-switch__btn pill-switch__btn--active"
                                    data-assets-layout="grid"
                                >
                                    Grid
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-assets-layout="list"
                                >
                                    List
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom:10px;">
                            <input
                                id="assets-search-input"
                                type="text"
                                placeholder="Search by prompt, tag, or date..."
                                style="width:100%;border-radius:999px;border:1px solid rgba(31,41,55,0.95);padding:7px 10px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);color:var(--text-primary);font-size:12px;"
                            />
                        </div>

                        <div
                            id="assets-list-container"
                            style="border-radius:16px;border:1px solid rgba(31,41,55,0.95);padding:6px 2px 6px 0;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);max-height:340px;overflow-y:auto;"
                        >
                            <!-- Assets list items will be populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- ======================================================= -->
                <!--  CONFIG PANEL FOOTER – Generate buttons                -->
                <!-- ======================================================= -->
                <div class="vision-config-panel__footer">
                    <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px;">
                        <div style="display:flex;flex-direction:column;gap:3px;font-size:11px;color:var(--text-secondary);">
                            <div>
                                <span>Credits: </span>
                                <span class="badge-pill badge-pill--accent" id="credits-pill">
                                    <span>SAFE</span>&nbsp;·&nbsp;<span id="credits-count">671</span>
                                </span>
                            </div>
                            <div class="text-muted" style="font-size:10px;">
                                Powered by Sulandra on RunPod · SIA Brain connected
                            </div>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <button
                                type="button"
                                id="btn-random-prompt"
                                class="vision-card__icon-btn"
                                title="Random idea"
                            >
                                <svg viewBox="0 0 24 24" fill="none">
                                    <path d="M6 7H9L11 10L13 14L15 17H18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M13 10L15 7H18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M18 4V7H21" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6 17H9L11 14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6 20V17H3" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>

                            <button
                                type="button"
                                id="btn-generate"
                                style="padding:9px 24px;border-radius:999px;border:none;background:linear-gradient(135deg,#22c55e,#4ade80);color:#022c22;font-size:13px;font-weight:700;box-shadow:0 20px 52px rgba(34,197,94,0.95);display:inline-flex;align-items:center;gap:8px;"
                            >
                                <span id="btn-generate-label">Generate</span>
                                <span style="font-size:11px;opacity:0.9;" id="btn-generate-mode-label">(Image)</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ======================================================= -->
            <!--  RIGHT: STAGE / PREVIEW                                -->
            <!-- ======================================================= -->
            <section class="vision-stage" aria-label="Preview & history">
                <div class="vision-stage__inner">

                    <!-- Stage toolbar row -->
                    <div class="vision-stage__toolbar">
                        <div class="vision-stage__toolbar-left">
                            <!-- Gallery filter tabs -->
                            <div class="pill-switch" id="gallery-filter-switch">
                                <button
                                    type="button"
                                    class="pill-switch__btn pill-switch__btn--active"
                                    data-gallery-filter="all"
                                >
                                    All
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-gallery-filter="images"
                                >
                                    Images
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-gallery-filter="videos"
                                >
                                    Videos
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-gallery-filter="films"
                                >
                                    Films
                                </button>
                            </div>

                            <!-- View type (grid vs vertical) -->
                            <div class="pill-switch" id="gallery-layout-switch">
                                <button
                                    type="button"
                                    class="pill-switch__btn pill-switch__btn--active"
                                    data-gallery-layout="grid"
                                >
                                    Grid
                                </button>
                                <button
                                    type="button"
                                    class="pill-switch__btn"
                                    data-gallery-layout="vertical"
                                >
                                    Vertical
                                </button>
                            </div>

                            <!-- Divider & Ask SIA button -->
                            <div class="vision-stage__divider-vertical"></div>
                            <button
                                type="button"
                                class="vision-card__icon-btn"
                                id="btn-open-ask-sia"
                                title="Ask SIA about this output"
                            >
                                <svg viewBox="0 0 24 24" fill="none">
                                    <path d="M5 11C5 7.686 7.686 5 11 5H13C16.314 5 19 7.686 19 11C19 14.314 16.314 17 13 17H12.5" stroke="currentColor" stroke-linecap="round"/>
                                    <path d="M11.5 17L9 20.5L6.5 17" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="10" cy="11" r="1" fill="currentColor"/>
                                    <circle cx="14" cy="11" r="1" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>

                        <div class="vision-stage__toolbar-right">
                            <div class="badge-pill">
                                <span class="tag-dot"></span>
                                <span id="gallery-count-label">No items yet</span>
                            </div>

                            <button
                                class="vision-stage__toolbar-icon-btn"
                                type="button"
                                id="btn-gallery-refresh"
                                title="Reload history"
                            >
                                <svg viewBox="0 0 24 24" fill="none">
                                    <path d="M4 4V10H10" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M20 20V14H14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6.5 17.5C7.66974 18.6638 9.25798 19.3142 10.9165 19.3142C12.575 19.3142 14.1633 18.6638 15.333 17.5C16.5027 16.3362 17.155 14.7533 17.155 13.095C17.155 11.4367 16.5027 9.85382 15.333 8.69C14.1633 7.52618 12.575 6.87579 10.9165 6.87579C9.25798 6.87579 7.66974 7.52618 6.5 8.69L4 11" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Stage actions description -->
                    <div class="vision-stage__actions">
                        <span>Latest creations</span>
                        <span class="vision-stage__divider-vertical"></span>
                        <button class="vision-stage__action-link vision-stage__action-link--primary" type="button" id="btn-open-gallery-settings">
                            <svg viewBox="0 0 24 24" fill="none" style="width:14px;height:14px;">
                                <path d="M12 8V12L14.5 14.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="8" stroke="currentColor"/>
                            </svg>
                            <span>Gallery settings</span>
                        </button>
                        <span class="vision-stage__divider-vertical"></span>
                        <span class="text-muted">Scroll to browse · click thumbnail to jump</span>
                    </div>

                    <!-- Stage feed + history rail -->
                    <div class="vision-stage__feed-wrapper">
                        <!-- Main scrolling feed -->
                        <div class="vision-stage__feed-scroll" id="gallery-scroll">
                            <div id="gallery-empty-state" style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;border-radius:22px;border:1px dashed rgba(31,41,55,0.95);padding:32px 20px;background:radial-gradient(circle at 0 0,#020617,#020617 60%,#000 100%);">
                                <svg viewBox="0 0 24 24" fill="none" style="width:46px;height:46px;margin-bottom:10px;color:var(--text-secondary);">
                                    <rect x="3.5" y="4.5" width="17" height="13" rx="2" stroke="currentColor"/>
                                    <path d="M10 10.5L7.5 14.5H16.5L13.5 10L11.5 12.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="9" cy="9" r="1" fill="currentColor"/>
                                </svg>
                                <div style="font-size:15px;font-weight:600;margin-bottom:4px;">
                                    Nothing here yet
                                </div>
                                <div class="text-muted" style="font-size:12px;max-width:320px;margin-bottom:10px;">
                                    Generate an image, video, or short film. Your creations will appear here with a continuous scroll and synced history rail.
                                </div>
                                <div class="badge-pill">
                                    <span class="tag-dot"></span>
                                    <span>Ready when you are</span>
                                </div>
                            </div>

                            <!-- Gallery items container – cards are injected via JS -->
                            <div id="gallery-items-container" style="display:flex;flex-direction:column;gap:16px;"></div>
                        </div>

                        <!-- Right-side history rail -->
                        <div class="vision-stage__history-rail" id="history-rail">
                            <!-- History thumbnails are injected via JS -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>
</body>
<div class="ask-sia-panel-backdrop" id="askSiaBackdrop">
    <div class="ask-sia-panel">
        <div class="ask-sia-header">
            <div class="ask-sia-title">
                <div class="ask-sia-icon-large">S</div>
                <div>
                    <div>Ask SIA</div>
                    <div style="font-size: 10px; font-weight:400; color:#9ca3af; margin-top:2px;">
                        Sulandra Intelligent Assistant
                    </div>
                </div>
            </div>
            <div class="ask-sia-close" onclick="closeAskSia()">
                <svg viewBox="0 0 24 24" fill="none" style="width:20px;height:20px;">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
        </div>

        <div class="ask-sia-body">
            <div>
                <div class="ask-sia-label">Current Context</div>
                <div class="ask-sia-context-box" id="askSiaContext">
                    No active context.
                </div>
            </div>

            <div>
                <div class="ask-sia-label">Your Request</div>
                <textarea
                    id="askSiaQuestion"
                    class="ask-sia-textarea"
                    placeholder="E.g. 'Make this prompt more cinematic', 'Fix the lighting description', 'Suggest a camera angle'..."
                ></textarea>
            </div>

            <div style="flex:1; display:flex; flex-direction:column;">
                <div class="ask-sia-label">SIA Response</div>
                <div class="ask-sia-answer-box" id="askSiaAnswer">
                    <span style="color:#6b7280; font-style:italic;">Waiting for input...</span>
                </div>
            </div>

            <button type="button" class="ask-sia-main-btn" onclick="sendAskSia()">
                <span>Generate Suggestion</span>
                <svg viewBox="0 0 24 24" fill="none" style="width:14px;height:14px;"><path d="M5 12h14m-6-6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>
</div>
<script>
/* ====================================================================== */
/* SULANDRA CONFIGURATION                                                */
/* ====================================================================== */

// YOUR RUNPOD URL (Port 8188 for ComfyUI)
const SULANDRA_API_BASE = "https://tq8zw4nuj2yrvx-8188.proxy.runpod.net";

/* ====================================================================== */
/* CORE UTILITIES                                                        */
/* ====================================================================== */

function uuidv4() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
        const r = (Math.random() * 16) | 0;
        const v = c === "x" ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}

function $(id) { return document.getElementById(id); }

function setTextContent(id, text) {
    const el = $(id);
    if (el) el.textContent = text;
}

/* ====================================================================== */
/* API & GENERATION LOGIC (COMFYUI FLUX ADAPTER)                        */
/* ====================================================================== */

async function generateImageFromUI() {
    if (isGenerating) return;

    // 1. Gather Inputs (FIXED IDS HERE)
    // We changed "image-prompt-input" to "image-main-prompt" to match your HTML
    const prompt = $("image-main-prompt")?.value || "";
    if (!prompt) { window.alert("Please enter a prompt."); return; }
    
    const negative_prompt = $("image-negative-prompt")?.value || "";
    const steps = parseInt($("image-steps-input")?.value || "20", 10);
    const seedInput = $("image-seed-input")?.value;
    const seed = seedInput ? Number(seedInput) : Math.floor(Math.random() * 1000000000);
    
    // 2. Aspect Ratio Logic
    const btn = document.querySelector("#image-aspect-switch .pill-switch__btn--active");
    const aspect = btn ? btn.dataset.imageAspect : "1:1";
    let width = 1024, height = 1024;
    if (aspect === "16:9") { width = 1280; height = 720; }
    if (aspect === "9:16") { width = 720; height = 1280; }

    setGeneratingState(true, "Queuing...");

    try {
        // 3. Define the Flux Workflow (Standard ComfyUI Graph)
        const workflow = {
            "3": {
                "class_type": "KSampler",
                "inputs": {
                    "model": ["4", 0],
                    "positive": ["6", 0],
                    "negative": ["7", 0],
                    "latent_image": ["5", 0],
                    "seed": seed,
                    "steps": steps,
                    "cfg": 1.0, 
                    "sampler_name": "euler",
                    "scheduler": "simple",
                    "denoise": 1
                }
            },
            "4": {
                "class_type": "CheckpointLoaderSimple",
                "inputs": {
                    // IMPORTANT: Make sure this filename matches exactly what is in your RunPod
                    "ckpt_name": "flux1-dev-fp8.safetensors" 
                }
            },
            "5": {
                "class_type": "EmptyLatentImage",
                "inputs": { "width": width, "height": height, "batch_size": 1 }
            },
            "6": {
                "class_type": "CLIPTextEncode",
                "inputs": { "text": prompt, "clip": ["4", 1] }
            },
            "7": {
                "class_type": "CLIPTextEncode",
                "inputs": { "text": negative_prompt, "clip": ["4", 1] }
            },
            "8": {
                "class_type": "VAEDecode",
                "inputs": { "samples": ["3", 0], "vae": ["4", 2] }
            },
            "9": {
                "class_type": "SaveImage",
                "inputs": { "filename_prefix": "Sulandra_Flux" }
            }
        };

        // 4. Send to ComfyUI (Correct Endpoint: /prompt)
        const clientId = uuidv4();
        // Remove trailing slash just in case
        const apiBase = SULANDRA_API_BASE.replace(/\/+$/, "");
        
        const res = await fetch(`${apiBase}/prompt`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt: workflow, client_id: clientId })
        });

        if (!res.ok) throw new Error(`ComfyUI Error: ${res.status} ${res.statusText}`);
        const data = await res.json();
        const promptId = data.prompt_id;

        setGeneratingState(true, "Rendering...");

        // 5. Poll for result
        let imageUrl = null;
        while (!imageUrl) {
            await new Promise(r => setTimeout(r, 1000));
            const histRes = await fetch(`${apiBase}/history/${promptId}`);
            const histData = await histRes.json();
            
            if (histData[promptId] && histData[promptId].outputs) {
                const outputs = histData[promptId].outputs;
                // Find the image output (Node 9)
                if (outputs["9"] && outputs["9"].images.length > 0) {
                    const img = outputs["9"].images[0];
                    imageUrl = `${apiBase}/view?filename=${img.filename}&subfolder=${img.subfolder}&type=${img.type}`;
                }
            }
        }

        // 6. Add to UI Gallery
        addHistoryItem({
            kind: "image",
            url: imageUrl,
            thumb: imageUrl,
            title: "Flux Gen",
            prompt: prompt,
            aspect: aspect,
            createdAt: Date.now(),
            meta: { seed: seed, steps: steps }
        });

        refreshAllHistoryDisplays();

    } catch (err) {
        console.error(err);
        window.alert("Generation Failed: " + err.message);
    } finally {
        setGeneratingState(false);
    }
}

/* ====================================================================== */
/* UI STATE & DOM WIRING                                                 */
/* ====================================================================== */

let historyInMemory = [];
let currentLab = "image";
let currentMode = "create";
let isGenerating = false;

// Helper to save/load history
function loadHistoryFromStorage() {
    try {
        const raw = localStorage.getItem("sulandra_history");
        if (raw) historyInMemory = JSON.parse(raw);
    } catch(e){}
}
function addHistoryItem(item) {
    item.id = uuidv4();
    historyInMemory.unshift(item);
    localStorage.setItem("sulandra_history", JSON.stringify(historyInMemory));
    return item;
}

// Render the gallery
function refreshAllHistoryDisplays() {
    const container = $("gallery-items-container");
    const emptyState = $("gallery-empty-state");
    if(!container) return;
    
    container.innerHTML = "";
    
    if (historyInMemory.length === 0) {
        if(emptyState) emptyState.style.display = "flex";
        return;
    }
    
    if(emptyState) emptyState.style.display = "none";

    historyInMemory.forEach(item => {
        const div = document.createElement("div");
        div.className = "gallery-card";
        div.style.marginBottom = "10px";
        div.innerHTML = `
            <div class="gallery-card__media-wrapper">
                <img src="${item.url}" class="gallery-card__media" style="width:100%; height:auto;">
            </div>
            <div class="gallery-card__info">
                <div class="gallery-card__title">${item.title}</div>
                <div class="gallery-card__prompt" style="font-size:10px; color:#888;">${item.prompt}</div>
            </div>
        `;
        div.onclick = () => window.open(item.url, "_blank");
        container.appendChild(div);
    });
    
    const countLabel = $("gallery-count-label");
    if(countLabel) countLabel.textContent = `${historyInMemory.length} items`;
}

function setGeneratingState(active, text) {
    isGenerating = active;
    const btn = $("btn-generate");
    const lbl = $("btn-generate-label");
    if(btn) {
        btn.disabled = active;
        btn.style.opacity = active ? "0.5" : "1";
    }
    if(lbl) lbl.textContent = active ? text : "Generate";
}

/* -------------------------- INITIALIZATION ----------------------------- */

document.addEventListener("DOMContentLoaded", () => {
    loadHistoryFromStorage();
    refreshAllHistoryDisplays();
    
    // Wire Generate Button
    const genBtn = $("btn-generate");
    if (genBtn) genBtn.addEventListener("click", generateImageFromUI);

    // Wire Aspect Ratio Buttons
    const aspectBtns = document.querySelectorAll("#image-aspect-switch .pill-switch__btn");
    aspectBtns.forEach(btn => {
        btn.addEventListener("click", () => {
             aspectBtns.forEach(b => b.classList.remove("pill-switch__btn--active"));
             btn.classList.add("pill-switch__btn--active");
        });
    });

    console.log("Sulandra UI Loaded (ComfyUI Mode). API:", SULANDRA_API_BASE);
});

</script>
</html>
