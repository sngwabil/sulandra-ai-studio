<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    />
    <title>Sulandra Vision Studio</title>

    <!-- Fonts -->
    <link
        rel="preconnect"
        href="https://fonts.googleapis.com"
    />
    <link
        rel="preconnect"
        href="https://fonts.gstatic.com"
        crossorigin
    />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet"
    />

    <style>
        :root {
            --bg-root: #020617;
            --bg-surface: rgba(15, 23, 42, 0.98);
            --bg-soft: rgba(15, 23, 42, 0.9);
            --bg-elevated: rgba(15, 23, 42, 0.98);
            --glass: rgba(15, 23, 42, 0.85);

            --accent: #6366f1;
            --accent-soft: rgba(99, 102, 241, 0.12);
            --accent-strong: rgba(129, 140, 248, 0.9);

            --danger: #ef4444;
            --success: #22c55e;

            --border-subtle: rgba(31, 41, 55, 0.9);
            --border-strong: rgba(55, 65, 81, 0.95);

            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;

            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 18px;
            --radius-xl: 22px;
            --radius-pill: 999px;

            --shadow-soft: 0 24px 40px rgba(15, 23, 42, 0.9);

            --header-height: 64px;
            --rail-width: 76px;
            --sidebar-width: 420px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
                "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at top center, #020617, #020617 26%, #000 70%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
        }

        /* =========================================================================
           LEFT RAIL
        ========================================================================= */
        .rail {
            width: var(--rail-width);
            background:
                linear-gradient(to bottom, #020617 0, #020617 40%, #020617 100%);
            border-right: 1px solid rgba(15, 23, 42, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 14px 8px 18px;
            gap: 12px;
            position: fixed;
            inset-block: 0;
            z-index: 20;
        }

        .rail-logo {
            width: 46px;
            height: 46px;
            border-radius: 16px;
            border: 1px solid rgba(148, 163, 184, 0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 21px;
            color: #c7d2fe;
            background:
                radial-gradient(circle at 10% 0, rgba(129, 140, 248, 0.6), transparent 55%);
            box-shadow: 0 0 22px rgba(129, 140, 248, 0.5);
            letter-spacing: 0.08em;
        }

        .rail-section {
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rail-footer {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .rail-btn {
            width: 44px;
            height: 44px;
            border-radius: 16px;
            border: 1px solid rgba(31, 41, 55, 0.95);
            background:
                radial-gradient(circle at 0 0, rgba(30, 64, 175, 0.32), #020617 60%);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.16s ease-out;
            position: relative;
        }

        .rail-btn svg {
            width: 20px;
            height: 20px;
            stroke: #9ca3af;
            stroke-width: 1.6;
            fill: none;
        }

        .rail-btn:hover {
            border-color: rgba(129, 140, 248, 0.9);
            box-shadow: 0 0 16px rgba(79, 70, 229, 0.6);
        }

        .rail-btn.active {
            border-color: rgba(129, 140, 248, 0.9);
            background:
                radial-gradient(circle at 25% 0, rgba(129, 140, 248, 0.5), #020617 70%);
        }

        .rail-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            min-width: 14px;
            padding: 0 3px;
            height: 14px;
            border-radius: 999px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            background:
                radial-gradient(circle at 20% 0, #22c55e, #14532d);
            border: 1px solid #bbf7d0;
            color: #022c22;
            font-weight: 600;
        }

        /* =========================================================================
           APP SHELL
        ========================================================================= */
        .app-shell {
            flex: 1;
            margin-left: var(--rail-width);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Top bar */
        .topbar {
            height: var(--header-height);
            border-bottom: 1px solid rgba(15, 23, 42, 0.95);
            background:
                linear-gradient(to right, rgba(15, 23, 42, 0.97), rgba(15, 23, 42, 1));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 22px;
            position: sticky;
            top: 0;
            z-index: 18;
            backdrop-filter: blur(16px);
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .top-title {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .top-title-main {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.04em;
        }

        .top-title-sub {
            font-size: 11px;
            color: var(--text-muted);
        }

        .badge-pill {
            border-radius: var(--radius-pill);
            border: 1px solid rgba(74, 222, 128, 0.7);
            background: rgba(22, 163, 74, 0.12);
            color: #bbf7d0;
            padding: 4px 10px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .credits-pill {
            border-radius: var(--radius-pill);
            border: 1px solid rgba(148, 163, 184, 0.6);
            background: rgba(15, 23, 42, 0.96);
            font-size: 11px;
            padding: 6px 12px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .credits-pill span.value {
            color: #c7d2fe;
            font-weight: 600;
        }

        .user-chip {
            border-radius: var(--radius-pill);
            border: 1px solid rgba(31, 41, 55, 0.95);
            padding: 5px 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(15, 23, 42, 0.98);
        }

        .user-avatar {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            background:
                radial-gradient(circle at 30% 0, #60a5fa, #312e81);
        }

        .user-name {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* =========================================================================
           LAB TABS BAR
        ========================================================================= */
        .lab-tabs-bar {
            border-bottom: 1px solid rgba(15, 23, 42, 0.95);
            background:
                linear-gradient(to right, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 22px;
            position: sticky;
            top: var(--header-height);
            z-index: 17;
            backdrop-filter: blur(16px);
        }

        .lab-tabs {
            display: inline-flex;
            border-radius: var(--radius-pill);
            border: 1px solid rgba(31, 41, 55, 0.95);
            background: rgba(15, 23, 42, 0.96);
            padding: 3px;
            gap: 3px;
        }

        .lab-tab {
            border-radius: var(--radius-pill);
            padding: 6px 14px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: 0.16s;
        }

        .lab-tab-icon {
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 1px solid rgba(55, 65, 81, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .lab-tab.active {
            background: radial-gradient(circle at 18% 0, rgba(129, 140, 248, 0.5), #020617 80%);
            color: #e5e7eb;
            box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.9);
        }

        .lab-tabs-right {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .mode-pill {
            border-radius: var(--radius-pill);
            border: 1px solid rgba(31, 41, 55, 0.95);
            background: rgba(15, 23, 42, 0.98);
            padding: 4px 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .mode-pill span.value {
            color: #c7d2fe;
            font-weight: 500;
        }

        /* =========================================================================
           MAIN LAYOUT
        ========================================================================= */
        .lab-layout {
            display: grid;
            grid-template-columns: minmax(0, var(--sidebar-width)) minmax(0, 1fr);
            gap: 0;
            padding: 14px 18px 18px;
            height: calc(100vh - var(--header-height) - 52px);
        }

        .panel {
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-subtle);
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), #020617);
            box-shadow: var(--shadow-soft);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar-header {
            padding: 14px 18px 10px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .sidebar-heading {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .sidebar-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
        }

        .sidebar-title {
            font-size: 13px;
            font-weight: 500;
        }

        .sidebar-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-strong);
            background: rgba(15, 23, 42, 0.96);
            color: var(--text-secondary);
            font-size: 11px;
            padding: 5px 11px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .btn-outline {
            background: transparent;
        }

        .btn-primary {
            border-color: var(--accent-strong);
            background:
                radial-gradient(circle at 0 0, rgba(129, 140, 248, 0.9), #312e81);
            color: #e5e7eb;
            font-weight: 500;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: default;
        }

        .sidebar-body {
            flex: 1;
            overflow-y: auto;
            padding: 14px 18px 16px;
        }

        .section-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .input-group {
            margin-bottom: 14px;
        }

        .input-label-row {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            gap: 6px;
            margin-bottom: 4px;
        }

        .input-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .input-caption {
            font-size: 10px;
            color: var(--text-muted);
        }

        textarea,
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-soft);
            color: var(--text-primary);
            font-size: 12px;
            padding: 9px 10px;
            resize: vertical;
        }

        textarea {
            min-height: 90px;
        }

        .field-row {
            display: flex;
            gap: 8px;
        }

        .field-row > * {
            flex: 1;
        }

        .chip-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .chip {
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.96);
            color: var(--text-secondary);
            font-size: 11px;
            padding: 5px 11px;
            cursor: pointer;
        }

        .chip.active {
            border-color: var(--accent-strong);
            background: var(--accent-soft);
            color: #e5e7eb;
        }

        .assist-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        .assist-pill {
            border-radius: var(--radius-pill);
            border: 1px dashed rgba(55, 65, 81, 0.9);
            background: transparent;
            color: var(--text-secondary);
            font-size: 10px;
            padding: 4px 9px;
            cursor: pointer;
        }

        .range-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-row span.value {
            font-size: 11px;
            min-width: 28px;
            text-align: right;
            color: var(--text-secondary);
        }

        input[type="range"] {
            flex: 1;
        }

        /* Upload zone */
        .upload-zone {
            margin-top: 10px;
            border-radius: 14px;
            border: 1px dashed rgba(55, 65, 81, 0.9);
            background: rgba(15, 23, 42, 0.9);
            padding: 12px 12px 10px;
            text-align: center;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            position: relative;
        }

        .upload-zone.dragover {
            border-color: var(--accent);
            background: rgba(15, 23, 42, 0.98);
        }

        .upload-zone input[type="file"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
        }

        .upload-zone-cta {
            font-size: 11px;
            color: #c7d2fe;
            margin-bottom: 4px;
        }

        .upload-meta-row {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .upload-meta-row select {
            font-size: 11px;
            padding: 6px 8px;
        }

        /* Ask SIA button near fields */
        .btn-ask-sia {
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-strong);
            background: rgba(15, 23, 42, 0.98);
            color: var(--text-secondary);
            font-size: 11px;
            padding: 5px 10px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .btn-ask-sia-icon {
            width: 14px;
            height: 14px;
            border-radius: 999px;
            border: 1px solid rgba(129, 140, 248, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: #c7d2fe;
        }

        /* =========================================================================
           STAGE / PREVIEW
        ========================================================================= */
        .stage-header {
            padding: 14px 20px 10px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .stage-heading {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .stage-label {
            font-size: 10px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .stage-title {
            font-size: 13px;
            font-weight: 500;
        }

        .stage-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-toggle {
            display: inline-flex;
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-strong);
            overflow: hidden;
            background: rgba(15, 23, 42, 0.96);
        }

        .view-toggle button {
            border: none;
            background: transparent;
            font-size: 11px;
            padding: 4px 10px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .view-toggle button.active {
            background: rgba(31, 41, 55, 0.95);
            color: #e5e7eb;
        }

        .stage-body {
            flex: 1;
            display: grid;
            grid-template-rows: minmax(0, 1fr) auto;
            overflow: hidden;
        }

        .stage-main {
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background:
                radial-gradient(circle at 30% 0, rgba(15, 23, 42, 0.96), #020617 80%);
        }

        .preview-placeholder {
            max-width: 420px;
            border-radius: 18px;
            border: 1px dashed rgba(55, 65, 81, 0.9);
            padding: 24px 26px;
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
        }

        .preview-placeholder span {
            color: #c7d2fe;
        }

        .preview-media-wrapper {
            display: none;
            max-width: 100%;
            max-height: 100%;
            padding: 18px 20px 16px;
        }

        .preview-media-wrapper img,
        .preview-media-wrapper video {
            width: 100%;
            max-height: calc(100vh - 240px);
            object-fit: contain;
            border-radius: 18px;
            border: 1px solid var(--border-subtle);
            background: #020617;
        }

        .stage-footer {
            border-top: 1px solid var(--border-subtle);
            padding: 10px 18px;
            background: rgba(15, 23, 42, 0.98);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            font-size: 11px;
        }

        .stage-footer-left {
            color: var(--text-muted);
        }

        .stage-footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* =========================================================================
           ASSETS LIST (SIDEBAR IN MY FILES)
        ========================================================================= */
        .assets-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .assets-list.vertical {
            display: flex;
            flex-direction: column;
        }

        .asset-card {
            position: relative;
            border-radius: 14px;
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.98);
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .asset-thumb {
            aspect-ratio: 4 / 3;
            background:
                radial-gradient(circle at 50% 0, rgba(23, 37, 84, 0.9), #020617 80%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .asset-thumb img,
        .asset-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .asset-meta {
            padding: 8px 10px 9px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .asset-title {
            font-size: 12px;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .asset-sub {
            font-size: 10px;
            color: var(--text-muted);
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .asset-footer {
            padding: 6px 8px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-muted);
        }

        .asset-type-pill {
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-subtle);
            padding: 2px 7px;
        }

        .asset-actions {
            display: inline-flex;
            gap: 4px;
        }

        .asset-actions button {
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 10px;
            cursor: pointer;
        }

        .asset-fav {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 22px;
            height: 22px;
            border-radius: 999px;
            border: 1px solid rgba(24, 24, 27, 0.9);
            background:
                radial-gradient(circle at 30% 0, rgba(15, 23, 42, 0.98), #020617 80%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .asset-fav svg {
            width: 13px;
            height: 13px;
            stroke: rgba(148, 163, 184, 0.9);
            stroke-width: 1.6;
            fill: none;
        }

        .asset-fav.is-active svg {
            fill: #f97316;
            stroke: #fed7aa;
        }

        .assets-empty {
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-muted);
        }

        /* =========================================================================
           LIGHTBOX
        ========================================================================= */
        .lightbox-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.86);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 40;
            backdrop-filter: blur(16px);
        }

        .lightbox-backdrop.active {
            display: flex;
        }

        .lightbox {
            width: min(960px, 94vw);
            max-height: 90vh;
            border-radius: 24px;
            border: 1px solid var(--border-strong);
            background: rgba(15, 23, 42, 0.98);
            box-shadow: 0 32px 60px rgba(15, 23, 42, 0.95);
            display: grid;
            grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
            overflow: hidden;
        }

        .lightbox-media {
            padding: 18px 18px 18px 20px;
            background:
                radial-gradient(circle at 30% 0, rgba(30, 64, 175, 0.7), #020617 70%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .lightbox-media img,
        .lightbox-media video {
            width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 18px;
            border: 1px solid var(--border-subtle);
            background: #020617;
        }

        .lightbox-info {
            padding: 16px 16px 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .lightbox-header-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 4px;
        }

        .lightbox-title {
            font-size: 14px;
            font-weight: 500;
        }

        .lightbox-sub {
            font-size: 11px;
            color: var(--text-muted);
        }

        .btn-close {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.98);
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .lightbox-meta {
            font-size: 11px;
            color: var(--text-secondary);
            display: grid;
            gap: 3px;
        }

        .lightbox-meta span.label {
            color: var(--text-muted);
        }

        .lightbox-actions {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .lightbox-actions button {
            border-radius: var(--radius-pill);
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.98);
            color: var(--text-secondary);
            font-size: 11px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .lightbox-actions button.danger {
            border-color: rgba(248, 113, 113, 0.9);
            color: #fecaca;
        }

        .lightbox-prompt {
            margin-top: 8px;
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            background: rgba(15, 23, 42, 0.96);
            padding: 8px 9px;
            font-size: 11px;
            color: var(--text-secondary);
            max-height: 120px;
            overflow-y: auto;
        }

        /* =========================================================================
           RESPONSIVE
        ========================================================================= */
        @media (max-width: 1150px) {
            .lab-layout {
                grid-template-columns: minmax(0, 1fr);
                height: auto;
                grid-template-rows: auto auto;
            }

            .panel {
                margin-bottom: 12px;
            }
        }

        @media (max-width: 900px) {
            .rail {
                display: none;
            }

            .app-shell {
                margin-left: 0;
            }
        }

        @media (max-width: 780px) {
            .lightbox {
                grid-template-columns: minmax(0, 1fr);
            }

            .lightbox-media {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <!-- LEFT RAIL -->
    <aside class="rail">
        <div class="rail-logo">S</div>

        <div class="rail-section">
            <button
                class="rail-btn"
                type="button"
                title="Home / Community"
                onclick="window.location.href='lab.html'"
            >
                <svg viewBox="0 0 24 24">
                    <path
                        d="M4 11.5L12 4l8 7.5V20a1 1 0 0 1-1 1h-4v-6H9v6H5a1 1 0 0 1-1-1v-8.5Z"
                    />
                </svg>
            </button>

            <button
                class="rail-btn active"
                type="button"
                title="Vision Studio"
            >
                <svg viewBox="0 0 24 24">
                    <rect x="4" y="4" width="16" height="16" rx="4" />
                    <circle cx="9" cy="9" r="1.6" />
                    <path d="M20 14 15 9 6 18" />
                </svg>
            </button>
        </div>

        <div class="rail-footer">
            <button class="rail-btn" type="button" title="Studio (Pro)">
                <span class="rail-badge">PRO</span>
                <svg viewBox="0 0 24 24">
                    <rect x="4" y="4" width="16" height="16" rx="2" />
                    <path d="M8 16 11 12l2 2 3-4 2 2" />
                </svg>
            </button>

            <button class="rail-btn" type="button" title="Settings">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6Zm7.3 2a1 1 0 0 0-.5-.7l-1.4-.7-.2-.8-.2-1.5a1 1 0 0 0-1-.9h-1.8a1 1 0 0 0-1 .7L12 6.5h0l-1.2-.6a1 1 0 0 0-1-.7H8a1 1 0 0 0-1 .9L6.8 8l-.2.8-1.4.7a1 1 0 0 0-.5.7L4 13a1 1 0 0 0 .5.9l1.4.7.2.8.3 1.5a1 1 0 0 0 1 .8h1.8a1 1 0 0 0 1-.7l1.1-.6 1.1.6a1 1 0 0 0 1 .7H17a1 1 0 0 0 1-.8l.3-1.5.2-.8 1.4-.7a1 1 0 0 0 .5-.9Z"
                    />
                </svg>
            </button>
        </div>
    </aside>

    <!-- APP SHELL -->
    <div class="app-shell">
        <!-- TOP BAR -->
        <header class="topbar">
            <div class="topbar-left">
                <div class="top-title">
                    <div class="top-title-main">Sulandra Vision Studio</div>
                    <div class="top-title-sub">
                        Images · Video Clips · Short Films · Library
                    </div>
                </div>
                <span class="badge-pill">Beta</span>
            </div>

            <div class="topbar-right">
                <div class="credits-pill">
                    Credits
                    <span class="value" id="credits-value">120</span>
                    / day
                </div>
                <div class="user-chip">
                    <div class="user-avatar"></div>
                    <div class="user-name">Creator</div>
                </div>
            </div>
        </header>

        <!-- LAB TABS -->
        <div class="lab-tabs-bar">
            <div class="lab-tabs" id="lab-tabs">
                <div
                    class="lab-tab active"
                    data-lab="image"
                    onclick="setActiveLab('image')"
                >
                    <div class="lab-tab-icon">IM</div>
                    <span>Images</span>
                </div>
                <div
                    class="lab-tab"
                    data-lab="video"
                    onclick="setActiveLab('video')"
                >
                    <div class="lab-tab-icon">VC</div>
                    <span>Video Clips</span>
                </div>
                <div
                    class="lab-tab"
                    data-lab="shortfilm"
                    onclick="setActiveLab('shortfilm')"
                >
                    <div class="lab-tab-icon">SF</div>
                    <span>Short Films</span>
                </div>
                <div
                    class="lab-tab"
                    data-lab="assets"
                    onclick="setActiveLab('assets')"
                >
                    <div class="lab-tab-icon">MF</div>
                    <span>My Files</span>
                </div>
            </div>

            <div class="lab-tabs-right">
                <div class="mode-pill">
                    <span>Mode:</span>
                    <span class="value" id="mode-label">Create</span>
                </div>
                <div class="mode-pill">
                    <span>Sidebar view:</span>
                    <span class="value" id="view-label">Grid</span>
                </div>
            </div>
        </div>

        <!-- MAIN LAYOUT -->
        <main class="lab-layout">
            <!-- SIDEBAR -->
            <aside class="panel">
                <div class="sidebar-header">
                    <div class="sidebar-heading">
                        <div class="sidebar-label" id="sidebar-label">
                            Create
                        </div>
                        <div class="sidebar-title" id="sidebar-title">
                            Image generation
                        </div>
                    </div>
                    <div class="sidebar-actions">
                        <button
                            type="button"
                            class="btn btn-outline"
                            onclick="resetForm()"
                        >
                            Reset
                        </button>
                    </div>
                </div>

                <!-- CREATE BODY -->
                <div class="sidebar-body" id="sidebar-body-create">
                    <div class="section-label">Prompt & guidance</div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Prompt</div>
                            <div class="input-caption">
                                Describe the scene in clear detail
                            </div>
                        </div>
                        <div class="field-row">
                            <textarea
                                id="prompt"
                                placeholder="Cinematic studio portrait, sharp details, dramatic lighting..."
                            ></textarea>
                            <button
                                type="button"
                                class="btn-ask-sia"
                                onclick="openAskSia('prompt')"
                                title="Ask SIA to help with the prompt"
                            >
                                <span class="btn-ask-sia-icon">S</span>
                                <span>SIA</span>
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Negative prompt</div>
                            <div class="input-caption">What to exclude</div>
                        </div>
                        <textarea
                            id="negative"
                            placeholder="blurry, low quality, watermark, distorted anatomy..."
                        ></textarea>

                        <div class="assist-row">
                            <button
                                type="button"
                                class="assist-pill"
                                onclick="appendNegative('blurry')"
                            >
                                Add “blurry”
                            </button>
                            <button
                                type="button"
                                class="assist-pill"
                                onclick="appendNegative('extra limbs')"
                            >
                                Add “extra limbs”
                            </button>
                            <button
                                type="button"
                                class="assist-pill"
                                onclick="appendNegative('low resolution')"
                            >
                                Add “low resolution”
                            </button>
                        </div>
                    </div>

                    <div class="section-label" style="margin-top: 10px">
                        Output & quality
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Aspect ratio</div>
                            <div class="input-caption">
                                Choose framing for this generation
                            </div>
                        </div>
                        <div class="chip-row" id="ratio-chips">
                            <button
                                type="button"
                                class="chip active"
                                data-ratio="1:1"
                                data-w="1024"
                                data-h="1024"
                                onclick="setAspectRatio(this)"
                            >
                                1:1 · Square
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-ratio="16:9"
                                data-w="1280"
                                data-h="720"
                                onclick="setAspectRatio(this)"
                            >
                                16:9 · Landscape
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-ratio="9:16"
                                data-w="720"
                                data-h="1280"
                                onclick="setAspectRatio(this)"
                            >
                                9:16 · Portrait
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-ratio="4:5"
                                data-w="1024"
                                data-h="1280"
                                onclick="setAspectRatio(this)"
                            >
                                4:5 · Portrait
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Guidance scale</div>
                            <div class="input-caption">
                                Lower = more creative, higher = more literal
                            </div>
                        </div>
                        <div class="range-row">
                            <input
                                type="range"
                                id="guidance"
                                min="1"
                                max="10"
                                step="0.5"
                                value="3.5"
                                oninput="document.getElementById('guidance-value').innerText=this.value"
                            />
                            <span class="value" id="guidance-value">3.5</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Number of outputs</div>
                            <div class="input-caption">
                                Up to 4 variations in one run
                            </div>
                        </div>
                        <select id="image-count">
                            <option value="1">1 output</option>
                            <option value="2">2 outputs</option>
                            <option value="3">3 outputs</option>
                            <option value="4">4 outputs</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <div class="input-label-row">
                            <div class="input-label">Seed</div>
                            <div class="input-caption">
                                Leave empty for random seed
                            </div>
                        </div>
                        <div class="field-row">
                            <input
                                type="number"
                                id="seed"
                                placeholder="Random"
                            />
                            <button
                                type="button"
                                class="btn"
                                onclick="randomSeed()"
                            >
                                Random
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ASSETS BODY (MY FILES) -->
                <div
                    class="sidebar-body"
                    id="sidebar-body-assets"
                    style="display: none"
                >
                    <div class="section-label">Library & uploads</div>

                    <!-- Filter chips -->
                    <div class="input-group">
                        <div class="chip-row">
                            <button
                                type="button"
                                class="chip active"
                                data-assets-filter="image"
                                onclick="setAssetsFilter('image', this)"
                            >
                                My images
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-assets-filter="video"
                                onclick="setAssetsFilter('video', this)"
                            >
                                My videos
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-assets-filter="shortfilm"
                                onclick="setAssetsFilter('shortfilm', this)"
                            >
                                My films
                            </button>
                            <button
                                type="button"
                                class="chip"
                                data-assets-filter="all"
                                onclick="setAssetsFilter('all', this)"
                            >
                                All files
                            </button>
                        </div>
                    </div>

                    <!-- Upload zone -->
                    <div
                        class="upload-zone"
                        id="upload-zone"
                        ondragover="onUploadDragOver(event)"
                        ondragleave="onUploadDragLeave(event)"
                        ondrop="onUploadDrop(event)"
                    >
                        <div class="upload-zone-cta">Upload existing work</div>
                        <div>
                            Drag & drop files here or click to browse
                        </div>
                        <input
                            type="file"
                            id="upload-input"
                            multiple
                            accept="image/*,video/*"
                            onchange="onUploadInputChange(event)"
                        />
                        <div class="upload-meta-row">
                            <select id="upload-kind">
                                <option value="image">Save as: Image</option>
                                <option value="video">Save as: Video</option>
                                <option value="shortfilm">Save as: Short film</option>
                            </select>
                        </div>
                    </div>

                    <!-- Assets list -->
                    <div class="input-group" style="margin-top: 14px">
                        <div class="assets-list" id="assets-list"></div>
                        <div class="assets-empty" id="assets-empty">
                            Nothing here yet. Generated results and uploaded
                            files will appear in this sidebar.
                        </div>
                    </div>
                </div>
            </aside>

            <!-- STAGE / PREVIEW -->
            <section class="panel">
                <div class="stage-header">
                    <div class="stage-heading">
                        <div class="stage-label" id="stage-label">
                            Preview
                        </div>
                        <div class="stage-title" id="stage-title">
                            Waiting for your first creation
                        </div>
                    </div>
                    <div class="stage-controls">
                        <div class="view-toggle">
                            <button
                                type="button"
                                id="view-grid-btn"
                                class="active"
                                onclick="setViewMode('grid')"
                            >
                                Grid
                            </button>
                            <button
                                type="button"
                                id="view-vertical-btn"
                                onclick="setViewMode('vertical')"
                            >
                                Vertical
                            </button>
                        </div>
                        <button
                            type="button"
                            class="btn-ask-sia"
                            onclick="openAskSia('global')"
                        >
                            <span class="btn-ask-sia-icon">S</span>
                            <span>Ask SIA (global)</span>
                        </button>
                    </div>
                </div>

                <div class="stage-body">
                    <div class="stage-main">
                        <div
                            class="preview-placeholder"
                            id="preview-placeholder"
                        >
                            Use the panel on the left to
                            <span>generate</span> images, video clips, or short
                            films.  
                            Every generation and every upload is saved into
                            <strong>My Files</strong> and can be reopened,
                            renamed, or reused at any time.
                        </div>

                        <div
                            class="preview-media-wrapper"
                            id="preview-media-wrapper"
                        >
                            <img
                                id="preview-image"
                                alt="Preview"
                                style="display: none"
                            />
                            <video
                                id="preview-video"
                                controls
                                style="display: none"
                            ></video>
                        </div>
                    </div>

                    <div class="stage-footer">
                        <div class="stage-footer-left" id="footer-status">
                            Idle · Ready to generate
                        </div>
                        <div class="stage-footer-right">
                            <button
                                type="button"
                                class="btn btn-outline"
                                onclick="setActiveLab('assets')"
                            >
                                Open My Files
                            </button>
                            <button
                                type="button"
                                class="btn btn-primary"
                                id="generate-btn"
                                onclick="handleGenerate()"
                            >
                                Generate
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- LIGHTBOX -->
    <div
        class="lightbox-backdrop"
        id="lightbox-backdrop"
        onclick="onBackdropClick(event)"
    >
        <div class="lightbox" id="lightbox">
            <div class="lightbox-media">
                <img
                    id="lightbox-image"
                    alt="Asset preview"
                    style="display: none"
                />
                <video
                    id="lightbox-video"
                    controls
                    style="display: none"
                ></video>
            </div>
            <div class="lightbox-info">
                <div class="lightbox-header-row">
                    <div>
                        <div class="lightbox-title" id="lightbox-title">
                            Asset
                        </div>
                        <div class="lightbox-sub" id="lightbox-sub">
                            Type · Created at
                        </div>
                    </div>
                    <button
                        type="button"
                        class="btn-close"
                        onclick="closeLightbox()"
                    >
                        ×
                    </button>
                </div>

                <div class="lightbox-meta">
                    <div>
                        <span class="label">Resolution:</span>
                        <span id="lightbox-res"></span>
                    </div>
                    <div>
                        <span class="label">Seed:</span>
                        <span id="lightbox-seed"></span>
                    </div>
                    <div>
                        <span class="label">Created:</span>
                        <span id="lightbox-created"></span>
                    </div>
                    <div>
                        <span class="label">Kind:</span>
                        <span id="lightbox-kind"></span>
                    </div>
                </div>

                <div class="lightbox-actions">
                    <button type="button" onclick="downloadCurrentAsset()">
                        Download
                    </button>
                    <button type="button" onclick="recreateCurrentAsset()">
                        Recreate
                    </button>
                    <button type="button" onclick="sendCurrentAssetToCinema()">
                        Send to cinema
                    </button>
                    <button type="button" onclick="renameCurrentAsset()">
                        Rename
                    </button>
                    <button
                        type="button"
                        class="danger"
                        onclick="deleteCurrentAsset()"
                    >
                        Delete
                    </button>
                </div>

                <div class="lightbox-prompt" id="lightbox-prompt"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================
        // GLOBAL STATE
        // ============================================================
        const state = {
            activeLab: "image",        // 'image' | 'video' | 'shortfilm' | 'assets'
            mode: "create",            // 'create' | 'assets'
            viewMode: "grid",          // 'grid' | 'vertical'
            assetsFilter: "image",     // 'image' | 'video' | 'shortfilm' | 'all'
            assets: [],                // all generated + uploaded assets
            previewAssetId: null,
            lightboxId: null,
            nextId: 1
        };

        // ============================================================
        // LAB SWITCHING
        // ============================================================
        function setActiveLab(lab) {
            state.activeLab = lab;

            document
                .querySelectorAll(".lab-tab")
                .forEach((tab) =>
                    tab.classList.toggle("active", tab.dataset.lab === lab)
                );

            const createBody = document.getElementById("sidebar-body-create");
            const assetsBody = document.getElementById("sidebar-body-assets");
            const modeLabel = document.getElementById("mode-label");
            const sidebarLabel = document.getElementById("sidebar-label");
            const sidebarTitle = document.getElementById("sidebar-title");
            const stageLabel = document.getElementById("stage-label");
            const stageTitle = document.getElementById("stage-title");
            const footerStatus = document.getElementById("footer-status");

            if (lab === "assets") {
                state.mode = "assets";
                modeLabel.innerText = "My Files";
                sidebarLabel.innerText = "Library";
                sidebarTitle.innerText = "Browse uploads & generations";
                stageLabel.innerText = "Preview";
                stageTitle.innerText = "Select a file from My Files";
                createBody.style.display = "none";
                assetsBody.style.display = "block";
                footerStatus.innerText =
                    "My Files · Browse, open, and manage your creations";
                renderAssetsList();
            } else {
                state.mode = "create";
                modeLabel.innerText = "Create";
                sidebarLabel.innerText = "Create";
                sidebarTitle.innerText = getCreateSidebarTitle(lab);
                stageLabel.innerText = "Preview";
                stageTitle.innerText = "Waiting for your next " + lab + " run";
                createBody.style.display = "block";
                assetsBody.style.display = "none";
                footerStatus.innerText = "Idle · Ready to generate";
            }
        }

        function getCreateSidebarTitle(lab) {
            if (lab === "image") return "Image generation";
            if (lab === "video") return "Video generation";
            if (lab === "shortfilm") return "Short film generation";
            return "Generation settings";
        }

        // ============================================================
        // VIEW MODE (GRID / VERTICAL) – affects sidebar gallery only
        // ============================================================
        function setViewMode(mode) {
            state.viewMode = mode;
            document.getElementById("view-label").innerText =
                mode === "grid" ? "Grid" : "Vertical";

            document
                .getElementById("view-grid-btn")
                .classList.toggle("active", mode === "grid");
            document
                .getElementById("view-vertical-btn")
                .classList.toggle("active", mode === "vertical");

            const list = document.getElementById("assets-list");
            if (!list) return;
            if (mode === "vertical") {
                list.classList.add("vertical");
            } else {
                list.classList.remove("vertical");
            }
        }

        // ============================================================
        // ASPECT RATIO, NEGATIVE HELPERS, SEED, RESET
        // ============================================================
        function setAspectRatio(chip) {
            document
                .querySelectorAll("#ratio-chips .chip")
                .forEach((c) => c.classList.remove("active"));
            chip.classList.add("active");
        }

        function appendNegative(text) {
            const field = document.getElementById("negative");
            if (!field.value) {
                field.value = text;
            } else if (!field.value.includes(text)) {
                field.value += ", " + text;
            }
        }

        function randomSeed() {
            const value = Math.floor(Math.random() * 999999999);
            document.getElementById("seed").value = value;
        }

        function resetForm() {
            document.getElementById("prompt").value = "";
            document.getElementById("negative").value = "";
            document.getElementById("image-count").value = "1";
            document.getElementById("seed").value = "";
            document.getElementById("guidance").value = 3.5;
            document.getElementById("guidance-value").innerText = "3.5";
            document
                .querySelectorAll("#ratio-chips .chip")
                .forEach((c) => c.classList.remove("active"));
            const first = document.querySelector("#ratio-chips .chip");
            if (first) first.classList.add("active");
        }

        // ============================================================
        // GENERATION (Stub) – replace with real API call later
        // ============================================================
        function handleGenerate() {
            if (state.mode !== "create") {
                setActiveLab(state.activeLab || "image");
            }

            const prompt = document.getElementById("prompt").value.trim();
            if (!prompt) {
                alert("Please enter a prompt first.");
                return;
            }

            const negative = document.getElementById("negative").value.trim();
            const guidance = parseFloat(
                document.getElementById("guidance").value
            );
            const count = parseInt(
                document.getElementById("image-count").value,
                10
            );
            const seedValue = document.getElementById("seed").value.trim();

            document.getElementById("footer-status").innerText =
                "Generating " +
                state.activeLab +
                "… (client-side demo only)";
            document.getElementById("generate-btn").disabled = true;

            setTimeout(() => {
                for (let i = 0; i < count; i++) {
                    const id = "asset-" + state.nextId++;
                    const { width, height } = getSelectedResolution();
                    const asset = {
                        id,
                        type: state.activeLab, // 'image' | 'video' | 'shortfilm'
                        createdAt: new Date().toLocaleString(),
                        prompt,
                        negative,
                        guidance,
                        seed: seedValue || null,
                        width,
                        height,
                        displayName:
                            state.activeLab.toUpperCase() +
                            " · " +
                            String(state.nextId).padStart(3, "0"),
                        url: getPlaceholderUrl(state.activeLab),
                        isFavorite: false,
                        source: "generated"
                    };
                    state.assets.unshift(asset);
                    state.previewAssetId = asset.id;
                }

                document.getElementById("generate-btn").disabled = false;
                document.getElementById("footer-status").innerText =
                    "Done · Saved to My Files";

                if (state.previewAssetId) {
                    const asset = state.assets.find(
                        (a) => a.id === state.previewAssetId
                    );
                    if (asset) showPreviewAsset(asset);
                }

                if (state.mode === "assets") {
                    renderAssetsList();
                }
            }, 800);
        }

        function getSelectedResolution() {
            const active = document.querySelector("#ratio-chips .chip.active");
            if (!active) return { width: 1024, height: 1024 };
            const w = parseInt(active.dataset.w || "1024", 10);
            const h = parseInt(active.dataset.h || "1024", 10);
            return { width: w, height: h };
        }

        function getPlaceholderUrl(kind) {
            if (kind === "image") {
                return "https://placehold.co/1024x1024/020617/9ca3af?text=Sulandra+Image";
            }
            if (kind === "video" || kind === "shortfilm") {
                return "https://placehold.co/1280x720/020617/9ca3af?text=Sulandra+Video";
            }
            return "https://placehold.co/1024x1024/020617/9ca3af?text=Sulandra";
        }

        function showPreviewAsset(asset) {
            const placeholder = document.getElementById("preview-placeholder");
            const wrapper = document.getElementById("preview-media-wrapper");
            const img = document.getElementById("preview-image");
            const vid = document.getElementById("preview-video");

            placeholder.style.display = "none";
            wrapper.style.display = "block";

            if (asset.type === "image") {
                img.style.display = "block";
                vid.style.display = "none";
                img.src = asset.url;
            } else {
                img.style.display = "none";
                vid.style.display = "block";
                vid.src = asset.url;
            }

            document.getElementById("stage-title").innerText =
                asset.displayName;
        }

        // ============================================================
        // MY FILES – FILTER & RENDER
        // ============================================================
        function setAssetsFilter(filter, btn) {
            state.assetsFilter = filter;
            document
                .querySelectorAll("[data-assets-filter]")
                .forEach((el) => el.classList.remove("active"));
            btn.classList.add("active");
            renderAssetsList();
        }

        function renderAssetsList() {
            const list = document.getElementById("assets-list");
            const empty = document.getElementById("assets-empty");
            if (!list || !empty) return;

            list.innerHTML = "";

            let filtered = state.assets;
            if (state.assetsFilter !== "all") {
                filtered = filtered.filter(
                    (a) => a.type === state.assetsFilter
                );
            }

            if (!filtered.length) {
                empty.style.display = "block";
                return;
            }
            empty.style.display = "none";

            filtered.forEach((asset) => {
                const card = document.createElement("div");
                card.className = "asset-card";
                card.dataset.assetId = asset.id;
                card.onclick = () => openAssetInPreview(asset.id);

                const thumb = document.createElement("div");
                thumb.className = "asset-thumb";
                const img = document.createElement("img");
                const video = document.createElement("video");
                video.muted = true;

                if (asset.type === "image") {
                    img.src = asset.url;
                    thumb.appendChild(img);
                } else {
                    video.src = asset.url || "";
                    video.poster =
                        asset.url ||
                        "https://placehold.co/640x360/020617/9ca3af?text=Video";
                    thumb.appendChild(video);
                }
                card.appendChild(thumb);

                const meta = document.createElement("div");
                meta.className = "asset-meta";
                const title = document.createElement("div");
                title.className = "asset-title";
                title.innerText = asset.displayName || "Asset";
                const sub = document.createElement("div");
                sub.className = "asset-sub";
                sub.innerText = asset.createdAt;

                meta.appendChild(title);
                meta.appendChild(sub);
                card.appendChild(meta);

                const footer = document.createElement("div");
                footer.className = "asset-footer";

                const typePill = document.createElement("div");
                typePill.className = "asset-type-pill";
                typePill.innerText =
                    asset.type === "image"
                        ? "Image"
                        : asset.type === "video"
                        ? "Video"
                        : "Short film";

                footer.appendChild(typePill);

                const actions = document.createElement("div");
                actions.className = "asset-actions";

                const btnOpen = document.createElement("button");
                btnOpen.innerText = "Open";
                btnOpen.onclick = (e) => {
                    e.stopPropagation();
                    openLightbox(asset.id);
                };

                const btnMenu = document.createElement("button");
                btnMenu.innerText = "⋯";
                btnMenu.onclick = (e) => {
                    e.stopPropagation();
                    openLightbox(asset.id);
                };

                actions.appendChild(btnOpen);
                actions.appendChild(btnMenu);
                footer.appendChild(actions);

                card.appendChild(footer);

                const favBtn = document.createElement("button");
                favBtn.className =
                    "asset-fav" + (asset.isFavorite ? " is-active" : "");
                favBtn.innerHTML =
                    '<svg viewBox="0 0 24 24"><path d="M12.1 8.64 12 8.75l-.11-.11C10.14 6.6 7.1 6.6 5.13 8.58c-1.98 1.98-1.98 5.18 0 7.16L12 22.5l6.87-6.76c1.98-1.98 1.98-5.18 0-7.16-1.97-1.98-5.01-1.98-6.97 0z"/></svg>';
                favBtn.onclick = (e) => {
                    e.stopPropagation();
                    toggleFavorite(asset.id, favBtn);
                };

                card.appendChild(favBtn);
                list.appendChild(card);
            });

            setViewMode(state.viewMode);
        }

        function openAssetInPreview(id) {
            const asset = state.assets.find((a) => a.id === id);
            if (!asset) return;
            state.previewAssetId = id;
            showPreviewAsset(asset);
            document.getElementById("stage-title").innerText =
                asset.displayName;
            document.getElementById("stage-label").innerText =
                "Preview";
        }

        function toggleFavorite(id, btn) {
            const asset = state.assets.find((a) => a.id === id);
            if (!asset) return;
            asset.isFavorite = !asset.isFavorite;
            btn.classList.toggle("is-active", asset.isFavorite);
        }

        // ============================================================
        // UPLOADS
        // ============================================================
        function onUploadDragOver(event) {
            event.preventDefault();
            document
                .getElementById("upload-zone")
                .classList.add("dragover");
        }

        function onUploadDragLeave(event) {
            event.preventDefault();
            document
                .getElementById("upload-zone")
                .classList.remove("dragover");
        }

        function onUploadDrop(event) {
            event.preventDefault();
            document
                .getElementById("upload-zone")
                .classList.remove("dragover");

            const files = Array.from(event.dataTransfer.files || []);
            handleFilesUpload(files);
        }

        function onUploadInputChange(event) {
            const files = Array.from(event.target.files || []);
            handleFilesUpload(files);
            // reset input so the same file can be re-selected if needed
            event.target.value = "";
        }

        function handleFilesUpload(files) {
            if (!files.length) return;

            const kind = document.getElementById("upload-kind").value;
            files.forEach((file) => {
                const url = URL.createObjectURL(file);
                const id = "asset-" + state.nextId++;
                const createdAt = new Date().toLocaleString();

                const asset = {
                    id,
                    type: kind,
                    createdAt,
                    prompt: "",
                    negative: "",
                    guidance: null,
                    seed: null,
                    width: kind === "image" ? 1024 : 1280,
                    height: kind === "image" ? 1024 : 720,
                    displayName: file.name || (kind.toUpperCase() + " upload"),
                    url,
                    isFavorite: false,
                    source: "upload"
                };

                state.assets.unshift(asset);
            });

            renderAssetsList();
            document.getElementById("footer-status").innerText =
                "Uploaded files saved into My Files";
        }

        // ============================================================
        // LIGHTBOX
        // ============================================================
        function openLightbox(id) {
            const asset = state.assets.find((a) => a.id === id);
            if (!asset) return;
            state.lightboxId = id;

            const backdrop = document.getElementById("lightbox-backdrop");
            const img = document.getElementById("lightbox-image");
            const vid = document.getElementById("lightbox-video");

            img.style.display = "none";
            vid.style.display = "none";

            if (asset.type === "image") {
                img.src = asset.url;
                img.style.display = "block";
            } else {
                vid.src = asset.url || "";
                vid.style.display = "block";
            }

            document.getElementById("lightbox-title").innerText =
                asset.displayName;
            document.getElementById("lightbox-sub").innerText =
                (asset.type === "image"
                    ? "Image"
                    : asset.type === "video"
                    ? "Video clip"
                    : "Short film") +
                " · " +
                asset.createdAt;
            document.getElementById("lightbox-res").innerText =
                (asset.width || "–") + " × " + (asset.height || "–");
            document.getElementById("lightbox-seed").innerText =
                asset.seed || "Random / N/A";
            document.getElementById("lightbox-created").innerText =
                asset.createdAt || "–";
            document.getElementById("lightbox-kind").innerText =
                asset.source === "upload"
                    ? "Uploaded file"
                    : "Generated in Vision Studio";
            document.getElementById("lightbox-prompt").innerText =
                asset.prompt || "";

            backdrop.classList.add("active");
        }

        function closeLightbox() {
            const backdrop = document.getElementById("lightbox-backdrop");
            backdrop.classList.remove("active");
            const vid = document.getElementById("lightbox-video");
            if (vid) vid.pause();
            state.lightboxId = null;
        }

        function onBackdropClick(event) {
            if (event.target.id === "lightbox-backdrop") {
                closeLightbox();
            }
        }

        function getCurrentLightboxAsset() {
            if (!state.lightboxId) return null;
            return state.assets.find((a) => a.id === state.lightboxId);
        }

        // Lightbox actions
        function downloadCurrentAsset() {
            const asset = getCurrentLightboxAsset();
            if (!asset) return;
            alert(
                "Download triggered for: " +
                    asset.displayName +
                    " (wire to real download in production)."
            );
        }

        function recreateCurrentAsset() {
            const asset = getCurrentLightboxAsset();
            if (!asset) return;
            document.getElementById("prompt").value = asset.prompt || "";
            document.getElementById("negative").value = asset.negative || "";
            if (asset.seed) {
                document.getElementById("seed").value = asset.seed;
            }
            setActiveLab(asset.type || "image");
            closeLightbox();
        }

        function sendCurrentAssetToCinema() {
            const asset = getCurrentLightboxAsset();
            if (!asset) return;
            alert(
                "Send to cinema: " +
                    asset.displayName +
                    " (hook this into your Cinema / film workspace)."
            );
        }

        function renameCurrentAsset() {
            const asset = getCurrentLightboxAsset();
            if (!asset) return;
            const newName = prompt("Rename asset:", asset.displayName);
            if (!newName) return;
            asset.displayName = newName;
            renderAssetsList();
            openLightbox(asset.id);
        }

        function deleteCurrentAsset() {
            const asset = getCurrentLightboxAsset();
            if (!asset) return;
            if (!confirm("Delete this asset from My Files?")) return;
            state.assets = state.assets.filter((a) => a.id !== asset.id);
            closeLightbox();
            renderAssetsList();
        }

        // ============================================================
        // ASK SIA (Stub)
        // ============================================================
        function openAskSia(scope) {
            alert(
                "Ask SIA invoked with scope: " +
                    scope +
                    ". Wire this to your SIA Brain endpoint."
            );
        }

        // ============================================================
        // INIT
        // ============================================================
        window.addEventListener("DOMContentLoaded", () => {
            setActiveLab("image");
            setViewMode("grid");
        });
    </script>
</body>
</html>
