<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SOUND Studio ‚Äì AI Production Environment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg-deep: #020419;
      --bg-surface: #050b2a;
      --bg-panel: #071134;
      --bg-panel-soft: #091746;
      --border-soft: rgba(129,166,255,0.25);
      --border-strong: rgba(129,166,255,0.9);
      --accent: #7cffc7;
      --accent2: #ff7cf1;
      --accent3: #ffd77c;
      --accent4: #7cbeff;
      --text-main: #f7fbff;
      --text-muted: #9cb3ff;
      --grid-line: rgba(167,194,255,0.18);
      --clip-blue: #3d7cff;
      --clip-purple: #a96cff;
      --clip-pink: #ff6ca4;
      --clip-green: #4dffbb;
      --radius: 7px;
      --shadow-soft: 0 0 32px rgba(0,0,0,0.85);
      --beat-width: 48px;
      --track-height: 40px;
      --beats-per-bar: 4;
    }

    * { box-sizing: border-box; user-select: none; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter", sans-serif;
      background:
        radial-gradient(circle at 0 0,#2744ff 0,transparent 45%),
        radial-gradient(circle at 100% 0,#ff3ccf 0,transparent 45%),
        radial-gradient(circle at 50% 100%,#00ffc8 0,transparent 50%),
        #020419;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }

    a { color: inherit; text-decoration: none; }

    /* === HEADER === */
    header {
      background: linear-gradient(to bottom,rgba(10,20,70,0.98),rgba(4,8,35,0.98));
      border-bottom: 1px solid rgba(0,0,0,0.9);
      box-shadow: 0 0 18px rgba(0,0,0,0.9);
      z-index: 20;
    }
    .header-inner {
      max-width: 1440px;
      margin: 0 auto;
      padding: 4px 14px 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .brand-left { display: flex; align-items: center; gap: 10px; }
    .brand-logo {
      width: 30px; height: 30px; border-radius: 10px;
      background: conic-gradient(from 120deg,#7cffc7,#7cbeff,#ff7cf1,#ffd77c,#7cffc7);
      display: flex; align-items: center; justify-content: center;
      color: #01030d; font-weight: 900; font-size: 16px;
      box-shadow: 0 0 20px rgba(124,190,255,0.8);
    }
    .brand-text-main {
      font-size: 13px; text-transform: uppercase; letter-spacing: .16em;
      background: linear-gradient(to right,#7cffc7,#ffd77c,#ff7cf1,#7cbeff);
      -webkit-background-clip: text; color: transparent;
    }
    .brand-text-sub { font-size: 10px; letter-spacing: .22em; text-transform: uppercase; color: var(--text-muted); }
    .brand-sound-pill {
      margin-left: 10px; padding: 3px 8px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: radial-gradient(circle at 0 0,#3f7cff,#050b2a);
      font-size: 10px; text-transform: uppercase; letter-spacing: .18em;
      color: var(--accent); box-shadow: 0 0 14px rgba(61,124,255,0.9);
    }
    .top-right { display: flex; align-items: center; gap: 10px; font-size: 10px; color: var(--text-muted); }
    .session-pill {
      padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.8);
      background: radial-gradient(circle at 0 0,#2135ff,#050b1a);
      display: flex; align-items: center; gap: 6px;
    }
    .session-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 8px rgba(124,255,199,0.9); }

    /* === MAIN LAYOUT === */
    main {
      flex: 1; max-width: 1440px; margin: 6px auto 12px; padding: 0 10px 12px;
      display: flex; flex-direction: column; gap: 6px;
    }

    /* === ICON DOCK === */
    .icon-dock {
      border-radius: var(--radius); border: 1px solid rgba(0,0,0,0.9);
      background: linear-gradient(to right,rgba(7,17,52,0.96),rgba(7,11,45,0.98));
      box-shadow: var(--shadow-soft); padding: 4px 10px;
      display: flex; align-items: center; justify-content: space-between; gap: 10px; font-size: 11px;
    }
    .icon-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .dock-icon {
      width: 30px; height: 30px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.9);
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      position: relative; box-shadow: 0 0 8px rgba(0,0,0,0.9); font-size: 14px;
      color: #02041b; transition: transform .08s, box-shadow .08s, border-color .08s; font-weight: 700;
    }
    .dock-icon[data-panel="browser"] { background: radial-gradient(circle at 0 0,#4aa8ff,#071134); }
    .dock-icon[data-panel="rack"]    { background: radial-gradient(circle at 0 0,#7cffc7,#071134); }
    .dock-icon[data-panel="mixer"]   { background: radial-gradient(circle at 0 0,#ff7cf1,#071134); }
    .dock-icon[data-panel="piano"]   { background: radial-gradient(circle at 0 0,#ffd77c,#071134); }
    .dock-icon[data-panel="plugins"] { background: radial-gradient(circle at 0 0,#7cbeff,#071134); }
    .dock-icon[data-panel="timeline"]{ background: radial-gradient(circle at 0 0,#ff8a7c,#071134); }
    .dock-icon.active { transform: translateY(-2px); border-color: #fff; box-shadow: 0 0 12px rgba(255,255,255,0.8); }
    .dock-icon-labels { display: flex; gap: 10px; font-size: 10px; color: var(--text-muted); flex-wrap: wrap; }
    .dock-icon-labels span { padding: 2px 6px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.8); background: rgba(7,15,66,0.9); }

    /* === MAIN GRID === */
    .main-grid {
      margin-top: 4px; border-radius: 9px; border: 1px solid rgba(0,0,0,0.9);
      background: radial-gradient(circle at 0 0,#1a2aff,#050821 55%,#010313 100%);
      box-shadow: var(--shadow-soft); display: grid;
      grid-template-columns: 260px minmax(0,1fr) 220px; min-height: 450px; overflow: hidden;
    }
    @media (max-width: 1100px) { .main-grid { grid-template-columns: 220px minmax(0,1fr); } .right-placeholder { display: none; } }
    @media (max-width: 800px) { .main-grid { grid-template-columns: minmax(0,1fr); } .left-browser { display: none; } }

    /* Panels */
    .left-browser { background: linear-gradient(to bottom,#050b2a,#020319); border-right: 1px solid #000; display: flex; flex-direction: column; min-height: 0; }
    .center-timeline-wrap { background: radial-gradient(circle at 0 0,#253bff,#050a23 45%,#020419 100%); display: flex; flex-direction: column; min-height: 0; border-right: 1px solid #000; }
    .right-placeholder { background: linear-gradient(to bottom,#050b2a,#020319); border-left: 1px solid #000; padding: 6px 8px; font-size: 11px; color: var(--text-muted); }

    /* BROWSER STYLES */
    .panel-header {
      padding: 4px 8px; border-bottom: 1px solid rgba(0,0,0,0.9); background: linear-gradient(to bottom,#091650,#050a28);
      display: flex; align-items: center; justify-content: space-between; font-size: 11px;
    }
    .panel-title { text-transform: uppercase; letter-spacing: .14em; font-size: 10px; color: var(--accent4); }
    .browser-search { padding: 4px 8px; border-bottom: 1px solid rgba(0,0,0,0.9); display: flex; align-items: center; gap: 6px; background: #050b26; font-size: 10px; }
    .browser-search input { flex: 1; border-radius: 999px; border: 1px solid rgba(0,0,0,0.8); background: #02041b; color: var(--text-main); font-size: 10px; padding: 3px 8px; }
    .browser-scroll { flex: 1; min-height: 0; overflow-y: auto; padding: 6px 8px 10px; font-size: 11px; color: var(--text-muted); scrollbar-width: thin; }
    .browser-section-title { font-size: 9px; text-transform: uppercase; letter-spacing: .14em; color: #7cbeff; margin: 6px 0 2px; }
    .browser-item { padding: 3px 4px; border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .browser-item:hover { background: rgba(124,190,255,0.15); }
    .browser-item span:last-child { font-size: 9px; color: #ffd77c; }

    /* TIMELINE CONTROLS */
    .timeline-header { padding: 4px 8px 2px; border-bottom: 1px solid rgba(0,0,0,0.9); background: linear-gradient(to bottom,#091650,#050a24); display: flex; flex-direction: column; gap: 4px; font-size: 11px; }
    .timeline-screen { display: flex; justify-content: center; align-items: center; padding: 4px 0 6px; background: #02030f; }
    .screen-grid { display: flex; gap: 6px; max-width: 720px; width: 100%; justify-content: center; padding: 4px 6px; border-radius: 8px; background: #02030f; }
    .screen-box { flex: 1 1 0; min-width: 140px; border-radius: 5px; border: 1px solid rgba(255,255,255,0.06); background: #02041b; padding: 4px 8px 5px; display: flex; flex-direction: column; justify-content: center; }
    .screen-label { font-size: 9px; text-transform: uppercase; letter-spacing: .18em; color: var(--text-muted); margin-bottom: 2px; }
    .screen-value { font-family: monospace; font-size: 12px; letter-spacing: .12em; color: #f7fbff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .timeline-row-top { display: flex; align-items: center; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
    .transport-buttons { display: flex; align-items: center; gap: 4px; }
    .transport-btn { width: 26px; height: 24px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.9); background: radial-gradient(circle at 0 0,#4aa8ff,#050a24); color: #02041b; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.85); }
    .transport-btn.rec { background: radial-gradient(circle at 0 0,#ff4a7a,#3a0210); color: #ffe9f0; }
    .transport-btn.active { box-shadow: 0 0 14px rgba(255,255,255,0.85); border-color: #fff; }
    
    /* SCROLL & GRID */
    .timeline-scrollbar { width: 100%; height: 6px; border-radius: 999px; background: #040825; border: 1px solid rgba(0,0,0,0.9); overflow: hidden; margin-top: 2px; position: relative; }
    .timeline-scroll-thumb { position: absolute; top: 0; left: 0; height: 100%; border-radius: 999px; background: linear-gradient(to right,#4aa8ff,#7cffc7); box-shadow: 0 0 12px rgba(124,190,255,0.9); display: flex; justify-content: space-between; }
    .timeline-main { flex: 1; min-height: 0; display: grid; grid-template-columns: 170px minmax(0,1fr) 16px; }
    
    .track-list { background: linear-gradient(to bottom,#050a28,#020317); border-right: 1px solid #000; font-size: 11px; color: var(--text-muted); overflow-y: auto; }
    .track-header { display: flex; align-items: center; padding: 4px 4px; border-bottom: 1px solid rgba(255,255,255,0.04); background: rgba(7,14,60,0.96); height: 40px; gap: 3px; cursor: grab; }
    .track-header:nth-child(odd) { background: rgba(8,16,70,0.96); }
    .track-name { flex: 1; padding: 2px 4px; color: #f7fbff; font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .timeline-grid-wrap { position: relative; background: #050822; overflow: auto; }
    .timeline-ruler { position: sticky; top: 0; height: 22px; background: linear-gradient(to bottom,#091650,#050a24); border-bottom: 1px solid rgba(0,0,0,0.9); display: flex; align-items: flex-end; z-index: 2; font-size: 9px; color: var(--text-muted); user-select: none; }
    .grid-inner { position: relative; padding: 0 8px 8px; background-image: linear-gradient(to right,var(--grid-line) 1px,transparent 1px), linear-gradient(to right,rgba(124,190,255,0.12) 1px,transparent 1px), linear-gradient(to bottom,var(--grid-line) 1px,transparent 1px); background-size: var(--beat-width,48px) 1px, calc(var(--beat-width,48px) / 4) 1px, 1px var(--track-height,40px); }
    
    .playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom,#ffd77c,#ff7cf1); box-shadow: 0 0 12px rgba(255,215,124,0.9); pointer-events: none; z-index: 10; }
    .clip { position: absolute; top: 6px; height: 28px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.6); box-shadow: 0 0 16px rgba(0,0,0,0.9); display: flex; align-items: center; padding: 0 6px; font-size: 10px; color: #02041b; cursor: move; white-space: nowrap; overflow: hidden; }
    .clip[data-color="blue"] { background: linear-gradient(135deg,var(--clip-blue),#7cbeff); }
    .clip[data-color="purple"] { background: linear-gradient(135deg,var(--clip-purple),#ffb4ff); }
    
    /* Automation Clip SVG Styling */
    .automation-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .automation-path { fill: none; stroke: rgba(255,255,255,0.7); stroke-width: 2; }
    .clip-label { position: relative; z-index: 2; text-shadow: 0 0 4px rgba(255,255,255,0.8); font-weight: bold; }

    /* BOTTOM DOCK */
    .bottom-dock { margin-top: 6px; border-radius: 9px; border: 1px solid rgba(0,0,0,0.9); background: radial-gradient(circle at 0 0,#2a3bff,#050a21 45%,#020419 100%); box-shadow: var(--shadow-soft); display: flex; flex-direction: column; min-height: 20px; max-height: 520px; position: relative; }
    .bottom-tabs { display: flex; padding: 4px 8px; border-bottom: 1px solid rgba(0,0,0,0.9); background: linear-gradient(to bottom,#091650,#050a24); font-size: 10px; gap: 6px; flex-shrink: 0; }
    .bottom-tab { padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(0,0,0,0.8); background: rgba(4,8,40,0.9); color: var(--text-muted); cursor: pointer; }
    .bottom-tab.active { border-color: #fff; color: var(--accent3); box-shadow: 0 0 10px rgba(255,215,124,0.8); }
    .bottom-panels { flex: 1; min-height: 0; display: grid; }
    .bottom-panel { padding: 6px 8px; font-size: 11px; display: none; overflow: hidden; }
    .bottom-panel.active { display: flex; flex-direction: column; min-height: 0; }

    /* MIXER STYLES */
    .mixer-strips { flex: 1; min-height: 0; display: flex; align-items: flex-end; gap: 8px; overflow-x: auto; padding: 4px 4px 8px; background: radial-gradient(circle at 0 0,#1b2747,#050815 55%,#01020b 100%); border-radius: 6px; }
    .mixer-strip { flex: 0 0 72px; height: 100%; border-radius: 6px; background: linear-gradient(to bottom,#071425,#040917); border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 0 12px rgba(0,0,0,0.8); display: flex; flex-direction: column; padding: 3px; color: var(--text-muted); }
    .mixer-fader-shell { width: 22px; height: 100%; border-radius: 999px; background: #030612; border: 1px solid rgba(255,255,255,0.05); position: relative; margin: 0 auto; }
    .mixer-fader-knob { position: absolute; left: 3px; right: 3px; height: 12px; border-radius: 999px; background: #8f9bb0; cursor: ns-resize; }
    .mixer-send-section { height: 30px; border-top: 1px solid #333; margin-top: 4px; display: flex; align-items: center; justify-content: space-around; }
    .send-knob { width: 14px; height: 14px; border-radius: 50%; border: 1px solid #666; cursor: pointer; }
    .send-knob.active { background: var(--accent3); box-shadow: 0 0 6px var(--accent3); border-color: #fff; }

    /* RACK & GRAPH EDITOR */
    .rack-row { display: flex; flex-direction: column; background: rgba(255,255,255,0.03); margin-bottom: 2px; border-radius: 4px; border: 1px solid #000; }
    .rack-main { display: flex; align-items: center; padding: 4px; }
    .step-sequencer { display: flex; gap: 2px; margin-left: 10px; flex: 1; }
    .step-btn { flex: 1; height: 24px; background: #1a1a1a; border: 1px solid #333; cursor: pointer; border-radius: 2px; }
    .step-btn.active { background: #ddd; box-shadow: 0 0 5px #fff; }
    .step-btn:nth-child(4n+1) { background: #252525; }
    .graph-editor { height: 0; overflow: hidden; display: flex; gap: 2px; padding: 0 4px 4px 120px; transition: height 0.2s; }
    .graph-editor.open { height: 40px; }
    .graph-bar { flex: 1; background: #444; align-self: flex-end; border: 1px solid #000; cursor: ns-resize; }
    .graph-bar:hover { background: var(--accent); }

    /* POPUPS */
    .context-menu { position: fixed; background: #050b24; border: 1px solid #444; color: #eee; padding: 5px 0; border-radius: 4px; display: none; z-index: 9999; box-shadow: 0 0 15px #000; }
    .ctx-item { padding: 5px 15px; font-size: 11px; cursor: pointer; }
    .ctx-item:hover { background: var(--accent); color: #000; }
    
    .plugin-window { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; background: #111; border: 1px solid #444; border-radius: 8px; z-index: 1000; box-shadow: 0 0 30px #000; display: none; flex-direction: column; }
    .plugin-header { padding: 8px; background: #222; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; border-radius: 8px 8px 0 0; }
    .plugin-body { padding: 20px; color: #ccc; font-size: 12px; min-height: 200px; }

  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand-left">
      <div class="brand-logo">S</div>
      <div>
        <div class="brand-text-main">SOUND Studio</div>
        <div class="brand-text-sub"><span style="color:var(--accent);">AI</span> ¬∑ Mix ¬∑ Master</div>
      </div>
    </div>
    <div class="top-right">
      <div class="session-pill">
        <div class="session-dot"></div>
        <span>CPU: <span id="cpu-val" style="color:var(--accent3);">4%</span></span>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="icon-dock">
    <div class="icon-row">
      <div class="dock-icon" data-panel="browser"><span>F</span></div>
      <div class="dock-icon active" data-panel="timeline"><span>T</span></div>
      <div class="dock-icon" data-panel="rack"><span>R</span></div>
      <div class="dock-icon" data-panel="mixer"><span>M</span></div>
    </div>
    <div class="dock-icon-labels">
      <span style="color:#4aa8ff;">Browser</span>
      <span style="color:#ff8a7c;">Timeline</span>
      <span style="color:#7cffc7;">Rack</span>
      <span style="color:#ff7cf1;">Mixer</span>
    </div>
  </section>

  <section class="main-grid">
    <aside class="left-browser">
      <div class="panel-header"><div class="panel-title">Device Browser</div></div>
      <div class="browser-search"><span>üîç</span><input type="text" placeholder="Find..."></div>
      <div class="browser-scroll">
        <div class="browser-section-title">Current Project</div>
        <div class="browser-item"><span>History</span></div>
        <div class="browser-item"><span>Patterns</span></div>
        <div class="browser-section-title">Library</div>
        <div class="browser-item"><span>Generators</span><span>GEN</span></div>
        <div class="browser-item"><span>Effects</span><span>FX</span></div>
        <div class="browser-item"><span>Packs</span><span>WAV</span></div>
      </div>
    </aside>

    <section class="center-timeline-wrap">
      <div class="timeline-header">
        <div class="timeline-row-top">
          <div class="timeline-title">Arrangement</div>
          <div class="transport-buttons">
            <button class="transport-btn" id="btn-play">‚ñ∂</button>
            <button class="transport-btn" id="btn-stop">‚èπ</button>
            <button class="transport-btn rec" id="btn-rec">‚óè</button>
            <button class="transport-btn" onclick="togglePerfMode()" id="btn-perf" title="Performance Mode">‚ö°</button>
          </div>
          <div class="tempo-pill">
            <span class="tempo-value">130.0</span> BPM
          </div>
        </div>
        <div class="timeline-scrollbar">
          <div class="timeline-scroll-thumb" style="width: 20%; left: 0;"></div>
        </div>
      </div>

      <div class="timeline-main">
        <div class="track-list" id="track-list">
          </div>
        <div class="timeline-grid-wrap" id="grid-wrap">
          <div class="timeline-ruler" id="ruler"></div>
          <div class="grid-inner" id="grid-inner">
            <div class="playhead" id="playhead"></div>
            </div>
        </div>
      </div>
    </section>

    <aside class="right-placeholder">
      <h3>Project Info</h3>
      <p>Title: Untitled</p>
      <p>Time: 00:00:00</p>
      <p>Active Pattern: 1</p>
    </aside>
  </section>

  <section class="bottom-dock" id="bottom-dock">
    <div class="bottom-tabs">
      <div class="bottom-tab active" onclick="switchTab('mixer')">Mixer</div>
      <div class="bottom-tab" onclick="switchTab('rack')">Channel Rack</div>
      <div class="bottom-tab" onclick="switchTab('piano')">Piano Roll</div>
    </div>
    
    <div class="bottom-panel active" id="panel-mixer">
      <div class="mixer-strips" id="mixer-strips">
        </div>
    </div>

    <div class="bottom-panel" id="panel-rack" style="overflow-y:auto; display:none;">
      <div style="margin-bottom:5px; display:flex; gap:10px;">
        <button class="transport-btn" onclick="addChannel()">+ Add</button>
        <button class="transport-btn" onclick="toggleGraphEditor()">Graph Editor</button>
      </div>
      <div id="rack-container"></div>
    </div>

    <div class="bottom-panel" id="panel-piano" style="display:none; position:relative;">
      <div style="position:absolute; top:5px; right:10px; z-index:10;">
        <button class="transport-btn" title="Slide Note / Portamento">Slide</button>
      </div>
      <div style="display:grid; grid-template-columns: 50px 1fr; height:100%; background:#222;">
        <div id="piano-keys" style="background:#eee; border-right:1px solid #000;"></div>
        <div id="piano-grid" style="background-image:linear-gradient(#333 1px, transparent 1px); background-size:100% 16px; position:relative;"></div>
      </div>
    </div>
  </section>

  <section class="hint-bar">
    <span id="hint-text">Welcome to SOUND Studio. Press F1 for Help.</span>
  </section>
</main>

<div id="rec-menu" class="context-menu">
  <div class="ctx-item"><b>Recording Filter</b></div>
  <div class="ctx-item">‚úî Audio</div>
  <div class="ctx-item">‚úî Automation</div>
  <div class="ctx-item">‚úî Notes (Score)</div>
  <div class="ctx-item">‚úî Clips</div>
</div>

<div class="plugin-window" id="plugin-window">
  <div class="plugin-header">
    <span id="plugin-title">Plugin</span>
    <button onclick="closePlugin()" style="background:red; border:none; color:white; border-radius:50%; width:20px; height:20px; cursor:pointer;">√ó</button>
  </div>
  <div class="plugin-body" id="plugin-content"></div>
</div>

<script>
  /* === STATE === */
  let isPlaying = false;
  let currentBeat = 0;
  let tempo = 130;
  let showGraph = false;
  let perfMode = false;
  let animFrame;

  /* === DATA === */
  const tracks = [
    { id: 1, name: "Drums", color: "blue" },
    { id: 2, name: "Bass", color: "green" },
    { id: 3, name: "Automation", color: "purple" },
    { id: 4, name: "Vocals", color: "pink" }
  ];

  const clips = [
    { track: 1, start: 0, len: 4, name: "Pattern 1", type: "pattern", color: "blue" },
    { track: 2, start: 4, len: 4, name: "Bassline", type: "pattern", color: "green" },
    { track: 3, start: 0, len: 8, name: "Vol Auto", type: "automation", color: "purple" },
    { track: 4, start: 8, len: 4, name: "Vocal_Take1", type: "audio", color: "pink" }
  ];

  const channels = [
    { name: "Kick", steps: [1,0,0,0, 1,0,0,0, 1,0,0,0, 1,0,0,0] },
    { name: "Snare", steps: [0,0,0,0, 1,0,0,0, 0,0,0,0, 1,0,0,0] },
    { name: "Hat", steps: [1,1,1,1, 1,1,1,1, 1,1,1,1, 1,1,1,1] }
  ];

  /* === INITIALIZATION === */
  function init() {
    renderTracks();
    renderClips();
    renderMixer();
    renderRack();
    renderPianoKeys();
    setupEventListeners();
  }

  /* === RENDERERS === */
  function renderTracks() {
    const list = document.getElementById('track-list');
    const inner = document.getElementById('grid-inner');
    
    tracks.forEach(t => {
      // Header
      const head = document.createElement('div');
      head.className = 'track-header';
      head.innerHTML = `<div style="width:10px; height:10px; background:var(--clip-${t.color}); border-radius:50%; margin-right:5px;"></div>
                        <span class="track-name">${t.name}</span>`;
      list.appendChild(head);

      // Grid Row
      const row = document.createElement('div');
      row.className = 'grid-track-row';
      row.style.height = '40px';
      row.style.borderBottom = '1px solid rgba(255,255,255,0.08)';
      row.dataset.id = t.id;
      inner.appendChild(row);
    });
  }

  function renderClips() {
    // Clear existing dynamic clips only (keep playhead)
    document.querySelectorAll('.clip').forEach(e => e.remove());
    const container = document.getElementById('grid-inner');

    clips.forEach(c => {
      const el = document.createElement('div');
      el.className = `clip clip-${c.type}`;
      el.style.left = (c.start * 48) + 'px';
      el.style.width = (c.len * 48) + 'px';
      el.style.top = ((c.track - 1) * 40 + 2) + 'px';
      el.style.background = `var(--clip-${c.color})`;
      el.style.opacity = perfMode ? '0.6' : '1'; // Dim clips in perf mode
      
      // Content based on type
      let content = `<span class="clip-label">${c.name}</span>`;
      
      if(c.type === 'automation') {
        // Draw SVG curve [cite: 2538]
        content += `<svg class="automation-svg" viewBox="0 0 100 100" preserveAspectRatio="none">
          <path class="automation-path" d="M0,80 C30,80 40,20 70,20 S100,80 100,80" />
        </svg>`;
      } else if(c.type === 'audio') {
        // Pseudo-waveform
        content += `<div style="position:absolute; bottom:0; width:100%; height:50%; background:rgba(0,0,0,0.3); clip-path: polygon(0 50%, 10% 0, 20% 100%, 30% 20%, 40% 80%, 50% 50%, 60% 90%, 70% 10%, 80% 70%, 90% 30%, 100% 50%, 100% 100%, 0 100%);"></div>`;
        el.ondblclick = () => openAudioEditor(c.name); // 
      }

      el.innerHTML = content;
      container.appendChild(el);
    });
  }

  function renderMixer() {
    const container = document.getElementById('mixer-strips');
    container.innerHTML = '';
    
    for(let i=0; i<=10; i++) {
      const isMaster = i===0;
      const strip = document.createElement('div');
      strip.className = 'mixer-strip';
      strip.style.border = isMaster ? '1px solid #666' : '';
      
      strip.innerHTML = `
        <div style="text-align:center; font-size:9px; margin-bottom:5px;">${isMaster ? 'Master' : 'Ins '+i}</div>
        <div class="mixer-fader-shell">
          <div class="mixer-fader-knob" style="bottom: 75%;"></div>
        </div>
        <div class="mixer-send-section">
           <div class="send-knob" title="Send Amount"></div>
           <div style="font-size:8px;">‚áã</div>
        </div>
      `;
      container.appendChild(strip);
    }
  }

  function renderRack() {
    const container = document.getElementById('rack-container');
    container.innerHTML = '';

    channels.forEach(ch => {
      const row = document.createElement('div');
      row.className = 'rack-row';
      
      // Main Controls
      let html = `
      <div class="rack-main">
        <div style="width:10px; height:10px; background:#ddd; margin-right:5px; border-radius:2px;"></div>
        <button style="background:#444; color:#ddd; border:1px solid #222; width:80px; font-size:10px; cursor:pointer;">${ch.name}</button>
        <div class="step-sequencer">`;
      
      // Steps [cite: 624]
      for(let s=0; s<16; s++) {
        const active = ch.steps[s] ? 'active' : '';
        const group = s % 4 === 0 ? 'border-left:1px solid #555;' : '';
        html += `<div class="step-btn ${active}" style="${group}" onclick="this.classList.toggle('active')"></div>`;
      }
      html += `</div></div>`;

      // Graph Editor [cite: 624] - Per step parameters
      const display = showGraph ? 'open' : '';
      html += `<div class="graph-editor ${display}">`;
      for(let s=0; s<16; s++) {
        // Random height for demo
        let h = Math.random() * 80 + 10; 
        html += `<div class="graph-bar" style="height:${h}%;" title="Velocity/Pitch"></div>`;
      }
      html += `</div>`;

      row.innerHTML = html;
      container.appendChild(row);
    });
  }

  function renderPianoKeys() {
    const k = document.getElementById('piano-keys');
    const keys = ['white','black','white','black','white','white','black','white','black','white','black','white'];
    for(let i=0; i<24; i++) { // 2 octaves
      const type = keys[i % 12];
      const key = document.createElement('div');
      key.style.height = type==='white' ? '16px' : '10px';
      key.style.background = type==='white' ? '#fff' : '#000';
      key.style.borderBottom = '1px solid #ccc';
      if(type==='black') key.style.marginBottom = '6px';
      k.appendChild(key);
    }
  }

  /* === LOGIC & INTERACTION === */
  
  // Tab Switching
  window.switchTab = function(id) {
    document.querySelectorAll('.bottom-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.bottom-panel').forEach(p => p.style.display = 'none');
    document.querySelectorAll('.bottom-panel').forEach(p => p.classList.remove('active'));
    
    event.target.classList.add('active');
    const panel = document.getElementById('panel-'+id);
    panel.style.display = (id === 'mixer' ? 'flex' : 'block'); // Mixer needs flex
    panel.classList.add('active');
  }

  // Transport
  const playBtn = document.getElementById('btn-play');
  const ph = document.getElementById('playhead');

  playBtn.addEventListener('click', () => {
    if(isPlaying) {
      isPlaying = false;
      playBtn.classList.remove('active');
      playBtn.style.color = '#02041b';
      cancelAnimationFrame(animFrame);
    } else {
      isPlaying = true;
      playBtn.classList.add('active');
      playBtn.style.color = '#fff';
      animate();
    }
  });

  function animate() {
    let left = parseFloat(ph.style.left || 0);
    left += (tempo / 60) * 0.5; // Speed sim
    if(left > 800) left = 0;
    ph.style.left = left + 'px';
    if(isPlaying) animFrame = requestAnimationFrame(animate);
  }

  document.getElementById('btn-stop').addEventListener('click', () => {
    isPlaying = false;
    playBtn.classList.remove('active');
    ph.style.left = '0px';
    cancelAnimationFrame(animFrame);
  });

  // Rec Context Menu 
  const recBtn = document.getElementById('btn-rec');
  const recMenu = document.getElementById('rec-menu');
  
  recBtn.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    recMenu.style.display = 'block';
    recMenu.style.left = e.pageX + 'px';
    recMenu.style.top = e.pageY + 'px';
  });

  window.addEventListener('click', (e) => {
    if(!e.target.closest('#btn-rec')) recMenu.style.display = 'none';
  });

  // Graph Editor Toggle
  window.toggleGraphEditor = function() {
    showGraph = !showGraph;
    renderRack();
  }

  // Performance Mode Toggle 
  window.togglePerfMode = function() {
    perfMode = !perfMode;
    const btn = document.getElementById('btn-perf');
    if(perfMode) {
      btn.classList.add('active');
      btn.style.color = 'white';
      document.getElementById('hint-text').innerText = "Performance Mode: Trigger clips live!";
    } else {
      btn.classList.remove('active');
      btn.style.color = '#02041b';
      document.getElementById('hint-text').innerText = "";
    }
    renderClips();
  }

  // Audio Editor (Pseudo-Edison) 
  window.openAudioEditor = function(name) {
    const win = document.getElementById('plugin-window');
    const title = document.getElementById('plugin-title');
    const body = document.getElementById('plugin-content');
    
    title.innerText = "Wave Doctor - " + name;
    body.innerHTML = `
      <div style="background:#333; height:100px; width:100%; position:relative; border:1px solid #555;">
        <svg viewBox="0 0 100 20" preserveAspectRatio="none" style="width:100%; height:100%; fill:var(--accent);">
           <path d="M0,10 L10,2 L20,18 L30,5 L40,15 L50,10 L60,2 L70,18 L80,5 L90,15 L100,10 V20 H0 Z" />
        </svg>
      </div>
      <div style="margin-top:10px; display:flex; gap:5px;">
        <button class="transport-btn">Trim</button>
        <button class="transport-btn">Fade In</button>
        <button class="transport-btn">Fade Out</button>
        <button class="transport-btn">Normalize</button>
      </div>
    `;
    win.style.display = 'flex';
  }

  window.closePlugin = function() {
    document.getElementById('plugin-window').style.display = 'none';
  }

  function setupEventListeners() {
    // Hover hints
    document.querySelectorAll('[data-panel]').forEach(el => {
      el.addEventListener('mouseenter', () => {
        document.getElementById('hint-text').innerText = "Open " + el.nextElementSibling.innerText + " Panel";
      });
    });
  }

  init();

</script>
</body>
</html>
