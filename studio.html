<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sulandra AI Studio ‚Äì Sound ¬∑ Cinema ¬∑ Photolab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050712;
      --bg-soft: #0b0f1e;
      --panel: #101526;
      --panel-soft: #141a2b;
      --panel-alt: #181f33;
      --accent: #ff5af1;
      --accent-2: #45f1ff;
      --accent-3: #ffd15a;
      --border-soft: rgba(255,255,255,0.08);
      --text-main: #f5f7ff;
      --text-muted: #9ca4c7;
      --danger: #ff4b6a;
      --success: #3ed8a9;
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-pill: 999px;
      --shadow-soft: 0 0 40px rgba(0,0,0,0.8);
    }
    body[data-theme="gray"] {
      --bg: #06070c;
      --bg-soft: #10111b;
      --panel: #181926;
      --panel-soft: #1e2132;
      --panel-alt: #23263a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Inter", sans-serif;
      background:
        radial-gradient(circle at top left, #1c2142 0, #050712 45%, #020308 100%);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
    }
    a { color: inherit; text-decoration: none; }

    /* NAV */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(18px);
      background: linear-gradient(to right, rgba(5,7,18,0.96), rgba(5,7,18,0.86));
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .nav-inner {
      max-width: 1280px;
      margin: 0 auto;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    .brand { display:flex;align-items:center;gap:8px; }
    .brand-icon {
      width: 30px;
      height: 30px;
      border-radius: 10px;
      background: conic-gradient(from 210deg,#ff5af1,#45f1ff,#ffd15a,#ff5af1);
      box-shadow: 0 0 18px rgba(255,90,241,0.7);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:17px;color:#050712;
    }
    .brand-text-main {
      font-weight:650;
      letter-spacing:0.04em;
      text-transform:uppercase;
      font-size:13px;
    }
    .brand-text-sub {
      font-size:11px;
      text-transform:uppercase;
      color:var(--text-muted);
      letter-spacing:0.16em;
    }
    .nav-links {
      display:flex;
      gap:10px;
      align-items:center;
      font-size:13px;
      flex-wrap:wrap;
    }
    .nav-links a {
      padding:7px 11px;
      border-radius:999px;
      color:var(--text-muted);
      border:1px solid transparent;
      transition:all .18s ease-out;
    }
    .nav-links a:hover {
      color:var(--text-main);
      border-color:rgba(255,255,255,0.08);
      background:radial-gradient(circle at top left,rgba(255,90,241,0.18),transparent 55%);
    }
    .nav-links a.active {
      color:#050712;
      font-weight:600;
      background:linear-gradient(120deg,#ff5af1,#45f1ff);
      box-shadow:0 0 18px rgba(69,241,255,0.7);
      border-color:transparent;
    }
    .nav-right{display:flex;align-items:center;gap:10px;}
    .credits-pill{
      padding:6px 12px;
      border-radius:var(--radius-pill);
      font-size:11px;
      border:1px solid rgba(255,255,255,0.12);
      background:radial-gradient(circle at top left,rgba(69,241,255,0.3),rgba(5,7,18,0.95));
      display:flex;align-items:center;gap:6px;
    }
    .profile-chip{
      display:flex;align-items:center;gap:8px;
      padding:6px 11px;
      border-radius:999px;
      background:rgba(10,14,30,0.97);
      border:1px solid rgba(255,255,255,0.12);
      font-size:11px;
      cursor:pointer;
    }
    .profile-avatar{
      width:22px;height:22px;border-radius:999px;
      background:linear-gradient(135deg,#45f1ff,#ff5af1);
      display:flex;align-items:center;justify-content:center;
      font-size:13px;font-weight:700;color:#050712;
    }
    .badge-plan{
      padding:2px 7px;
      border-radius:999px;
      background:rgba(255,90,241,0.18);
      border:1px solid rgba(255,90,241,0.65);
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.12em;
    }

    main {
      flex:1;
      max-width: 1280px;
      margin: 14px auto 24px;
      padding: 0 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    /* Menubar */
    .studio-menubar {
      border-radius: 14px;
      padding: 6px 10px;
      background: linear-gradient(135deg,rgba(10,13,28,0.97),rgba(4,6,18,0.98));
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-soft);
      flex-wrap:wrap;
      gap:6px;
    }
    .menu-left, .menu-right {
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .menu-item {
      font-size:11px;
      padding:4px 8px;
      border-radius:7px;
      color:var(--text-muted);
      cursor:pointer;
    }
    .menu-item:hover {
      background:rgba(255,255,255,0.06);
      color:var(--text-main);
    }
    .menu-item.bold {font-weight:600;}
    .theme-chip{
      padding:4px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      font-size:10px;
      cursor:pointer;
      color:var(--text-muted);
      background:rgba(7,9,20,0.98);
    }
    .theme-chip.active{
      background:linear-gradient(120deg,#ff5af1,#45f1ff);
      border-color:transparent;
      color:#050712;
      font-weight:600;
      box-shadow:0 0 12px rgba(69,241,255,0.7);
    }

    /* Overview cards */
    .overview-grid {
      margin-top: 6px;
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px;
    }
    @media(max-width:1000px){
      .overview-grid{grid-template-columns:repeat(1,minmax(0,1fr));}
    }
    .overview-card {
      position:relative;
      overflow:hidden;
      border-radius:var(--radius-xl);
      padding:14px 14px 12px;
      background:
        radial-gradient(circle at 0% 0%,rgba(255,90,241,0.35),transparent 60%),
        radial-gradient(circle at 100% 100%,rgba(69,241,255,0.28),transparent 60%),
        rgba(9,11,26,0.98);
      border:1px solid rgba(255,255,255,0.12);
      box-shadow:0 0 28px rgba(0,0,0,0.85);
      cursor:pointer;
      transition:transform .16s ease-out, box-shadow .16s ease-out, border-color .16s;
    }
    .overview-card::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:conic-gradient(from 220deg,rgba(255,90,241,0.12),rgba(69,241,255,0.12),rgba(255,209,90,0.16),rgba(255,90,241,0.12));
      opacity:0;
      animation:pulseGlow 6s linear infinite;
      mix-blend-mode:screen;
      pointer-events:none;
    }
    .overview-card:hover {
      transform:translateY(-2px);
      border-color:rgba(255,255,255,0.26);
      box-shadow:0 0 36px rgba(69,241,255,0.7);
    }
    .overview-tagline{
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.18em;
      color:rgba(245,247,255,0.7);
      margin-bottom:4px;
    }
    .overview-card h2{
      margin:0 0 4px;
      font-size:15px;
    }
    .overview-card p{
      margin:0;
      font-size:12px;
      color:var(--text-muted);
      line-height:1.6;
    }
    .overview-chip-row{
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      font-size:10px;
    }
    .overview-chip{
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(7,10,24,0.96);
      color:var(--text-muted);
    }
    @keyframes pulseGlow {
      0%{opacity:0;}
      30%{opacity:0.6;}
      60%{opacity:0;}
      100%{opacity:0;}
    }

    /* Mode tabs */
    .mode-tabs {
      margin-top:8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .tab-buttons{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .mode-tab{
      border-radius:var(--radius-pill);
      padding:7px 14px;
      border:1px solid rgba(255,255,255,0.16);
      background:rgba(8,10,22,0.98);
      font-size:12px;
      color:var(--text-muted);
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .mode-tab span.icon{font-size:16px;}
    .mode-tab.active{
      background:linear-gradient(120deg,#ff5af1,#45f1ff);
      border-color:transparent;
      color:#050712;
      font-weight:600;
      box-shadow:0 0 16px rgba(69,241,255,0.7);
    }
    .mode-helper{
      font-size:11px;
      color:var(--text-muted);
    }

    /* TRANSPORT */
    .transport{
      margin-top:6px;
      border-radius:var(--radius-xl);
      padding:8px 12px;
      background:linear-gradient(135deg,rgba(13,18,40,0.97),rgba(4,6,18,0.98));
      border:1px solid rgba(255,255,255,0.1);
      display:flex;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:10px;
      box-shadow:var(--shadow-soft);
    }
    .transport-group{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .t-btn{
      width:28px;height:28px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(9,11,26,0.98);
      display:flex;align-items:center;justify-content:center;
      font-size:14px;
      cursor:pointer;
      color:var(--text-main);
    }
    .t-btn.primary{
      background:linear-gradient(120deg,#ff5af1,#45f1ff);
      color:#050712;
      border-color:transparent;
      box-shadow:0 0 14px rgba(69,241,255,0.65);
    }
    .t-btn.playing{
      box-shadow:0 0 16px rgba(69,241,255,0.9);
    }
    .t-btn.recording{
      background:#ff4b6a;
      border-color:#ff4b6a;
      color:#050712;
      box-shadow:0 0 14px rgba(255,75,106,0.9);
    }
    .t-btn.metronome-on{
      background:linear-gradient(120deg,#ffd15a,#ff9f5a);
      color:#050712;
      box-shadow:0 0 14px rgba(255,209,90,0.9);
    }
    .transport-label{font-size:11px;color:var(--text-muted);}
    .tiny-input{
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(3,5,14,0.98);
      color:var(--text-main);
      padding:4px 6px;
      font-size:11px;
      min-width:58px;
    }
    .badge-small{
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:0.13em;
      color:var(--text-muted);
    }
    .badge-route{
      border-color:rgba(69,241,255,0.8);
      color:var(--accent-2);
    }
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-size:11px;
      color:var(--text-muted);
      cursor:pointer;
    }
    .toggle input{margin:0;}

    /* MODE containers */
    .mode-container{
      margin-top:10px;
      border-radius:22px;
      background:
        radial-gradient(circle at 0% 0%,rgba(255,90,241,0.2),transparent 65%),
        radial-gradient(circle at 100% 100%,rgba(69,241,255,0.25),transparent 60%),
        rgba(4,6,16,0.98);
      border:1px solid rgba(255,255,255,0.1);
      box-shadow:var(--shadow-soft);
      padding:10px;
      display:none;
    }
    .mode-container.active{display:block;}

    .panel{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel-soft),var(--panel));
      border:1px solid rgba(255,255,255,0.12);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .panel-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--text-muted);
    }
    .panel-title-main{font-weight:600;color:var(--text-main);}
    .panel-body{flex:1;overflow:auto;font-size:12px;}

    /* SOUND LAYOUT */
    .sound-layout{
      display:grid;
      grid-template-columns:260px minmax(0,1.8fr) 260px;
      gap:10px;
      min-height:480px;
    }
    @media(max-width:1100px){
      .sound-layout{grid-template-columns:minmax(0,1fr);}
    }

    .browser-section-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--text-muted);
      margin-bottom:4px;
    }
    .browser-list{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .browser-item{
      border-radius:9px;
      padding:5px 7px;
      background:rgba(6,8,18,0.95);
      border:1px solid rgba(255,255,255,0.08);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
    }
    .browser-item span.label{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .browser-item:hover{
      border-color:rgba(69,241,255,0.8);
      box-shadow:0 0 10px rgba(69,241,255,0.6);
    }

    .sample-pads{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }
    .sample-pad{
      flex:0 0 calc(33% - 4px);
      min-width:60px;
      border-radius:9px;
      padding:6px 4px;
      background:radial-gradient(circle at 30% 0%,rgba(255,255,255,0.08),transparent 60%);
      border:1px solid rgba(255,255,255,0.16);
      text-align:center;
      font-size:10px;
      cursor:pointer;
      color:var(--text-muted);
    }
    .sample-pad:hover{
      border-color:rgba(69,241,255,0.9);
      color:var(--text-main);
      box-shadow:0 0 12px rgba(69,241,255,0.7);
    }

    .sound-top-controls{
      margin-top:4px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      font-size:11px;
      color:var(--text-muted);
      flex-wrap:wrap;
    }
    .loop-controls{
      display:flex;
      align-items:center;
      gap:4px;
      flex-wrap:wrap;
    }

    .timeline-sound{
      border-radius:var(--radius-lg);
      background:linear-gradient(145deg,var(--panel),var(--panel-alt));
      border:1px solid rgba(255,255,255,0.12);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      min-height:440px;
    }
    .bar-ruler{
      display:grid;
      grid-template-columns:220px minmax(0,1fr);
      font-size:10px;
      color:var(--text-muted);
      background:rgba(5,7,18,0.98);
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .bar-ruler-left{
      padding:4px 8px;
      border-right:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .bar-ruler-right{
      padding:4px 8px;
      background-image:linear-gradient(to right,rgba(255,255,255,0.07) 1px,transparent 1px);
      background-size:70px 1px;
      display:flex;
      gap:70px;
      overflow-x:auto;
      scrollbar-width:thin;
    }
    .track-list{
      flex:1;
      overflow:auto;
    }
    .track-row{
      display:grid;
      grid-template-columns:220px minmax(0,1fr);
      min-height:56px;
      background:linear-gradient(to bottom,rgba(12,16,35,0.98),rgba(7,9,20,0.98));
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .track-header{
      padding:6px 7px;
      border-right:1px solid rgba(255,255,255,0.08);
      display:flex;
      flex-direction:column;
      gap:4px;
      font-size:11px;
    }
    .track-name-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
    }
    .track-name-main{font-weight:600;}
    .track-controls{
      display:flex;
      align-items:center;
      gap:4px;
      flex-wrap:wrap;
    }
    .pill-small{
      border-radius:999px;
      padding:2px 5px;
      border:1px solid rgba(255,255,255,0.22);
      font-size:10px;
      cursor:pointer;
      background:rgba(5,7,18,0.96);
      color:var(--text-muted);
    }
    .pill-small.red{border-color:rgba(255,75,106,0.9);color:var(--danger);}
    .pill-small.green{border-color:rgba(62,216,169,0.9);color:var(--success);}
    .pill-small.yellow{border-color:rgba(255,209,90,0.9);color:var(--accent-3);}
    .pill-small.mute-on{
      background:rgba(255,75,106,0.1);
      color:var(--danger);
    }
    .pill-small.solo-on{
      background:rgba(62,216,169,0.1);
      color:var(--success);
    }
    .vol-row{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:10px;
      color:var(--text-muted);
    }
    .vol-row input[type="range"]{
      flex:1;
      accent-color:var(--accent-2);
    }

    .track-action-select{
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(3,5,14,0.98);
      color:var(--text-muted);
      padding:3px 6px;
      font-size:10px;
      min-width:120px;
    }

    .track-lane{
      padding:6px 8px;
      background-image:linear-gradient(to right,rgba(255,255,255,0.05) 1px,transparent 1px);
      background-size:70px 1px;
      display:flex;
      gap:6px;
      align-items:center;
      overflow-x:auto;
      scrollbar-width:thin;
    }
    .clip{
      min-width:120px;
      max-width:260px;
      border-radius:9px;
      padding:4px 7px;
      font-size:10px;
      background:linear-gradient(135deg,rgba(255,90,241,0.5),rgba(69,241,255,0.45));
      box-shadow:0 0 16px rgba(69,241,255,0.7);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      cursor:pointer;
    }
    .clip.stem{
      background:linear-gradient(135deg,rgba(255,209,90,0.5),rgba(255,140,92,0.5));
      box-shadow:0 0 16px rgba(255,209,90,0.7);
    }
    .clip.midi{
      background:linear-gradient(135deg,rgba(62,216,169,0.5),rgba(69,241,255,0.45));
      box-shadow:0 0 16px rgba(62,216,169,0.7);
    }
    .cell-empty{
      min-width:130px;
      border-radius:9px;
      border:1px dashed rgba(255,255,255,0.22);
      padding:4px 7px;
      font-size:10px;
      color:var(--text-muted);
      cursor:pointer;
      background:rgba(5,7,18,0.9);
    }

    .mixer-channels{
      display:flex;
      align-items:flex-end;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }
    .mixer-strip{
      width:60px;
      border-radius:12px;
      background:linear-gradient(145deg,var(--panel),var(--panel-soft));
      border:1px solid rgba(255,255,255,0.16);
      padding:6px 4px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
      font-size:10px;
    }
    .mixer-title{font-size:10px;}
    .mixer-meter{
      width:18px;
      height:110px;
      border-radius:999px;
      background:linear-gradient(to top,#1e222f,#25293a);
      border:1px solid rgba(255,255,255,0.18);
      position:relative;
      overflow:hidden;
    }
    .mixer-meter-fill{
      position:absolute;
      left:2px;
      right:2px;
      bottom:2px;
      height:60%;
      border-radius:999px;
      background:linear-gradient(to top,#41e38f,#ffd15a,#ff5a7a);
      box-shadow:0 0 10px rgba(65,227,143,0.9);
    }
    .mixer-fader{
      width:100%;
      margin-top:4px;
    }
    .mixer-fader input[type="range"]{
      width:100%;
      accent-color:var(--accent);
    }
    .mixer-btn-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:3px;
    }
    .mixer-btn{
      font-size:9px;
      padding:2px 4px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(6,8,18,0.98);
      cursor:pointer;
    }

    /* CINEMA LAYOUT */
    .cinema-layout{
      display:grid;
      grid-template-rows:minmax(260px,320px) minmax(260px,1fr);
      gap:8px;
      min-height:540px;
    }
    @media(max-width:900px){
      .cinema-layout{
        grid-template-rows:minmax(220px,260px) minmax(220px,1fr);
      }
    }
    .cinema-top{
      display:grid;
      grid-template-columns:minmax(0,2fr) 260px;
      gap:8px;
    }
    @media(max-width:1000px){
      .cinema-top{grid-template-columns:minmax(0,1fr);}
    }
    .preview-panel{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel-soft),var(--panel-alt));
      border:1px solid rgba(255,255,255,0.14);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .preview-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-muted);
    }
    .preview-screen{
      flex:1;
      border-radius:12px;
      background:
        radial-gradient(circle at 10% 0%,rgba(255,90,241,0.35),transparent 65%),
        radial-gradient(circle at 100% 100%,rgba(69,241,255,0.3),transparent 60%),
        #050712;
      border:1px solid rgba(255,255,255,0.16);
      box-shadow:0 0 34px rgba(0,0,0,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:13px;
      color:var(--text-muted);
      position:relative;
      margin-top:4px;
    }
    .preview-screen::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:12px;
      background:radial-gradient(circle at top,rgba(255,255,255,0.05),transparent 60%);
      pointer-events:none;
    }
    .preview-controls-bottom{
      margin-top:6px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-muted);
      flex-wrap:wrap;
      gap:6px;
    }
    .preview-controls-left{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .preview-controls-left .t-btn{
      width:26px;
      height:26px;
    }

    .cinema-inspector{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel),var(--panel-soft));
      border:1px solid rgba(255,255,255,0.14);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size:12px;
    }
    .cinema-label-title{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.12em;
      color:var(--text-muted);
    }
    textarea{
      width:100%;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(3,5,14,0.98);
      color:var(--text-main);
      padding:7px 9px;
      font-size:12px;
      resize:vertical;
      min-height:80px;
      font-family:inherit;
    }
    textarea::placeholder{color:rgba(156,164,199,0.75);}
    .chip-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }
    .chip{
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      font-size:10px;
      background:rgba(7,9,20,0.98);
      color:var(--text-muted);
      cursor:pointer;
    }

    .cinema-timeline{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel),var(--panel-alt));
      border:1px solid rgba(255,255,255,0.14);
      display:flex;
      flex-direction:column;
      overflow:hidden;
      min-height:280px;
    }
    .cinema-ruler{
      display:grid;
      grid-template-columns:160px minmax(0,1fr);
      font-size:10px;
      color:var(--text-muted);
      background:rgba(5,7,18,0.98);
      border-bottom:1px solid rgba(255,255,255,0.08);
    }
    .cinema-ruler-left{
      padding:4px 6px;
      border-right:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .cinema-ruler-right{
      padding:4px 8px;
      background-image:linear-gradient(to right,rgba(255,255,255,0.07) 1px,transparent 1px);
      background-size:80px 1px;
      display:flex;
      gap:80px;
      overflow-x:auto;
      scrollbar-width:thin;
    }
    .cinema-track-row{
      display:grid;
      grid-template-columns:160px minmax(0,1fr);
      min-height:46px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      background:linear-gradient(to bottom,rgba(13,17,36,0.98),rgba(9,11,24,0.98));
    }
    .cinema-track-label{
      padding:5px 6px;
      border-right:1px solid rgba(255,255,255,0.08);
      font-size:11px;
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .cinema-track-name{font-weight:600;}
    .cinema-track-actions{
      display:flex;
      gap:4px;
      flex-wrap:wrap;
    }
    .cinema-lane{
      padding:5px 8px;
      background-image:linear-gradient(to right,rgba(255,255,255,0.05) 1px,transparent 1px);
      background-size:80px 1px;
      display:flex;
      align-items:center;
      gap:6px;
      overflow-x:auto;
      scrollbar-width:thin;
    }

    /* PHOTOLAB */
    .photo-layout{
      display:grid;
      grid-template-columns:80px minmax(0,1.9fr) 260px;
      gap:10px;
      min-height:460px;
    }
    @media(max-width:1100px){
      .photo-layout{
        grid-template-columns:60px minmax(0,1fr);
        grid-template-rows:minmax(260px,1fr) 220px;
        grid-template-areas:
          "tools canvas"
          "tools side";
      }
      .photo-tools{grid-area:tools;}
      .photo-canvas{grid-area:canvas;}
      .photo-side{grid-area:side;}
    }
    .photo-tools{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel-soft),var(--panel));
      border:1px solid rgba(255,255,255,0.14);
      padding:8px 4px;
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:center;
    }
    .tool-icon{
      width:34px;height:34px;
      border-radius:10px;
      background:rgba(7,9,20,0.96);
      border:1px solid rgba(255,255,255,0.16);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      cursor:pointer;
      color:var(--text-muted);
    }
    .tool-icon.active{
      background:linear-gradient(135deg,#ff5af1,#45f1ff);
      color:#050712;
      border-color:transparent;
      box-shadow:0 0 14px rgba(69,241,255,0.7);
    }
    .photo-canvas{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel),var(--panel-alt));
      border:1px solid rgba(255,255,255,0.16);
      padding:8px 10px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .photo-canvas-inner{
      flex:1;
      border-radius:14px;
      background-image:
        linear-gradient(45deg,rgba(255,255,255,0.06) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, transparent 75%, transparent);
      background-size:18px 18px;
      border:1px solid rgba(255,255,255,0.18);
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text-muted);
      font-size:12px;
      position:relative;
      overflow:hidden;
    }
    .photo-topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-muted);
    }
    .photo-bottom-bar{
      margin-top:4px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-muted);
    }
    .photo-side{
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,var(--panel-soft),var(--panel));
      border:1px solid rgba(255,255,255,0.16);
      padding:8px 9px;
      display:flex;
      flex-direction:column;
      gap:8px;
      font-size:12px;
    }
    .layers-list{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .layer-item{
      border-radius:9px;
      padding:4px 7px;
      background:rgba(5,7,18,0.96);
      border:1px solid rgba(255,255,255,0.1);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      cursor:pointer;
    }
    .layer-item span.name{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .photo-export-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:4px;
    }

    .btn{
      border-radius:var(--radius-pill);
      padding:6px 11px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(7,9,20,0.98);
      color:var(--text-main);
      font-size:12px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary{
      background:linear-gradient(120deg,#ff5af1,#45f1ff);
      color:#050712;
      border-color:transparent;
      font-weight:600;
      box-shadow:0 0 14px rgba(69,241,255,0.7);
    }

    .helper-text{
      font-size:11px;
      color:var(--text-muted);
    }

    /* Modals */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:70;
    }
    .modal{
      width:100%;
      max-width:540px;
      border-radius:18px;
      background:linear-gradient(135deg,#111529,#050712);
      border:1px solid rgba(255,255,255,0.24);
      padding:14px 16px;
      box-shadow:0 0 40px rgba(0,0,0,0.95);
      font-size:13px;
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:8px;
    }
    .modal-title{
      font-size:14px;
      font-weight:600;
    }
    .modal-close{
      cursor:pointer;
      font-size:16px;
      padding:2px 6px;
      border-radius:999px;
      background:rgba(255,255,255,0.06);
    }
    .modal-body{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .field-label{
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:0.13em;
      color:var(--text-muted);
    }
    .field-row{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    select, input[type="text"]{
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.18);
      background:rgba(3,5,14,0.98);
      color:var(--text-main);
      padding:6px 8px;
      font-size:12px;
      min-width:120px;
    }

    .mastering-grid{
      display:grid;
      grid-template-columns:1.1fr 1.1fr;
      gap:10px;
      margin-top:6px;
    }
    @media(max-width:700px){
      .mastering-grid{grid-template-columns:1fr;}
    }
    .master-box{
      border-radius:12px;
      background:linear-gradient(145deg,var(--panel),var(--panel-soft));
      border:1px solid rgba(255,255,255,0.16);
      padding:8px;
      font-size:12px;
    }
    .master-knobs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:4px;
    }
    .knob{
      width:60px;
      height:60px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-size:10px;
      background:radial-gradient(circle at 30% 0%,rgba(255,255,255,0.12),transparent 60%);
    }
    .knob span{font-size:9px;color:var(--text-muted);margin-top:3px;}
  </style>
</head>
<body data-theme="neon">
<header>
  <div class="nav-inner">
    <div class="brand">
      <div class="brand-icon">S</div>
      <div>
        <div class="brand-text-main">Sulandra AI Studio</div>
        <div class="brand-text-sub">Sound ¬∑ Cinema ¬∑ Photolab</div>
      </div>
    </div>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="image.html">Image Lab</a>
      <a href="video.html">Video Lab</a>
      <a href="music.html">Music Lab</a>
      <a href="film.html">Film Lab</a>
      <a href="explore.html">Explore</a>
      <a href="studio.html" class="active">Studio</a>
    </nav>
    <div class="nav-right">
      <div class="credits-pill"><span id="creditsLabel">3420</span> credits</div>
      <div class="profile-chip" onclick="alert('Profile & billing live in the main account panel ‚Äì this page focuses on the Studio workspace.')">
        <div class="profile-avatar">U</div>
        <div>
          <div style="font-size:11px;">Signed in</div>
          <div class="badge-plan" id="planLabel">Creator Ultimate</div>
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <!-- Menubar -->
  <section class="studio-menubar">
    <div class="menu-left">
      <div class="menu-item bold">File</div>
      <div class="menu-item">Edit</div>
      <div class="menu-item">View</div>
      <div class="menu-item">Insert</div>
      <div class="menu-item">Tools</div>
      <div class="menu-item">Window</div>
      <div class="menu-item">Help</div>
    </div>
    <div class="menu-right">
      <span class="menu-item" style="font-size:10px;">Studio Workspace</span>
      <button class="theme-chip active" id="themeNeon" onclick="setTheme('neon')">Neon</button>
      <button class="theme-chip" id="themeGray" onclick="setTheme('gray')">Studio Gray</button>
    </div>
  </section>

  <!-- Overview cards -->
  <section class="overview-grid">
    <article class="overview-card" onclick="switchMode('sound')">
      <div class="overview-tagline">Sound</div>
      <h2>Sound ¬∑ FL-style Mixer & Timeline üéöÔ∏è</h2>
      <p>
        Build full songs with tracks, stems, and MIDI. Record vocals and instruments,
        upload audio, import from Music Lab, or create new parts with AI ‚Äì all synced
        to tempo and key.
      </p>
      <div class="overview-chip-row">
        <span class="overview-chip">Record & upload</span>
        <span class="overview-chip">Per-track AI ‚ÄúCreate‚Äù</span>
        <span class="overview-chip">Mastering Suite</span>
      </div>
    </article>
    <article class="overview-card" onclick="switchMode('cinema')">
      <div class="overview-tagline">Cinema</div>
      <h2>Cinema ¬∑ Premiere-style Editing üé¨</h2>
      <p>
        Preview screen on top, big stacked A/V tracks below. Record VO, upload clips,
        import from Video & Film Labs, and use Create to add shots, transitions, or VFX
        directly into the timeline.
      </p>
      <div class="overview-chip-row">
        <span class="overview-chip">Video & audio tracks</span>
        <span class="overview-chip">Record VO / camera</span>
        <span class="overview-chip">AI shot & VFX generator</span>
      </div>
    </article>
    <article class="overview-card" onclick="switchMode('photo')">
      <div class="overview-tagline">Photolab</div>
      <h2>Photolab ¬∑ Photoshop-style Editing üñºÔ∏è</h2>
      <p>
        Layer-based image editing: shapes, cutouts, text, and AI restyle. Import from
        Image Lab, edit, then export to Image, Video, or Film Labs or download to device.
      </p>
      <div class="overview-chip-row">
        <span class="overview-chip">Layers & masks</span>
        <span class="overview-chip">Cutout & greenscreen</span>
        <span class="overview-chip">Export to any Lab</span>
      </div>
    </article>
  </section>

  <!-- Mode tabs -->
  <section class="mode-tabs">
    <div class="tab-buttons">
      <button class="mode-tab active" id="tabSound" onclick="switchMode('sound')">
        <span class="icon">üéöÔ∏è</span><span>SOUND ¬∑ Mixer & Timeline</span>
      </button>
      <button class="mode-tab" id="tabCinema" onclick="switchMode('cinema')">
        <span class="icon">üé¨</span><span>CINEMA ¬∑ Editor & VFX</span>
      </button>
      <button class="mode-tab" id="tabPhoto" onclick="switchMode('photo')">
        <span class="icon">üñºÔ∏è</span><span>PHOTOLAB ¬∑ Image Editor</span>
      </button>
    </div>
    <div class="mode-helper" id="modeHelperText">
      Audio from Music Lab opens in <strong>SOUND</strong> ¬∑ Video & Short Films open in
      <strong>CINEMA</strong> ¬∑ Generated images open in <strong>PHOTOLAB</strong>.
    </div>
  </section>

  <!-- Transport -->
  <section class="transport">
    <div class="transport-group">
      <button class="t-btn" id="btnStart">‚èÆ</button>
      <button class="t-btn primary" id="globalPlayBtn">‚ñ∂</button>
      <button class="t-btn" id="btnStop">‚èπ</button>
      <button class="t-btn" id="globalRecordBtn">‚óè</button>
      <button class="t-btn" id="metronomeBtn" title="Metronome">‚è∞</button>
    </div>
    <div class="transport-group">
      <span class="transport-label">Tempo</span>
      <input class="tiny-input" value="98" /> BPM
      <span class="transport-label">Time</span>
      <span class="badge-small" id="timeBadge">01:24 / 08:00</span>
      <span class="badge-small badge-route" id="routeBadge">Mode: SOUND ¬∑ Audio Project</span>
      <label class="toggle">
        <input type="checkbox" id="followPlayhead" checked />
        Follow playhead
      </label>
      <label class="toggle">
        <input type="checkbox" id="loopToggle" />
        Loop region (L)
      </label>
    </div>
    <div class="transport-group">
      <button class="t-btn" title="Zoom out">‚ûñ</button>
      <button class="t-btn" title="Zoom in">‚ûï</button>
      <span class="transport-label">Space = Play/Pause ¬∑ R = Record</span>
    </div>
  </section>

  <!-- SOUND MODE -->
  <section class="mode-container active" id="modeSound">
    <div class="sound-layout">
      <!-- Browser -->
      <aside class="panel">
        <div class="panel-header">
          <span class="panel-title-main">Browser ¬∑ Stems, Samples & Presets</span>
          <span style="font-size:10px;color:var(--text-muted);">Drag into tracks</span>
        </div>
        <div class="panel-body">
          <div class="browser-section-title">Project Stems</div>
          <div class="browser-list">
            <div class="browser-item">
              <span class="label">Drums ‚Äì Stem</span><span style="font-size:10px;color:var(--text-muted);">1:24</span>
            </div>
            <div class="browser-item">
              <span class="label">Bass ‚Äì Stem</span><span style="font-size:10px;color:var(--text-muted);">1:24</span>
            </div>
            <div class="browser-item">
              <span class="label">Guitar / Keys ‚Äì Stem</span><span style="font-size:10px;color:var(--text-muted);">1:24</span>
            </div>
            <div class="browser-item">
              <span class="label">Lead Vocal ‚Äì Stem</span><span style="font-size:10px;color:var(--text-muted);">1:24</span>
            </div>
          </div>

          <div class="browser-section-title" style="margin-top:10px;">Sample Pads (MIDI-ready)</div>
          <div class="sample-pads">
            <div class="sample-pad" onclick="alert('Would trigger a kick sample via MIDI.')">Kick</div>
            <div class="sample-pad" onclick="alert('Would trigger a snare sample via MIDI.')">Snare</div>
            <div class="sample-pad" onclick="alert('Would trigger a clap sample via MIDI.')">Clap</div>
            <div class="sample-pad" onclick="alert('Would trigger a log drum sample via MIDI.')">Log drum</div>
            <div class="sample-pad" onclick="alert('Would trigger a FX hit sample via MIDI.')">FX hit</div>
            <div class="sample-pad" onclick="alert('Would trigger a vocal chop sample via MIDI.')">Vocal chop</div>
          </div>

          <div class="browser-section-title" style="margin-top:10px;">Instrument Presets</div>
          <div class="browser-list">
            <div class="browser-item">
              <span class="label">Afro Piano ‚Äì Bright Keys</span><span style="font-size:10px;">MIDI</span>
            </div>
            <div class="browser-item">
              <span class="label">Amapiano Log Drum ‚Äì Heavy</span><span style="font-size:10px;">MIDI</span>
            </div>
            <div class="browser-item">
              <span class="label">Gospel Pad ‚Äì Warm</span><span style="font-size:10px;">MIDI</span>
            </div>
          </div>

          <div class="browser-section-title" style="margin-top:10px;">Utilities</div>
          <div class="browser-list">
            <div class="browser-item" onclick="alert('Would analyze the full mix and split into named stems on separate tracks.')">
              <span class="label">Split full mix into stems</span><span style="font-size:10px;">‚á£</span>
            </div>
            <div class="browser-item" onclick="alert('Would remove vocals or instruments to create karaoke/accapella versions.')">
              <span class="label">Remove vocals / keep instrumental</span><span style="font-size:10px;">‚á£</span>
            </div>
            <div class="browser-item" onclick="alert('Would convert audio to MIDI for note editing.')">
              <span class="label">Convert stem to MIDI</span><span style="font-size:10px;">‚á£</span>
            </div>
          </div>

          <div class="browser-section-title" style="margin-top:10px;">Recordings</div>
          <div class="browser-list">
            <div class="browser-item">
              <span class="label">Mic Take 01 ‚Äì Verse idea</span><span style="font-size:10px;color:var(--text-muted);">0:32</span>
            </div>
            <div class="browser-item">
              <span class="label">Guitar Loop ‚Äì F# groove</span><span style="font-size:10px;color:var(--text-muted);">0:08</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Timeline -->
      <section class="timeline-sound">
        <div class="bar-ruler">
          <div class="bar-ruler-left">
            <span>Tracks</span>
            <span style="font-size:10px;">Click & drag region to loop ¬∑ Scroll horizontally</span>
          </div>
          <div class="bar-ruler-right">
            <span>Bar 1</span><span>5</span><span>9</span><span>13</span><span>17</span><span>21</span><span>25</span><span>29</span>
          </div>
        </div>

        <div class="sound-top-controls">
          <div class="loop-controls">
            <span>Loop region:</span>
            <span>Start</span><input class="tiny-input" value="1" style="width:40px;" />
            <span>End</span><input class="tiny-input" value="9" style="width:40px;" />
          </div>
          <div class="helper-text">
            When loop is enabled, playback will cycle between the selected bars.
          </div>
        </div>

        <div class="track-list">
          <!-- Full Mix -->
          <div class="track-row" id="track-fullmix">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">Full Mix</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-fullmix',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="clip">Song Mix ‚Äì ‚ÄúWe Need A Miracle v3‚Äù</div>
              <div class="cell-empty" onclick="openGenerateModal('sound','Full Mix')">
                + Extend / Remix with Create
              </div>
            </div>
          </div>

          <!-- Drums -->
          <div class="track-row" id="track-drums">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">Drums</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="vol-row">
                Vol <input type="range" min="0" max="100" value="70" />
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-drums',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="clip stem">Drum stem ‚Äì 0:00‚Äì1:24</div>
              <div class="cell-empty" onclick="openGenerateModal('sound','Drums')">
                + New kick / fill pattern
              </div>
            </div>
          </div>

          <!-- Bass -->
          <div class="track-row" id="track-bass">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">Bass</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="vol-row">
                Vol <input type="range" min="0" max="100" value="75" />
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-bass',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="clip stem">Bass stem ‚Äì 0:00‚Äì1:24</div>
              <div class="clip midi">MIDI bass pattern ‚Äì bar 9‚Äì17</div>
              <div class="cell-empty" onclick="openGenerateModal('sound','Bass')">
                + Extend pattern
              </div>
            </div>
          </div>

          <!-- Guitar / Keys -->
          <div class="track-row" id="track-guitarkeys">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">Guitar / Keys</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="vol-row">
                Vol <input type="range" min="0" max="100" value="68" />
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-guitarkeys',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="clip stem">Guitar stem ‚Äì 0:00‚Äì1:24</div>
              <div class="cell-empty" onclick="openGenerateModal('sound','Guitar / Keys')">
                + Chords / hook
              </div>
            </div>
          </div>

          <!-- Lead Vocal -->
          <div class="track-row" id="track-leadvocal">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">Lead Vocal</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="vol-row">
                Vol <input type="range" min="0" max="100" value="80" />
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-leadvocal',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="clip stem">Lead vocal ‚Äì Verse & Chorus</div>
              <div class="cell-empty" onclick="openGenerateModal('sound','Lead Vocal')">
                + Harmonies / ad-libs
              </div>
            </div>
          </div>

          <!-- New Track -->
          <div class="track-row" id="track-new">
            <div class="track-header">
              <div class="track-name-row">
                <span class="track-name-main">New Track</span>
                <div class="track-controls">
                  <button class="pill-small" onclick="toggleSolo(this)">S</button>
                  <button class="pill-small" onclick="toggleMute(this)">M</button>
                  <button class="pill-small red" onclick="toggleArm(this)">‚óè</button>
                </div>
              </div>
              <div class="track-controls">
                <select class="track-action-select" onchange="handleTrackAction('sound','track-new',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="track-lane">
              <div class="cell-empty" onclick="openGenerateModal('sound','New Track')">
                + Click to generate instrument / FX / vocals here
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mixer -->
      <aside class="panel">
        <div class="panel-header">
          <span class="panel-title-main">Mixer</span>
          <span style="font-size:10px;color:var(--text-muted);">Master ¬∑ Buses ¬∑ Channels</span>
        </div>
        <div class="panel-body">
          <div class="mixer-channels">
            <div class="mixer-strip">
              <div class="mixer-title">Master</div>
              <div class="mixer-meter"><div class="mixer-meter-fill"></div></div>
              <div class="mixer-fader"><input type="range" min="0" max="100" value="80"/></div>
              <div class="mixer-btn-row">
                <button class="mixer-btn" onclick="openMasterModal()">Mastering Suite</button>
              </div>
            </div>
            <div class="mixer-strip">
              <div class="mixer-title">Drums</div>
              <div class="mixer-meter"><div class="mixer-meter-fill" style="height:70%;"></div></div>
              <div class="mixer-fader"><input type="range" min="0" max="100" value="72"/></div>
              <div class="mixer-btn-row">
                <button class="mixer-btn">Bus D</button>
                <button class="mixer-btn">FX</button>
              </div>
            </div>
            <div class="mixer-strip">
              <div class="mixer-title">Bass</div>
              <div class="mixer-meter"><div class="mixer-meter-fill" style="height:65%;"></div></div>
              <div class="mixer-fader"><input type="range" min="0" max="100" value="68"/></div>
              <div class="mixer-btn-row">
                <button class="mixer-btn">Bus B</button>
                <button class="mixer-btn">EQ</button>
              </div>
            </div>
            <div class="mixer-strip">
              <div class="mixer-title">Guitar</div>
              <div class="mixer-meter"><div class="mixer-meter-fill" style="height:55%;"></div></div>
              <div class="mixer-fader"><input type="range" min="0" max="100" value="60"/></div>
              <div class="mixer-btn-row">
                <button class="mixer-btn">Bus M</button>
                <button class="mixer-btn">FX</button>
              </div>
            </div>
            <div class="mixer-strip">
              <div class="mixer-title">Lead Vox</div>
              <div class="mixer-meter"><div class="mixer-meter-fill" style="height:75%;"></div></div>
              <div class="mixer-fader"><input type="range" min="0" max="100" value="82"/></div>
              <div class="mixer-btn-row">
                <button class="mixer-btn">Bus V</button>
                <button class="mixer-btn">FX</button>
              </div>
            </div>
          </div>
          <div class="helper-text" style="margin-top:6px;">
            ‚ÄúMastering Suite‚Äù will eventually act like Ozone: tonal balance, width, loudness,
            and target presets by genre once wired to your backend.
          </div>
        </div>
      </aside>
    </div>
  </section>

  <!-- CINEMA MODE -->
  <section class="mode-container" id="modeCinema">
    <div class="cinema-layout">
      <div class="cinema-top">
        <!-- Preview -->
        <section class="preview-panel">
          <div class="preview-header">
            <span>Preview ¬∑ 16:9 ¬∑ up to 4K</span>
            <span>Active sequence: Short Film ‚Äì Scene 01</span>
          </div>
          <div class="preview-screen">
            Preview Screen ¬∑ Cinema
          </div>
          <div class="preview-controls-bottom">
            <div class="preview-controls-left">
              <button class="t-btn" id="cinemaRew">‚è™</button>
              <button class="t-btn primary" id="cinemaPlayBtn">‚ñ∂</button>
              <button class="t-btn" id="cinemaStop">‚èπ</button>
              <button class="t-btn" id="cinemaFwd">‚è©</button>
              <label class="toggle" style="margin-left:6px;">
                <input type="checkbox" id="cinemaLoop" />
                Loop playback
              </label>
            </div>
            <div style="display:flex;align-items:center;gap:6px;">
              <span>Zoom</span>
              <input type="range" min="0" max="100" value="60"/>
            </div>
          </div>
        </section>

        <!-- Inspector -->
        <aside class="cinema-inspector">
          <div>
            <div class="cinema-label-title">Clip & Sequence Info</div>
            <div class="helper-text">
              Select a clip or region in the timeline to see settings. Use the track
              actions menu to Record, Upload, Import from Labs, or Create new shots,
              transitions, and visual passes.
            </div>
          </div>
          <div>
            <div class="cinema-label-title">Current selection notes</div>
            <textarea placeholder="Describe this part of the sequence ‚Äì e.g. 'Dance break intro, 8 bars, needs more crowd shots and light beams.'"></textarea>
          </div>
          <div>
            <div class="cinema-label-title">Look presets</div>
            <div class="chip-row">
              <button class="chip">Music video</button>
              <button class="chip">Cinematic drama</button>
              <button class="chip">Sitcom light</button>
              <button class="chip">Neon club</button>
              <button class="chip">Documentary</button>
            </div>
          </div>
          <div>
            <div class="cinema-label-title">Routing</div>
            <div class="chip-row">
              <button class="chip" onclick="alert('Would send rendered cut back to Film Lab.')">
                Send to Film Lab
              </button>
              <button class="chip" onclick="alert('Would export this sequence to Video Lab as a template.')">
                Send to Video Lab
              </button>
              <button class="chip" onclick="alert('Would publish this sequence to the Media feed.')">
                Publish to Media
              </button>
            </div>
          </div>
        </aside>
      </div>

      <!-- Timeline -->
      <section class="cinema-timeline">
        <div class="cinema-ruler">
          <div class="cinema-ruler-left">
            <span>Timeline</span>
            <span style="font-size:10px;">Drag to select loop ¬∑ Follows playhead if enabled</span>
          </div>
          <div class="cinema-ruler-right">
            <span>0s</span><span>10s</span><span>20s</span><span>30s</span><span>40s</span><span>50s</span><span>60s</span>
          </div>
        </div>
        <div style="flex:1;overflow:auto;">
          <!-- V2 -->
          <div class="cinema-track-row" id="cinema-v2">
            <div class="cinema-track-label">
              <span class="cinema-track-name">V2 ¬∑ Overlays / Titles</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-v2',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload video‚Ä¶</option>
                  <option value="import">Import from Labs‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="clip midi">Title Card ¬∑ 0‚Äì4s</div>
              <div class="cell-empty" onclick="openGenerateModal('cinema','V2 ¬∑ Overlays / Titles')">
                + Lower thirds / text
              </div>
            </div>
          </div>
          <!-- V1 -->
          <div class="cinema-track-row" id="cinema-v1">
            <div class="cinema-track-label">
              <span class="cinema-track-name">V1 ¬∑ Main Video</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-v1',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload video‚Ä¶</option>
                  <option value="import">Import from Labs‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="clip">Shot 1 ‚Äì 0‚Äì20s</div>
              <div class="clip">Shot 2 ‚Äì 20‚Äì40s</div>
              <div class="cell-empty" onclick="openGenerateModal('cinema','V1 ¬∑ Main Video')">
                + Extend scene / new shot
              </div>
            </div>
          </div>
          <!-- FX -->
          <div class="cinema-track-row" id="cinema-fx">
            <div class="cinema-track-label">
              <span class="cinema-track-name">FX ¬∑ Lights / Atmosphere</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-fx',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload video‚Ä¶</option>
                  <option value="import">Import from Labs‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="clip stem">Atmosphere ‚Äì fog & glow</div>
              <div class="cell-empty" onclick="openGenerateModal('cinema','FX ¬∑ Lights / Atmosphere')">
                + Hits on beat / motion
              </div>
            </div>
          </div>
          <!-- Audio tracks -->
          <div class="cinema-track-row" id="cinema-a1">
            <div class="cinema-track-label">
              <span class="cinema-track-name">A1 ¬∑ Music</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-a1',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Music Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="clip stem">Song ‚Äì ‚ÄúWe Need A Miracle‚Äù</div>
            </div>
          </div>
          <div class="cinema-track-row" id="cinema-a2">
            <div class="cinema-track-label">
              <span class="cinema-track-name">A2 ¬∑ Dialog / VO</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-a2',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Film Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="clip stem">Voiceover ‚Äì main narration</div>
              <div class="cell-empty" onclick="openGenerateModal('cinema','A2 ¬∑ Dialog / VO')">
                + New VO / lip-sync
              </div>
            </div>
          </div>
          <div class="cinema-track-row" id="cinema-a3">
            <div class="cinema-track-label">
              <span class="cinema-track-name">A3 ¬∑ SFX / Ambience</span>
              <div class="cinema-track-actions">
                <select class="track-action-select" onchange="handleTrackAction('cinema','cinema-a3',this.value)">
                  <option value="">Track actions‚Ä¶</option>
                  <option value="record">Record‚Ä¶</option>
                  <option value="upload">Upload audio‚Ä¶</option>
                  <option value="import">Import from Film Lab‚Ä¶</option>
                  <option value="create">Create with AI‚Ä¶</option>
                </select>
              </div>
            </div>
            <div class="cinema-lane">
              <div class="cell-empty" onclick="openGenerateModal('cinema','A3 ¬∑ SFX / Ambience')">
                + Auto SFX & ambience bed
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </section>

  <!-- PHOTOLAB MODE -->
  <section class="mode-container" id="modePhoto">
    <div class="photo-layout">
      <!-- Tools -->
      <aside class="photo-tools">
        <div class="tool-icon active" title="Move">‚¨ö</div>
        <div class="tool-icon" title="Crop">‚úÇÔ∏è</div>
        <div class="tool-icon" title="Brush / Retouch">üñåÔ∏è</div>
        <div class="tool-icon" title="Eraser">üßΩ</div>
        <div class="tool-icon" title="Magic Cut">‚ú®</div>
        <div class="tool-icon" title="Text">T</div>
        <div class="tool-icon" title="Shapes">‚óØ</div>
        <div class="tool-icon" title="Mask / Selection">üï≥Ô∏è</div>
      </aside>

      <!-- Canvas -->
      <section class="photo-canvas">
        <div class="photo-topbar">
          <span>Canvas ¬∑ 3000 √ó 3000 px ¬∑ RGB</span>
          <div style="display:flex;gap:6px;align-items:center;">
            <button class="btn" type="button" onclick="alert('Would open a local file picker to upload an image into Photolab.')">
              Upload image
            </button>
            <button class="btn" type="button" onclick="alert('Would pull generated images from Image Lab into this canvas.')">
              Import from Image Lab
            </button>
          </div>
        </div>
        <div class="photo-canvas-inner">
          Photolab Canvas ¬∑ Edit, mask, and paint here
        </div>
        <div class="photo-bottom-bar">
          <div>
            <span>Zoom</span>
            <input type="range" min="0" max="100" value="65" />
          </div>
          <div style="display:flex;gap:6px;align-items:center;">
            <button class="btn" type="button" onclick="openGenerateModal('photo','Photolab')">
              AI Edit / Restyle
            </button>
            <span class="helper-text">Send final image to Image / Video / Film Labs as needed.</span>
          </div>
        </div>
      </section>

      <!-- Layers & export -->
      <aside class="photo-side">
        <div>
          <div class="cinema-label-title">Layers</div>
          <div class="layers-list">
            <div class="layer-item">
              <span class="name">Layer 3 ‚Äì Text / Logo</span><span style="font-size:10px;">üëÅÔ∏è</span>
            </div>
            <div class="layer-item">
              <span class="name">Layer 2 ‚Äì Subject (cut out)</span><span style="font-size:10px;">üëÅÔ∏è</span>
            </div>
            <div class="layer-item">
              <span class="name">Layer 1 ‚Äì Background</span><span style="font-size:10px;">üëÅÔ∏è</span>
            </div>
          </div>
        </div>
        <div>
          <div class="cinema-label-title">Quick actions</div>
          <div class="chip-row">
            <button class="chip" onclick="alert('Would auto-remove the background and create a subject layer.')">
              Auto remove background
            </button>
            <button class="chip" onclick="alert('Would open a green-screen keyed editing flow.')">
              Green screen tools
            </button>
            <button class="chip" onclick="alert('Would crop the image to chosen aspect ratios (1:1, 9:16, 16:9, etc.)')">
              Smart crop
            </button>
          </div>
        </div>
        <div>
          <div class="cinema-label-title">Export / Send to Labs</div>
          <div class="photo-export-row">
            <button class="btn" type="button" onclick="alert('Would export PNG to user device.')">
              Download PNG
            </button>
            <button class="btn" type="button" onclick="alert('Would export JPEG to user device.')">
              Download JPG
            </button>
          </div>
          <div class="photo-export-row">
            <button class="btn" type="button" onclick="alert('Would send this edited image to Image Lab for new generations.')">
              Send to Image Lab
            </button>
            <button class="btn" type="button" onclick="alert('Would send this image into Film Lab as a scene frame.')">
              Send to Film Lab
            </button>
            <button class="btn" type="button" onclick="alert('Would send this image to Video Lab as a storyboard frame.')">
              Send to Video Lab
            </button>
          </div>
        </div>
        <div>
          <div class="cinema-label-title">History / Versions</div>
          <div class="helper-text">
            Photolab can store non-destructive history once wired to backend so you can roll
            back edits, compare versions, and send any version into other Labs.
          </div>
        </div>
      </aside>
    </div>
  </section>
</main>

<!-- Hidden upload input -->
<input type="file" id="audioUploadInput" accept="audio/*,video/*" style="display:none" />

<!-- GENERATE MODAL -->
<div class="modal-backdrop" id="generateBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="generateTitle">Generate content</div>
        <div class="helper-text" id="generateSubtitle"></div>
      </div>
      <div class="modal-close" onclick="closeGenerateModal()">√ó</div>
    </div>
    <div class="modal-body">
      <div>
        <div class="field-label">Content type</div>
        <div class="field-row">
          <select id="genType">
            <option value="instrument">Instrument / Beat</option>
            <option value="fx">FX / Atmosphere</option>
            <option value="vocals">Vocals (lead / backing)</option>
            <option value="shot">Shot / video segment</option>
            <option value="transition">Transition</option>
            <option value="grade">Color / look pass</option>
            <option value="photo">Photolab restyle</option>
          </select>
          <select id="genGenre">
            <option value="auto">Auto detect</option>
            <option value="afrobeat">Afrobeat</option>
            <option value="amapiano">Amapiano</option>
            <option value="gospel">Gospel / Worship</option>
            <option value="pop">Pop</option>
            <option value="rnb">R&amp;B</option>
            <option value="hiphop">Hip-hop</option>
            <option value="cinema">Cinematic film</option>
            <option value="sitcom">Sitcom / comedy</option>
            <option value="custom">Custom only (prompt-driven)</option>
          </select>
        </div>
      </div>
      <div>
        <div class="field-label">Prompt / Description</div>
        <textarea id="genPrompt" placeholder="Example for drums: 'Amapiano kick pattern with heavy log drums, syncopated but not too busy, locked to current groove.'&#10;&#10;Example for video: 'Add handheld close-ups of dancers, slow motion hits on the chorus, keep lighting neon purple and blue.'"></textarea>
      </div>
      <div>
        <div class="field-label">Lyrics (for vocals)</div>
        <textarea id="genLyrics" placeholder="Paste or write lyrics if you are generating vocals. Leave empty for instruments, FX, or visuals."></textarea>
      </div>
      <div>
        <div class="field-label">Context & placement</div>
        <div class="field-row">
          <select id="genContext">
            <option value="full">Use full arrangement (all unmuted tracks)</option>
            <option value="track">Use only this track/stem</option>
          </select>
          <select id="genPlacement">
            <option value="selection">Place in current selection (if any)</option>
            <option value="fromStart">Start at beginning of song / sequence</option>
          </select>
        </div>
        <div class="helper-text">
          Studio will read all active stems (muted tracks are ignored), match tempo, key,
          and progression, and place the generated result into this track.
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-top:4px;">
        <div class="helper-text">
          For example, mute your current kick track, create a new track, choose Drum/Instrument,
          set genre to Amapiano, describe the new kick you want, and Studio will generate it in sync.
        </div>
        <button class="btn-primary" type="button" onclick="alert('This would send the request to your backend AI engine.')">
          Generate
        </button>
      </div>
    </div>
  </div>
</div>

<!-- RECORD MODAL -->
<div class="modal-backdrop" id="recordBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="recordTitle">Record to track</div>
        <div class="helper-text" id="recordSubtitle">Choose what you want to record for this track.</div>
      </div>
      <div class="modal-close" onclick="closeRecordModal()">√ó</div>
    </div>
    <div class="modal-body">
      <div>
        <div class="field-label">Record type</div>
        <div class="field-row">
          <select id="recordMainType" onchange="updateRecordSubType()">
            <option value="vocals">Vocals</option>
            <option value="instrument">Instrumental</option>
          </select>
          <select id="recordSubType">
            <!-- filled by JS -->
          </select>
        </div>
      </div>
      <div>
        <div class="field-label">Input & monitoring</div>
        <div class="helper-text">
          Once connected, Studio will use your selected audio device, enable monitoring,
          and sync the recording with the project tempo and metronome.
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;margin-top:4px;">
        <div class="helper-text">
          After you arm the track, click the record button (‚óè) or press R to start recording.
          The track name will update based on the selected role (e.g. Lead Vocals).
        </div>
        <button class="btn-primary" type="button" onclick="armTrackForRecording()">
          Arm track with this role
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MASTERING MODAL -->
<div class="modal-backdrop" id="masterBackdrop">
  <div class="modal">
    <div class="modal-header">
      <div>
        <div class="modal-title">Mastering Suite ¬∑ Mix Bus</div>
        <div class="helper-text">Ozone-style chain: EQ ¬∑ Dynamics ¬∑ Imager ¬∑ Maximizer</div>
      </div>
      <div class="modal-close" onclick="closeMasterModal()">√ó</div>
    </div>
    <div class="modal-body">
      <div>
        <div class="field-label">Preset</div>
        <div class="field-row">
          <select>
            <option>Detect automatically from song</option>
            <option>Afrobeat ‚Äì Streaming</option>
            <option>Amapiano ‚Äì Club / Loud</option>
            <option>Gospel ‚Äì Dynamic</option>
            <option>Pop ‚Äì Radio</option>
            <option>Film score ‚Äì Wide & soft</option>
          </select>
          <button class="btn" type="button" onclick="alert('Would analyse mix and choose a starting preset.')">
            Master Assistant
          </button>
        </div>
      </div>
      <div class="mastering-grid">
        <div class="master-box">
          <div class="field-label">Tone & EQ</div>
          <div class="master-knobs">
            <div class="knob"><div>+1.5 dB</div><span>Low</span></div>
            <div class="knob"><div>0.0 dB</div><span>Mid</span></div>
            <div class="knob"><div>+2.0 dB</div><span>High</span></div>
          </div>
        </div>
        <div class="master-box">
          <div class="field-label">Dynamics</div>
          <div class="master-knobs">
            <div class="knob"><div>-3 dB</div><span>Comp</span></div>
            <div class="knob"><div>-6 dB</div><span>Limiter</span></div>
            <div class="knob"><div>-10 LUFS</div><span>Loudness</span></div>
          </div>
        </div>
        <div class="master-box">
          <div class="field-label">Stereo & Space</div>
          <div class="master-knobs">
            <div class="knob"><div>120%</div><span>Width</span></div>
            <div class="knob"><div>30%</div><span>Reverb</span></div>
            <div class="knob"><div>0%</div><span>Mono bass</span></div>
          </div>
        </div>
        <div class="master-box">
          <div class="field-label">Output</div>
          <div class="master-knobs">
            <div class="knob"><div>-0.8 dB</div><span>Ceiling</span></div>
            <div class="knob"><div>Safe</div><span>True peak</span></div>
            <div class="knob"><div>On</div><span>Clipping guard</span></div>
          </div>
        </div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;gap:8px;flex-wrap:wrap;">
        <div class="helper-text">
          Once connected, you‚Äôll preview before/after and export WAV or MP3 at target loudness per platform.
        </div>
        <button class="btn-primary" type="button" onclick="alert('This would render a mastered version of the current mix.')">
          Apply mastering
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const user = { plan: 'creatorUltimate', credits: 3420 };
  document.getElementById('creditsLabel').textContent = user.credits;
  document.getElementById('planLabel').textContent =
    user.plan === 'basic' ? 'Basic' :
    user.plan === 'pro' ? 'Pro' :
    user.plan === 'creator' ? 'Creator' : 'Creator Ultimate';

  function setTheme(theme) {
    document.body.setAttribute('data-theme', theme);
    document.getElementById('themeNeon').classList.toggle('active', theme === 'neon');
    document.getElementById('themeGray').classList.toggle('active', theme === 'gray');
  }

  function switchMode(mode) {
    const sound = document.getElementById('modeSound');
    const cinema = document.getElementById('modeCinema');
    const photo = document.getElementById('modePhoto');
    sound.classList.remove('active'); cinema.classList.remove('active'); photo.classList.remove('active');
    if (mode === 'sound') sound.classList.add('active');
    if (mode === 'cinema') cinema.classList.add('active');
    if (mode === 'photo') photo.classList.add('active');

    document.getElementById('tabSound').classList.toggle('active', mode === 'sound');
    document.getElementById('tabCinema').classList.toggle('active', mode === 'cinema');
    document.getElementById('tabPhoto').classList.toggle('active', mode === 'photo');

    const routeBadge = document.getElementById('routeBadge');
    const helper = document.getElementById('modeHelperText');
    if (mode === 'sound') {
      routeBadge.textContent = 'Mode: SOUND ¬∑ Audio Project';
      helper.innerHTML = 'Audio from Music Lab opens in <strong>SOUND</strong>. Use stems, MIDI, mixer, and mastering to finish records.';
    } else if (mode === 'cinema') {
      routeBadge.textContent = 'Mode: CINEMA ¬∑ Video Project';
      helper.innerHTML = 'Short films and clips open in <strong>CINEMA</strong>. Edit like Premiere, then send to Film Lab or back to SOUND.';
    } else {
      routeBadge.textContent = 'Mode: PHOTOLAB ¬∑ Image Project';
      helper.innerHTML = 'Images from Image Lab open in <strong>PHOTOLAB</strong>. Edit like Photoshop and send directly to other Labs.';
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  /* PLAYBACK, METRONOME & SHORTCUTS */
  let isPlaying = false;
  let isRecording = false;
  let metronomeOn = false;

  const globalPlayBtn = document.getElementById('globalPlayBtn');
  const globalRecordBtn = document.getElementById('globalRecordBtn');
  const cinemaPlayBtn = document.getElementById('cinemaPlayBtn');
  const loopToggle = document.getElementById('loopToggle');
  const metronomeBtn = document.getElementById('metronomeBtn');

  function updatePlayButtons() {
    if (isPlaying) {
      globalPlayBtn.classList.add('playing');
      cinemaPlayBtn.classList.add('playing');
    } else {
      globalPlayBtn.classList.remove('playing');
      cinemaPlayBtn.classList.remove('playing');
    }
  }

  function togglePlay() {
    isPlaying = !isPlaying;
    updatePlayButtons();
  }

  function stopPlay() {
    isPlaying = false;
    updatePlayButtons();
  }

  function toggleRecord() {
    isRecording = !isRecording;
    if (isRecording) {
      globalRecordBtn.classList.add('recording');
    } else {
      globalRecordBtn.classList.remove('recording');
    }
  }

  function toggleMetronome() {
    metronomeOn = !metronomeOn;
    metronomeBtn.classList.toggle('metronome-on', metronomeOn);
  }

  globalPlayBtn.addEventListener('click', togglePlay);
  document.getElementById('btnStop').addEventListener('click', stopPlay);
  globalRecordBtn.addEventListener('click', toggleRecord);
  metronomeBtn.addEventListener('click', toggleMetronome);

  cinemaPlayBtn.addEventListener('click', togglePlay);
  document.getElementById('cinemaStop').addEventListener('click', () => { stopPlay(); });

  document.addEventListener('keydown', (e) => {
    const tag = (e.target.tagName || '').toLowerCase();
    if (tag === 'input' || tag === 'textarea' || e.target.isContentEditable) return;

    if (e.code === 'Space') {
      e.preventDefault();
      togglePlay();
    } else if (e.key === 'r' || e.key === 'R') {
      toggleRecord();
    } else if (e.key === 'l' || e.key === 'L') {
      loopToggle.checked = !loopToggle.checked;
    }
  });

  /* SOLO / MUTE / ARM UI */
  function toggleMute(btn) {
    btn.classList.toggle('mute-on');
  }
  function toggleSolo(btn) {
    btn.classList.toggle('solo-on');
  }
  function toggleArm(btn) {
    btn.classList.toggle('recording');
  }

  /* GENERATE MODAL */
  let currentGenerate = { mode: 'sound', track: '' };

  function openGenerateModal(mode, trackName) {
    currentGenerate.mode = mode;
    currentGenerate.track = trackName || '';
    const backdrop = document.getElementById('generateBackdrop');
    const title = document.getElementById('generateTitle');
    const subtitle = document.getElementById('generateSubtitle');

    if (mode === 'sound') {
      title.textContent = 'Create audio for ‚Äú' + (trackName || 'Track') + '‚Äù';
      subtitle.textContent = 'Choose instrument, FX, or vocals ‚Äì Studio will match tempo, key, and progression based on active stems.';
    } else if (mode === 'cinema') {
      title.textContent = 'Create video for ‚Äú' + (trackName || 'Track') + '‚Äù';
      subtitle.textContent = 'Create shots, transitions, lip-sync, or visual passes that match your current sequence.';
    } else {
      title.textContent = 'Photolab restyle';
      subtitle.textContent = 'Describe how to restyle this image. You can send the result to any Lab after editing.';
    }

    document.getElementById('genType').value = mode === 'cinema' ? 'shot' : (mode === 'photo' ? 'photo' : 'instrument');
    document.getElementById('genGenre').value = 'auto';
    document.getElementById('genPrompt').value = '';
    document.getElementById('genLyrics').value = '';
    document.getElementById('genContext').value = 'full';
    document.getElementById('genPlacement').value = 'selection';

    backdrop.style.display = 'flex';
  }

  function closeGenerateModal() {
    document.getElementById('generateBackdrop').style.display = 'none';
  }

  /* MASTER MODAL */
  function openMasterModal() {
    document.getElementById('masterBackdrop').style.display = 'flex';
  }
  function closeMasterModal() {
    document.getElementById('masterBackdrop').style.display = 'none';
  }

  /* RECORD MODAL LOGIC */
  let recordTargetTrackId = null;

  function openRecordModal(trackId, mode) {
    recordTargetTrackId = trackId;
    const title = document.getElementById('recordTitle');
    const subtitle = document.getElementById('recordSubtitle');
    title.textContent = 'Record to ' + prettyTrackName(trackId, mode);
    subtitle.textContent = mode === 'cinema'
      ? 'Choose whether to record voiceover or other audio for this video track.'
      : 'Choose what you want to record (vocals or instruments) for this audio track.';
    document.getElementById('recordMainType').value = 'vocals';
    updateRecordSubType();
    document.getElementById('recordBackdrop').style.display = 'flex';
  }

  function closeRecordModal() {
    document.getElementById('recordBackdrop').style.display = 'none';
    recordTargetTrackId = null;
  }

  function updateRecordSubType() {
    const mainType = document.getElementById('recordMainType').value;
    const sub = document.getElementById('recordSubType');
    sub.innerHTML = '';
    if (mainType === 'vocals') {
      ['Lead vocals','Backing vocals','Choir','Ad-libs'].forEach(label => {
        const opt = document.createElement('option');
        opt.value = label;
        opt.textContent = label;
        sub.appendChild(opt);
      });
    } else {
      ['Piano','Guitar','Bass','Drums','Pad','Synth','Custom instrument'].forEach(label => {
        const opt = document.createElement('option');
        opt.value = label;
        opt.textContent = label;
        sub.appendChild(opt);
      });
    }
  }

  function prettyTrackName(trackId, mode) {
    const el = document.getElementById(trackId);
    if (!el) return mode === 'cinema' ? 'video track' : 'audio track';
    const nameSpan = el.querySelector('.track-name-main, .cinema-track-name');
    return nameSpan ? nameSpan.textContent : (mode === 'cinema' ? 'video track' : 'audio track');
  }

  function armTrackForRecording() {
    if (!recordTargetTrackId) { closeRecordModal(); return; }
    const mainType = document.getElementById('recordMainType').value;
    const subType = document.getElementById('recordSubType').value;
    const trackEl = document.getElementById(recordTargetTrackId);
    if (trackEl) {
      const nameSpan = trackEl.querySelector('.track-name-main, .cinema-track-name');
      if (nameSpan && subType) {
        nameSpan.textContent = subType;
      }
      const armBtn = trackEl.querySelector('.pill-small.red');
      if (armBtn) armBtn.classList.add('recording');
    }
    alert('Track armed for recording as: ' + subType + '. Once wired to backend, clicking ‚óè or pressing R will start recording with metronome = ' + (metronomeOn ? 'ON' : 'OFF') + '.');
    closeRecordModal();
  }

  /* TRACK ACTION HANDLER */
  function handleTrackAction(mode, trackId, action) {
    if (!action) return;
    const select = event.target;
    if (action === 'record') {
      openRecordModal(trackId, mode);
    } else if (action === 'upload') {
      const input = document.getElementById('audioUploadInput');
      input.onchange = () => {
        if (input.files && input.files[0]) {
          alert('File "' + input.files[0].name + '" selected. Once wired, it would be placed on ' +
            prettyTrackName(trackId, mode) + ' and snapped to project tempo.');
          input.value = '';
        }
      };
      input.click();
    } else if (action === 'import') {
      alert('Import from Labs: this would open a picker to choose audio/video from Music / Video / Film Labs and drop it onto ' +
        prettyTrackName(trackId, mode) + '.');
    } else if (action === 'create') {
      openGenerateModal(mode === 'cinema' ? 'cinema' : 'sound', prettyTrackName(trackId, mode));
    }
    // reset dropdown
    if (select) select.value = '';
  }
</script>
</body>
</html>
