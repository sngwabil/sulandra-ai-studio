<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sulandra AI Studio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* -------------------------------------------------------------------------- */
/* CORE LAYOUT & VARIABLES */
/* -------------------------------------------------------------------------- */
:root {
    --bg-app: #050505;
    --bg-panel: #0a0a0a;
    --bg-card: #121212;
    --bg-element: #1a1a1a;
    --border: #27272a;
    --accent: #8b5cf6;
    --text-main: #ffffff;
    --text-muted: #a1a1aa;
    --radius: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-app);
    color: var(--text-main);
    height: 100vh; /* Full viewport height */
    display: flex;
    flex-direction: column;
    overflow: hidden; /* Stop whole page from scrolling */
}

/* -------------------------------------------------------------------------- */
/* HEADER */
/* -------------------------------------------------------------------------- */
header {
    height: 60px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-panel);
    display: flex;
    align-items: center;
    padding: 0 20px;
    justify-content: space-between;
    flex-shrink: 0; /* Never shrink */
    z-index: 50;
}

.brand-logo { 
    width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); 
    border-radius: 8px; display: flex; align-items: center; justify-content: center; 
    font-weight: 800; font-size: 18px; 
}

/* -------------------------------------------------------------------------- */
/* MAIN WORKSPACE LAYOUT */
/* -------------------------------------------------------------------------- */
.workspace {
    display: flex;
    flex: 1; /* Fill remaining height */
    height: calc(100vh - 60px); /* Exact height minus header */
    overflow: hidden;
}

/* 1. LEFT NAV RAIL (Icons) */
.nav-rail {
    width: 64px;
    background: #000;
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px 0;
    gap: 24px;
    flex-shrink: 0;
}
.nav-icon {
    width: 40px; height: 40px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    color: var(--text-muted); cursor: pointer; transition: 0.2s;
}
.nav-icon:hover { color: white; background: var(--bg-element); }
.nav-icon.active { color: var(--accent); background: rgba(139, 92, 246, 0.15); }
.nav-icon svg { width: 24px; height: 24px; fill: none; stroke: currentColor; stroke-width: 2; }

/* 2. CONTROL SIDEBAR */
.sidebar {
    width: 340px;
    background: var(--bg-panel);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    height: 100%; /* Fill workspace height */
}

/* Sidebar Header */
.sidebar-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    font-weight: 600;
    font-size: 14px;
    display: flex; justify-content: space-between;
}

/* Sidebar SCROLL AREA (The inputs) */
.sidebar-scroll {
    flex: 1; /* Take all available space */
    overflow-y: auto; /* Enable scroll inside this box */
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    min-height: 0; /* Crucial for nested flex scrolling */
}

/* Sidebar FOOTER (Pinned Generate Button) */
.sidebar-footer {
    padding: 20px;
    border-top: 1px solid var(--border);
    background: var(--bg-panel);
    z-index: 10;
}

/* 3. MAIN STAGE (Gallery) */
.stage {
    flex: 1;
    background: #050505;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
}
.stage-content {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
}

/* -------------------------------------------------------------------------- */
/* UI COMPONENTS */
/* -------------------------------------------------------------------------- */

/* Tabs */
.tabs { display: flex; background: var(--bg-element); padding: 4px; border-radius: 8px; }
.tab { 
    flex: 1; text-align: center; padding: 8px; font-size: 12px; cursor: pointer; 
    border-radius: 6px; color: var(--text-muted); font-weight: 500; 
}
.tab.active { background: var(--bg-card); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

/* Textarea */
textarea {
    width: 100%; background: var(--bg-element); border: 1px solid var(--border);
    border-radius: 8px; color: white; padding: 12px; font-family: inherit; font-size: 13px;
    min-height: 120px; resize: vertical; line-height: 1.5;
}
textarea:focus { border-color: var(--accent); }

/* Upload Zone */
.upload-zone {
    width: 100%; height: 140px; border: 2px dashed var(--border);
    border-radius: 8px; background: rgba(255,255,255,0.02);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    cursor: pointer; position: relative; overflow: hidden;
}
.upload-zone:hover { border-color: var(--accent); background: rgba(139, 92, 246, 0.05); }
.upload-zone.has-file { border-style: solid; border-color: var(--accent); }
.preview-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: none; }

/* Sliders */
.slider-group { display: flex; flex-direction: column; gap: 8px; }
.slider-label { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; }
input[type=range] { width: 100%; accent-color: var(--accent); }

/* Aspect Ratio Grid */
.ratio-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.ratio-box {
    background: var(--bg-element); border: 1px solid var(--border); border-radius: 6px;
    padding: 8px; text-align: center; font-size: 11px; color: var(--text-muted); cursor: pointer;
}
.ratio-box:hover { background: var(--bg-card); color: white; }
.ratio-box.active { background: white; color: black; border-color: white; font-weight: 700; }

/* Generate Button */
.btn-gen {
    width: 100%; padding: 14px; border-radius: 8px; border: none;
    background: linear-gradient(135deg, #8b5cf6, #3b82f6);
    color: white; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;
    cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}
.btn-gen:hover { transform: translateY(-2px); filter: brightness(1.1); }
.btn-gen:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* Gallery Grid */
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
.card {
    background: var(--bg-card); border-radius: 12px; overflow: hidden; border: 1px solid var(--border);
    position: relative; aspect-ratio: 1; transition: 0.2s;
}
.card:hover { transform: translateY(-4px); border-color: var(--text-muted); }
.card img { width: 100%; height: 100%; object-fit: cover; }
.card-overlay {
    position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    opacity: 0; transition: 0.2s; display: flex; align-items: flex-end; justify-content: flex-end; padding: 16px;
}
.card:hover .card-overlay { opacity: 1; }
.icon-btn {
    width: 32px; height: 32px; background: rgba(255,255,255,0.2); border-radius: 6px;
    display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; backdrop-filter: blur(4px);
}
.icon-btn:hover { background: white; color: black; }

/* Status Toast */
.toast {
    position: fixed; bottom: 20px; right: 20px; background: var(--bg-card); border: 1px solid var(--border);
    border-left: 4px solid var(--accent); padding: 16px; border-radius: 8px;
    display: flex; align-items: center; gap: 12px; font-size: 13px;
    transform: translateY(100px); transition: 0.3s; z-index: 100;
}
.toast.active { transform: translateY(0); }
.spinner { width: 16px; height: 16px; border: 2px solid #333; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

</style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:12px; font-weight:700; font-size:18px;">
        <div class="brand-logo">S</div> Sulandra Studio
    </div>
    <div style="font-size:12px; color:#666;">H200 GPU: <span style="color:#10b981">‚óè ONLINE</span></div>
</header>

<div class="workspace">
    
    <div class="nav-rail">
        <div class="nav-icon active" title="Image Lab"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div>
        <div class="nav-icon" title="Video Lab" onclick="window.location.href='video.html'"><svg viewBox="0 0 24 24"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg></div>
        <div class="nav-icon" title="Music Lab" onclick="window.location.href='music.html'"><svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg></div>
    </div>

    <div class="sidebar">
        <div class="sidebar-header">
            <span>IMAGE SETTINGS</span>
        </div>

        <div class="sidebar-scroll">
            
            <div class="tabs">
                <div class="tab active" onclick="setMode('txt2img', this)">Text to Image</div>
                <div class="tab" onclick="setMode('img2img', this)">Image Reference</div>
            </div>

            <div>
                <div class="slider-label" style="margin-bottom:8px;">PROMPT</div>
                <textarea id="prompt-input" placeholder="Describe your image... (e.g. A cinematic shot of a futuristic Lagos street, neon rain, 8k resolution)"></textarea>
            </div>

            <div id="upload-group" style="display:none;">
                <div class="slider-label" style="margin-bottom:8px;">REFERENCE IMAGE</div>
                <input type="file" id="file-input" hidden accept="image/*" onchange="handleFile(this)">
                <div class="upload-zone" id="drop-zone" onclick="document.getElementById('file-input').click()">
                    <img id="preview-img" class="preview-img">
                    <div style="font-size:24px; color:#444; margin-bottom:4px;">üìÇ</div>
                    <div style="font-size:11px; color:#666;">Click to Upload</div>
                </div>
                
                <div class="slider-group" style="margin-top:16px;">
                    <div class="slider-label"><span>Influence Strength</span><span id="strength-val">0.75</span></div>
                    <input type="range" id="strength" min="0.1" max="1.0" step="0.05" value="0.75" oninput="document.getElementById('strength-val').innerText=this.value">
                </div>
            </div>

            <div>
                <div class="slider-label" style="margin-bottom:8px;">ASPECT RATIO</div>
                <div class="ratio-grid">
                    <div class="ratio-box active" onclick="setRatio(1024, 1024, this)">1:1</div>
                    <div class="ratio-box" onclick="setRatio(1280, 720, this)">16:9</div>
                    <div class="ratio-box" onclick="setRatio(720, 1280, this)">9:16</div>
                    <div class="ratio-box" onclick="setRatio(1024, 1280, this)">4:5</div>
                </div>
            </div>

            <div class="slider-group">
                <div class="slider-label"><span>Guidance Scale</span><span id="guidance-val">3.5</span></div>
                <input type="range" id="guidance" min="1.0" max="10.0" step="0.1" value="3.5" oninput="document.getElementById('guidance-val').innerText=this.value">
            </div>

        </div>

        <div class="sidebar-footer">
            <button id="gen-btn" class="btn-gen" onclick="generate()">GENERATE IMAGE</button>
        </div>
    </div>

    <div class="stage">
        <div class="stage-content">
            <div style="font-size:16px; font-weight:700; margin-bottom:20px; display:flex; justify-content:space-between;">
                My Generations
                <div style="font-size:12px; font-weight:400; color:#666;">Images saved to server</div>
            </div>

            <div class="grid" id="gallery-grid">
                </div>

            <div id="empty-state" style="height:60%; display:flex; flex-direction:column; align-items:center; justify-content:center; opacity:0.3;">
                <div style="font-size:48px; margin-bottom:16px;">üé®</div>
                <div>Start creating.</div>
            </div>
        </div>
    </div>

</div>

<div id="toast" class="toast">
    <div class="spinner"></div>
    <div id="toast-msg">Processing...</div>
</div>

<script>
    // --- CONFIGURATION ---
    const API_URL = "https://pm37tp93i3bbci-9000.proxy.runpod.net";

    // STATE
    let currentMode = 'txt2img';
    let imageBase64 = null;
    let currentWidth = 1024;
    let currentHeight = 1024;

    // 1. UI SWITCHING
    function setMode(mode, el) {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
        if(el) el.classList.add('active');
        document.getElementById('upload-group').style.display = (mode === 'img2img') ? 'block' : 'none';
    }

    function setRatio(w, h, el) {
        currentWidth = w;
        currentHeight = h;
        document.querySelectorAll('.ratio-box').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
    }

    // 2. FILE HANDLING
    function handleFile(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imageBase64 = e.target.result;
                const img = document.getElementById('preview-img');
                const zone = document.getElementById('drop-zone');
                img.src = imageBase64;
                img.style.display = 'block';
                zone.classList.add('has-file');
                
                if(currentMode !== 'img2img') {
                    setMode('img2img', document.querySelectorAll('.tab')[1]);
                }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 3. GENERATE LOGIC
    async function generate() {
        const prompt = document.getElementById('prompt-input').value;
        const btn = document.getElementById('gen-btn');

        if (!prompt) return showToast("‚ö†Ô∏è Please enter a prompt description");

        btn.innerHTML = "GENERATING...";
        btn.disabled = true;
        showToast("üöÄ Sending to H200 GPU...");

        const payload = {
            prompt: prompt,
            width: currentWidth,
            height: currentHeight,
            steps: 25,
            guidance: parseFloat(document.getElementById('guidance').value)
        };

        if (currentMode === 'img2img' && imageBase64) {
            payload.image_base64 = imageBase64;
            payload.strength = parseFloat(document.getElementById('strength').value);
        }

        try {
            const res = await fetch(`${API_URL}/api/image/txt2img`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await res.json();

            if (data.status === "success") {
                showToast("‚úÖ Image Generated!");
                addToGallery(data.image_url, prompt);
            } else {
                showToast("‚ùå Error: " + data.message);
            }

        } catch (e) {
            console.error(e);
            showToast("‚ùå Connection Failed. Check API.");
        } finally {
            btn.innerHTML = "GENERATE IMAGE";
            btn.disabled = false;
        }
    }

    // 4. GALLERY LOGIC
    function addToGallery(url, prompt) {
        const grid = document.getElementById('gallery-grid');
        const empty = document.getElementById('empty-state');
        if(empty) empty.style.display = 'none';

        const fullUrl = `${API_URL}${url}`;
        
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <img src="${fullUrl}" onclick="window.open('${fullUrl}')">
            <div class="card-overlay">
                <div class="icon-btn" onclick="window.open('${fullUrl}')">‚¨á</div>
            </div>
        `;
        
        // Add to top
        grid.prepend(div);
    }

    // 5. TOAST
    let toastTimeout;
    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        t.classList.add('active');
        clearTimeout(toastTimeout);
        toastTimeout = setTimeout(() => t.classList.remove('active'), 3000);
    }

    // Init
    setMode('txt2img', document.querySelectorAll('.tab')[0]);
</script>

</body>
</html>
